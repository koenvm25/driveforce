"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6743],{33944:function(e,t,n){var r=n(88983),a=n(24246);t.Z=function(){return(0,a.jsx)("div",{className:"block w-full rounded border border-gray-400 border-opacity-50 bg-gray-300 p-3",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(r.aUG,{size:20,strokeWidth:1.5}),(0,a.jsx)("p",{className:"text-sm",children:"No backups created yet - check again tomorrow."})]})})}},84427:function(e,t,n){var r=n(88983),a=n(79894),s=n(24246);t.Z=function(){return(0,s.jsx)("div",{className:"block w-full rounded border border-gray-400 border-opacity-50 bg-gray-300 p-3",children:(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)(r.aUG,{size:20,strokeWidth:1.5}),(0,s.jsxs)("p",{className:"text-sm",children:["Failed to retrieve backups for this project. Please contact"," ",(0,s.jsx)(a.default,{href:"/support/new",children:(0,s.jsx)("a",{className:"text-brand-900",children:"support"})}),"."]})]})})}},68740:function(e,t,n){n.d(t,{Z:function(){return f}});var r=n(55732),a=n(34707),s=n.n(a),i=n(27378),l=n(25229),o=n(88983),c=n(68043),d=n(42791),u=n(44266),m=n(51452),p=n(24246),h=function(e){var t=e.visible,n=e.extension,a=e.onCancel,l=(0,d.oR)(),c=l.ui,u=l.meta,h=(0,i.useState)(),f=h[0],x=h[1],v=(0,i.useState)(!1),b=v[0],j=v[1],g=u.schemas.list();(0,i.useEffect)((function(){var e=!1;if(t){var a=function(){var t=(0,r.Z)(s().mark((function t(){var r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e||(j(!0),x(void 0)),t.next=3,u.query("select * from pg_available_extension_versions where name = '".concat(n.name,"'"));case 3:(r=t.sent).error||e||x(r[0].schema),j(!1);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();a()}return function(){e=!0}}),[t]);var y=function(){var e=(0,r.Z)(s().mark((function e(t,r){var i,l,o,d,m,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=r.setSubmitting)(!0),(l=void 0!==f&&null!==f?f:"custom"===t.schema?t.name:t.schema).startsWith("pg_")){e.next=10;break}return e.next=6,u.query("create schema if not exists ".concat(l));case 6:if(o=e.sent,!(d=o.error)){e.next=10;break}return e.abrupt("return",c.setNotification({error:d,category:"error",message:"Failed to create schema: ".concat(d.message)}));case 10:return e.next=12,u.extensions.create({schema:l,name:n.name,version:n.default_version,cascade:!0});case 12:m=e.sent,(p=m.error)?c.setNotification({error:p,category:"error",message:"Failed to toggle ".concat(n.name.toUpperCase(),": ").concat(p.message)}):c.setNotification({category:"success",message:"".concat(n.name.toUpperCase()," is on.")}),i(!1),a();case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,p.jsx)(o.u_l,{closable:!0,hideFooter:!0,visible:t,onCancel:a,size:"small",header:(0,p.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,p.jsx)("h5",{className:"text-sm text-scale-1200",children:"Confirm to enable"}),(0,p.jsx)("code",{className:"text-xs",children:n.name})]}),children:(0,p.jsx)(o.l09,{initialValues:{name:n.name,schema:"extensions"},validate:function(e){var t={};return"custom"!==e.schema||e.name||(t.name="Required field"),t},onSubmit:y,children:function(e){var t=e.isSubmitting,r=e.values;return(0,p.jsxs)("div",{className:"space-y-4 py-4",children:[(0,p.jsx)(o.u_l.Content,{children:b?(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsx)(m.Z,{}),(0,p.jsx)("div",{className:"w-3/4",children:(0,p.jsx)(m.Z,{})})]}):f?(0,p.jsx)(o.IIB,{disabled:!0,id:"schema",name:"schema",value:f,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(f,".")}):(0,p.jsxs)(o.RiT,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,p.jsxs)(o.RiT.Option,{id:"custom",label:'Create a new schema "'.concat(n.name,'"'),value:"custom",addOnBefore:function(){return(0,p.jsx)(o.SC9,{size:16,strokeWidth:1.5})},children:['Create a new schema "',n.name,'"']},"custom"),(0,p.jsx)(o.u_l.Separator,{}),g.map((function(e){return(0,p.jsx)(o.RiT.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:function(){return(0,p.jsx)(o.OQ8,{size:16,strokeWidth:1.5})},children:e.name},e.id)}))]})}),"custom"===r.schema&&(0,p.jsx)(o.u_l.Content,{children:(0,p.jsx)(o.IIB,{id:"name",name:"name",label:"Schema name"})}),(0,p.jsx)(o.u_l.Separator,{}),(0,p.jsx)(o.u_l.Content,{children:(0,p.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,p.jsx)(o.zxk,{type:"default",disabled:t,onClick:function(){return a()},children:"Cancel"}),(0,p.jsx)(o.zxk,{htmlType:"submit",disabled:t,loading:t,children:"Enable extension"})]})})]})}})})},f=(0,l.Pi)((function(e){var t=e.extension,n=(0,d.oR)(),a=n.ui,l=n.meta,m=null!==t.installed_version,f=(0,i.useState)(!1),x=f[0],v=f[1],b=(0,i.useState)(!1),j=b[0],g=b[1],y=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"extensions");function N(){return(N=(0,r.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g(!0));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return w=(0,r.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,u._)({title:"Confirm to disable extension",message:'Are you sure you want to turn OFF "'.concat(t.name,'" extension?'),onAsyncConfirm:function(){var e=(0,r.Z)(s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v(!0),e.next=4,l.extensions.del(t.name);case 4:if(!(n=e.sent).error){e.next=9;break}throw n.error;case 9:a.setNotification({category:"success",message:"".concat(t.name.toUpperCase()," is off.")});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),a.setNotification({category:"error",message:"Toggle ".concat(t.name.toUpperCase()," failed: ").concat(e.t0.message)});case 15:return e.prev=15,l.extensions.load(),v(!1),e.finish(15);case 19:case"end":return e.stop()}}),e,null,[[0,12,15,19]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:["flex border-panel-border-light dark:border-panel-border-dark","flex-col overflow-hidden rounded border shadow-sm"].join(" "),children:[(0,p.jsxs)("div",{className:["border-panel-border-light bg-panel-header-light dark:bg-panel-header-dark","flex border-b p-4 px-6 dark:border-panel-border-dark"].join(" "),children:[(0,p.jsx)("h3",{title:t.name,className:"m-0 h-5 flex-1 truncate text-base uppercase text-scale-1200",children:t.name}),x?(0,p.jsx)(o.pAw,{className:"animate-spin",size:16}):(0,p.jsx)(o.ZDl,{size:"tiny",checked:m,disabled:!y,onChange:function(){return m?function(){return w.apply(this,arguments)}():function(){return N.apply(this,arguments)}()}})]}),(0,p.jsxs)("div",{className:["bg-panel-header-light dark:bg-panel-header-dark","bg-panel-secondary-light dark:bg-panel-secondary-dark flex h-full flex-col justify-between"].join(" "),children:[(0,p.jsx)("div",{className:"p-4 px-6",children:(0,p.jsx)("p",{className:"text-sm text-scale-1100 capitalize-sentence",children:t.comment})}),m&&t.schema&&(0,p.jsx)("div",{className:"p-4 px-6",children:(0,p.jsxs)("div",{className:"flex flex-grow items-center space-x-2 text-sm text-scale-1100",children:[(0,p.jsx)("span",{children:"Schema:"}),(0,p.jsx)(o.Cts,{children:"".concat(t.schema)})]})})]})]}),(0,p.jsx)(h,{visible:j,extension:t,onCancel:function(){return g(!1)}})]})}))},56743:function(e,t,n){n.d(t,{M4:function(){return $e},TH:function(){return f},B8:function(){return Vt},RA:function(){return gt},ZY:function(){return Ze},ZR:function(){return $t},eX:function(){return Et},_h:function(){return Ve},IP:function(){return V},Vj:function(){return Le},_y:function(){return qe},yT:function(){return P},vX:function(){return z},bw:function(){return h},Hm:function(){return oe}});var r=n(11246),a=n(27378),s=n(25229),i=n(88983),l=n(98784),o=n(24532),c=n(68043),d=n(42791),u=n(55671),m=n(30259),p=n(24246),h=(0,s.Pi)((function(e){var t=e.selectedSchema,n=e.onSelectSchema,s=void 0===n?function(){}:n,h=e.onAddTable,f=void 0===h?function(){}:h,x=e.onEditTable,v=void 0===x?function(){}:x,b=e.onDeleteTable,j=void 0===b?function(){}:b,g=e.onOpenTable,y=void 0===g?function(){}:g,N=(0,d.oR)().meta,w=(0,a.useState)(""),k=w[0],S=w[1],_=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"tables"),C=N.schemas.list(),O=(0,l.partition)(C,(function(e){var t;return N.excludedSchemas.includes(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"")})),Z=(0,r.Z)(O,2),T=Z[0],E=Z[1],P=N.tables.list((function(e){return e.schema===t})),F=0===k.length?P:P.filter((function(e){return e.name.includes(k)})),R=N.publications.list().find((function(e){return"supabase_realtime"===e.name})),z=C.find((function(e){return e.name===t})),I=T.some((function(e){return e.id===(null===z||void 0===z?void 0:z.id)}));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,p.jsx)("div",{className:"w-[230px]",children:(0,p.jsxs)(i.RiT,{size:"small",value:t,onChange:s,icon:I&&(0,p.jsx)(i._V1,{size:14,strokeWidth:2}),children:[(0,p.jsx)(i.RiT.Option,{disabled:!0,value:"normal-schemas",label:"Schemas",children:(0,p.jsx)("p",{className:"text-sm",children:"Schemas"})},"normal-schemas"),E.map((function(e){return(0,p.jsx)(i.RiT.Option,{value:e.name,label:e.name,addOnBefore:function(){return(0,p.jsx)("span",{className:"text-scale-900",children:"schema"})},children:(0,p.jsx)("span",{className:"text-scale-1200 text-sm",children:e.name})},e.id)})),(0,p.jsx)(i.RiT.Option,{disabled:!0,value:"protected-schemas",label:"Protected schemas",children:(0,p.jsx)("p",{className:"text-sm",children:"Protected schemas"})},"protected-schemas"),T.map((function(e){return(0,p.jsx)(i.RiT.Option,{value:e.name,label:e.name,addOnBefore:function(){return(0,p.jsx)("span",{className:"text-scale-900",children:"schema"})},children:(0,p.jsx)("span",{className:"text-scale-1200 text-sm",children:e.name})},e.id)}))]})}),(0,p.jsx)("div",{children:(0,p.jsx)(i.IIB,{size:"small",placeholder:"Filter tables",value:k,onChange:function(e){return S(e.target.value)},icon:(0,p.jsx)(i.jVj,{size:"tiny"})})})]}),!I&&(0,p.jsx)("div",{children:(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{disabled:!_,icon:(0,p.jsx)(i.SC9,{}),onClick:function(){return f()},children:"New table"})}),!_&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to create tables"})})]})]})})]}),0===F.length?(0,p.jsx)(m.Z,{}):(0,p.jsx)("div",{className:"my-4 w-full",children:(0,p.jsx)(u.Z,{head:[(0,p.jsx)(u.Z.th,{children:"Name"},"name"),(0,p.jsx)(u.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,p.jsx)(u.Z.th,{className:"hidden xl:table-cell",children:"Rows (Estimated)"},"rows"),(0,p.jsx)(u.Z.th,{className:"hidden xl:table-cell",children:"Size (Estimated)"},"size"),(0,p.jsx)(u.Z.th,{className:"hidden xl:table-cell text-center",children:"Realtime Enabled"},"realtime"),(0,p.jsx)(u.Z.th,{},"buttons")],body:F.map((function(e,t){var n,r;return(0,p.jsxs)(u.Z.tr,{children:[(0,p.jsx)(u.Z.td,{children:(0,p.jsx)("p",{title:e.name,children:e.name})}),(0,p.jsx)(u.Z.td,{className:"hidden max-w-sm truncate lg:table-cell break-all whitespace-normal",children:null!==e.comment?(0,p.jsx)("p",{title:e.comment,children:e.comment}):(0,p.jsx)("p",{className:"text-scale-800",children:"No description"})}),(0,p.jsx)(u.Z.td,{className:"hidden xl:table-cell",children:(0,p.jsx)("code",{className:"text-sm",children:null!==(n=e.live_rows_estimate)&&void 0!==n?n:e.live_row_count})}),(0,p.jsx)(u.Z.td,{className:"hidden xl:table-cell",children:(0,p.jsx)("code",{className:"text-sm",children:e.size})}),(0,p.jsx)(u.Z.td,{className:"hidden xl:table-cell text-center",children:(null!==(r=null===R||void 0===R?void 0:R.tables)&&void 0!==r?r:[]).find((function(t){return t.id===e.id}))&&(0,p.jsx)("div",{className:"flex justify-center",children:(0,p.jsx)(i.NOm,{strokeWidth:2})})}),(0,p.jsx)(u.Z.td,{children:(0,p.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,p.jsxs)(i.zxk,{type:"default",iconRight:(0,p.jsx)(i.eYc,{}),className:"whitespace-nowrap hover:border-gray-500",style:{paddingTop:3,paddingBottom:3},onClick:function(){return y(e)},children:[e.columns.length," columns"]}),(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{type:"text",icon:(0,p.jsx)(i.W_r,{}),style:{padding:5},disabled:!_||I,onClick:function(){return v(e)}})}),!_&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to edit tables"})})]})]}),(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{type:"text",icon:(0,p.jsx)(i.IT9,{}),style:{padding:5},disabled:!_||I,onClick:function(){return j(e)}})}),!_&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to delete tables"})})]})]})]})})]},e.id)}))})})]})})),f=(0,s.Pi)((function(e){var t,n,r,s=e.selectedTable,l=e.onSelectBack,h=void 0===l?function(){}:l,f=e.onAddColumn,x=void 0===f?function(){}:f,v=e.onEditColumn,b=void 0===v?function(){}:v,j=e.onDeleteColumn,g=void 0===j?function(){}:j,y=(0,d.oR)().meta,N=(0,a.useState)(""),w=N[0],k=N[1],S=null!==(t=0===w.length?s.columns:null===(n=s.columns)||void 0===n?void 0:n.filter((function(e){return e.name.includes(w)})))&&void 0!==t?t:[],_=y.excludedSchemas.includes(null!==(r=s.schema)&&void 0!==r?r:""),C=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"mb-4",children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsxs)("div",{className:"flex items-center mr-4",children:[(0,p.jsx)(i.zxk,{type:"outline",className:"mr-4",onClick:function(){return h()},icon:(0,p.jsx)(i.ed9,{size:"small"}),style:{padding:"5px"}}),(0,p.jsx)("code",{children:s.name})]}),(0,p.jsx)("div",{children:(0,p.jsx)(i.IIB,{size:"small",placeholder:"Filter columns",value:w,onChange:function(e){return k(e.target.value)},icon:(0,p.jsx)(i.jVj,{size:"tiny"})})})]}),!_&&(0,p.jsx)("div",{children:(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{disabled:!C,icon:(0,p.jsx)(i.SC9,{}),onClick:function(){return x()},children:"New column"})}),!C&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to create columns"})})]})]})})]})}),0===S.length?(0,p.jsx)(m.Z,{}):(0,p.jsx)("div",{children:(0,p.jsx)(u.Z,{head:[(0,p.jsx)(u.Z.th,{children:"Name"},"name"),(0,p.jsx)(u.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,p.jsx)(u.Z.th,{className:"hidden xl:table-cell",children:"Data Type"},"type"),(0,p.jsx)(u.Z.th,{className:"hidden xl:table-cell",children:"Format"},"format"),(0,p.jsx)(u.Z.th,{},"buttons")],body:S.map((function(e,t){return(0,p.jsxs)(u.Z.tr,{className:"border-t",children:[(0,p.jsx)(u.Z.td,{children:(0,p.jsx)("p",{children:e.name})}),(0,p.jsx)(u.Z.td,{className:"break-all whitespace-normal",children:null!==e.comment?(0,p.jsx)("p",{title:e.comment,children:e.comment}):(0,p.jsx)("p",{className:"text-scale-800",children:"No description"})}),(0,p.jsx)(u.Z.td,{children:(0,p.jsx)("code",{className:"text-xs",children:e.data_type})}),(0,p.jsx)(u.Z.td,{className:"font-mono text-xs",children:(0,p.jsx)("code",{className:"text-xs",children:e.format})}),(0,p.jsx)(u.Z.td,{className:"px-4 py-3 pr-2",children:(0,p.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{onClick:function(){return b(e)},icon:(0,p.jsx)(i.W_r,{}),style:{padding:5},type:"text",disabled:!C||_})}),!C&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to edit columns"})})]})]}),(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{onClick:function(){return g(e)},icon:(0,p.jsx)(i.IT9,{}),style:{padding:5},type:"text",disabled:!C||_})}),!C&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to delete columns"})})]})]})]})})]},e.name)}))})})]})})),x=n(55732),v=n(79305),b=n(34707),j=n.n(b),g=n(39466),y=n(33003),N=n(90849),w=n(90089),k=["anon","service_role","authenticated","authenticator","dashboard_user","supabase_admin","supabase_auth_admin","supabase_replication_admin","supabase_storage_admin","supabase_functions_admin","pgbouncer","pgsodium_keyholder","pgsodium_keyiduser","pgsodium_keymaker"],S={can_login:{disabled:!1,description:"User can login"},can_create_role:{disabled:!1,description:"User can create roles"},can_create_db:{disabled:!1,description:"User can create databases"},can_bypass_rls:{disabled:!0,description:"User bypasses every row level security policy"},is_superuser:{disabled:!0,description:"User is a Superuser"},is_replication_role:{disabled:!0,description:"User can initiate streaming replication and put the system in and out of backup mode"}},_=["is_superuser","is_replication_role"];function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Z=function(e){var t=e.role,n=e.disabled,r=void 0!==n&&n,s=e.onSelectDelete,l=(0,d.oR)(),c=l.ui,u=l.meta,m=(0,a.useState)(!1),h=m[0],f=m[1],v=t.is_superuser,b=t.can_login,g=t.can_create_role,y=t.can_create_db,N=t.is_replication_role,k=t.can_bypass_rls,C=function(){var e=(0,x.Z)(j().mark((function e(n,r){var a,s,i,l;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.setSubmitting,s=r.resetForm,a(!0),n.is_superuser,n.is_replication_role,i=(0,w.Z)(n,_),e.next=5,u.roles.update(t.id,i);case 5:l=e.sent,a(!1),l.error?c.setNotification({category:"error",message:'Failed to update role "'.concat(t.name,'": ').concat(l.error.message)}):(c.setNotification({category:"success",message:'Successfully updated role "'.concat(t.name,'"')}),s({values:O({},n),initialValues:O({},n)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,p.jsx)(i.l09,{name:"role-update-form",initialValues:{is_superuser:v,can_login:b,can_create_role:g,can_create_db:y,is_replication_role:N,can_bypass_rls:k},onSubmit:C,className:["bg-scale-100 dark:bg-scale-300","hover:bg-scale-200 dark:hover:bg-scale-500","data-open:bg-scale-200 dark:data-open:bg-scale-500","border-scale-300 dark:border-scale-500 hover:border-scale-500","dark:hover:border-scale-700 data-open:border-scale-700","data-open:pb-px col-span-12 mx-auto","-space-y-px overflow-hidden","border border-t-0 first:border-t first:!mt-0 hover:border-t hover:-mt-[1px] shadow transition hover:z-50","first:rounded-tl first:rounded-tr","last:rounded-bl last:rounded-br"].join(" "),children:function(e){var n=e.values,a=e.initialValues,l=e.handleReset,c=e.isSubmitting,d=JSON.stringify(n)!==JSON.stringify(a);return(0,p.jsxs)(i.zF9,{open:h,children:[(0,p.jsx)(i.zF9.Trigger,{asChild:!0,children:(0,p.jsxs)("button",{id:"collapsible-trigger",type:"button",className:"group flex w-full items-center justify-between rounded py-3 px-6 text-scale-1200",onClick:function(e){"collapsible-trigger"===e.target.id&&f(!h)},children:[(0,p.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,p.jsx)(i.y_Q,{id:"collapsible-trigger",className:"text-scale-800 transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,p.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,p.jsx)("p",{className:"text-left text-sm",id:"collapsible-trigger",children:t.name}),(0,p.jsxs)("p",{className:"text-left text-sm text-scale-1000",id:"collapsible-trigger",children:["(ID: ",t.id,")"]})]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-4",children:[t.active_connections>0&&(0,p.jsx)("div",{className:"relative h-2 w-2",children:(0,p.jsxs)("span",{className:"flex h-2 w-2",children:[(0,p.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-brand-900 opacity-75"}),(0,p.jsx)("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-brand-900 opacity-75"})]})}),(0,p.jsxs)("p",{id:"collapsible-trigger",className:"text-sm ".concat(t.active_connections>0?"text-scale-1100":"text-scale-1000"),children:[t.active_connections," connections"]}),!r&&(0,p.jsx)(i.Ltx,{side:"bottom",className:"w-[120px]",overlay:(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(i.Ltx.Item,{icon:(0,p.jsx)(i.IT9,{className:"text-red-800",size:"tiny",strokeWidth:2}),onClick:function(e){e.stopPropagation(),s(t)},children:"Delete"})}),children:(0,p.jsx)(i.zxk,{as:"span",type:"default",className:"px-1",icon:(0,p.jsx)(i.nqv,{})})})]})]})}),(0,p.jsx)(i.zF9.Content,{children:(0,p.jsxs)("div",{className:"group border-t border-scale-500 bg-scale-100 py-6 px-20 text-scale-1200 dark:bg-scale-300",children:[(0,p.jsx)("div",{className:"py-4 space-y-[9px]",children:Object.keys(S).map((function(e){return(0,p.jsx)(i.ZDl,{size:"small",id:e,name:e,label:S[e].description,disabled:r||S[e].disabled,className:["roles-toggle",r||S[e].disabled?"opacity-50":""].join(" "),afterLabel:!r&&S[e].disabled&&(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{type:"button",children:(0,p.jsx)(i.Sus,{size:"tiny",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,p.jsxs)(o.VY,{align:"center",side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 space-y-1"].join(" "),children:(0,p.jsx)("span",{className:"text-xs",children:"This privilege cannot be updated via the dashboard"})})]})]})},e)}))}),!r&&(0,p.jsxs)("div",{className:"py-4 flex items-center space-x-2 justify-end",children:[(0,p.jsx)(i.zxk,{type:"default",disabled:!d||c,onClick:function(){return l()},children:"Cancel"}),(0,p.jsx)(i.zxk,{type:"primary",htmlType:"submit",disabled:!d||c,loading:c,children:"Save"})]})]})})]})}})},T=function(e){var t=e.visible,n=e.onClose,r=(0,a.useRef)(),s=(0,d.oR)(),l=s.ui,c=s.meta,u=(0,a.useState)(!1),m=u[0],h=u[1],f=function(){var e=(0,x.Z)(j().mark((function e(t){var r;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.next=3,c.roles.create(t);case 3:if(r=e.sent,h(!1),!r.error){e.next=9;break}return e.abrupt("return",l.setNotification({category:"error",message:"Failed to create role: ".concat(r.error.message)}));case 9:l.setNotification({category:"success",message:"Successfully created new role: ".concat(r.name)}),n();case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,p.jsx)(i.hsB,{size:"large",visible:t,header:"Create a new role",className:"mr-0 transform transition-all duration-300 ease-in-out",loading:!1,onCancel:n,customFooter:(0,p.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-scale-500 px-3 py-4",children:[(0,p.jsx)(i.zxk,{size:"tiny",type:"default",htmlType:"button",onClick:n,disabled:m,children:"Cancel"}),(0,p.jsx)(i.zxk,{size:"tiny",type:"primary",htmlType:"button",disabled:m,loading:m,onClick:function(){var e;return null===r||void 0===r||null===(e=r.current)||void 0===e?void 0:e.click()},children:"Create role"})]}),children:(0,p.jsx)(i.l09,{validateOnBlur:!0,id:"create-new-role",initialValues:{name:"",is_superuser:!1,can_login:!1,can_create_role:!1,can_create_db:!1,is_replication_role:!1,can_bypass_rls:!1},validate:function(e){var t={};return 0===e.name.length&&(t.name="Please provide a name for your role"),t},onSubmit:f,children:function(e){e.isSubmitting,e.handleReset,e.values,e.initialValues;return(0,p.jsxs)("div",{children:[(0,p.jsx)(y.hj,{header:(0,p.jsx)(y.S0,{className:"lg:!col-span-4",children:"Role Configuration"}),children:(0,p.jsx)(y.B4,{loading:!1,className:"lg:!col-span-8",children:(0,p.jsx)(i.IIB,{id:"name",label:"Name"})})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(y.hj,{header:(0,p.jsx)(y.S0,{className:"lg:!col-span-4",children:"Role Privileges"}),children:(0,p.jsx)(y.B4,{loading:!1,className:"lg:!col-span-8",children:(0,p.jsx)("div",{className:"space-y-[9px]",children:Object.keys(S).map((function(e){return(0,p.jsx)(i.ZDl,{size:"small",disabled:S[e].disabled,className:["roles-toggle",S[e].disabled?"opacity-50":""].join(" "),id:e,name:e,label:S[e].description,afterLabel:S[e].disabled&&(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{type:"button",children:(0,p.jsx)(i.Sus,{size:"tiny",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,p.jsxs)(o.VY,{align:"center",side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 space-y-1"].join(" "),children:(0,p.jsx)("span",{className:"text-xs",children:"This privilege cannot be granted via the dashboard"})})]})]})},e)}))})})}),(0,p.jsx)("button",{ref:r,type:"submit",className:"hidden"})]})}})})},E=function(e){var t=e.role,n=e.visible,r=e.onClose,s=(0,d.oR)(),l=s.ui,o=s.meta,c=(0,a.useState)(!1),u=c[0],m=c[1],h=function(){var e=(0,x.Z)(j().mark((function e(){var n;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",console.error("Failed to delete role: role is missing"));case 2:return m(!0),e.next=5,o.roles.del(t.id);case 5:if(n=e.sent,m(!1),!n.error){e.next=11;break}return e.abrupt("return",l.setNotification({category:"error",message:"Failed to delete role: ".concat(n.error.message)}));case 11:l.setNotification({category:"success",message:'Successfully deleted role: "'.concat(t.name,'"')}),r();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,p.jsx)(i.u_l,{size:"small",alignFooter:"right",visible:n,onCancel:r,onConfirm:h,header:(0,p.jsxs)("h3",{children:['Confirm to delete role "',null===t||void 0===t?void 0:t.name,'"']}),loading:u,children:(0,p.jsx)("div",{className:"py-4",children:(0,p.jsx)(i.u_l.Content,{children:(0,p.jsx)("p",{className:"text-sm",children:"This will automatically revoke any membership of this role in other roles, and this action cannot be undone."})})})})},P=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,d.oR)().meta,n=(0,a.useState)(0),s=n[0],u=n[1],m=(0,a.useState)(""),h=m[0],f=m[1],b=(0,a.useState)("all"),N=b[0],w=b[1],S=(0,a.useState)(!1),_=S[0],C=S[1],O=(0,a.useState)(),P=O[0],F=O[1],R=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"roles");(0,a.useEffect)((function(){var e=function(){var e=(0,x.Z)(j().mark((function e(){var n,r,a;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query("show max_connections");case 2:(n=e.sent).error||u(Number(null!==(r=null===(a=n[0])||void 0===a?void 0:a.max_connections)&&void 0!==r?r:0));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var z=t.roles.list(),I=("active"===N?t.roles.list((function(e){return e.active_connections>0})):t.roles.list()).filter((function(e){return e.name.includes(h)})),D=(0,l.partition)(I,(function(e){return k.includes(e.name)})),A=(0,r.Z)(D,2),B=A[0],V=A[1],L=z.map((function(e){return e.active_connections})).reduce((function(e,t){return e+t}),0),W=z.filter((function(e){return e.active_connections>0})).sort((function(e,t){return t.active_connections-e.active_connections}));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{className:"flex items-center justify-between",children:(0,p.jsx)(y.ph,{title:"Database Roles",description:"Manage access control to your database through users, groups, and permissions"})}),(0,p.jsxs)("div",{className:"mb-4 -mt-2 flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,p.jsx)(i.IIB,{size:"small",placeholder:"Search for a role",icon:(0,p.jsx)(i.jVj,{size:"tiny"}),value:h,onChange:function(e){return f(e.target.value)},actions:h&&(0,p.jsx)(i.zxk,{size:"tiny",type:"text",onClick:function(){return f("")},className:"px-1 mr-1",children:(0,p.jsx)(i.kLi,{size:12,strokeWidth:2})})}),(0,p.jsxs)("div",{className:"flex items-center border border-scale-700 rounded-full w-min h-[34px]",children:[(0,p.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-l-full flex items-center justify-center transition","all"===N?"bg-scale-500 text-scale-1200":"hover:bg-scale-400 text-scale-1100"].join(" "),onClick:function(){return w("all")},children:"All roles"}),(0,p.jsx)("div",{className:"h-full w-[1px] border-r border-scale-700"}),(0,p.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-r-full flex items-center justify-center transition","active"===N?"bg-scale-500 text-scale-1200":"hover:bg-scale-400 text-scale-1100"].join(" "),onClick:function(){return w("active")},children:"Active roles"})]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)("div",{className:"w-42",children:(0,p.jsx)(g.Z,{type:"horizontal",max:s,value:L,barClass:0===s?"bg-gray-100 dark:bg-gray-600":L>.9*s?"bg-red-800":L>.75*s?"bg-amber-900":"bg-green-800",labelTop:"".concat(L,"/").concat(s),labelBottom:"Active connections"})})}),(0,p.jsxs)(o.VY,{align:"start",side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsxs)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 space-y-1"].join(" "),children:[(0,p.jsx)("p",{className:"text-xs text-scale-1100 pr-2",children:"Connections by roles:"}),W.map((function(e){return(0,p.jsxs)("div",{className:"text-xs text-scale-1200",children:[e.name,": ",e.active_connections]},e.id)}))]})]})]}),(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{type:"primary",disabled:!R,icon:(0,p.jsx)(i.SC9,{size:"tiny"}),onClick:function(){return C(!0)},children:"Add role"})}),!R&&(0,p.jsxs)(o.VY,{align:"start",side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 text-xs"].join(" "),children:"You need additional permissions to add a new role"})]})]})]})]}),(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{children:[B.length>0&&(0,p.jsxs)("div",{className:"bg-scale-100 dark:bg-scale-200 border border-scale-300 dark:border-scale-500 px-6 py-3 rounded-t flex items-center space-x-4",children:[(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"Roles managed by Supabase"}),(0,p.jsx)(i.Cts,{color:"green",children:"Protected"})]}),B.map((function(e,t){return(0,p.jsx)(Z,{disabled:!0,role:e,onSelectDelete:F},e.id)}))]}),(0,p.jsxs)("div",{children:[V.length>0&&(0,p.jsx)("div",{className:"bg-scale-100 dark:bg-scale-200 border border-scale-300 dark:border-scale-500 px-6 py-3 rounded-t",children:(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"Other database roles"})}),V.map((function(e,t){return(0,p.jsx)(Z,{disabled:!R,role:e,onSelectDelete:F},e.id)}))]})]}),h.length>0&&0===I.length&&(0,p.jsxs)("div",{className:"bg-scale-100 dark:bg-scale-300 border border-scale-300 dark:border-scale-500 px-6 py-4 rounded space-y-1",children:[(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"No results found"}),(0,p.jsxs)("p",{className:"text-sm text-scale-1000",children:['Your search for "',h,'" did not return any results']})]})]}),(0,p.jsx)(T,{visible:_,onClose:function(){return C(!1)}}),(0,p.jsx)(E,{role:P,visible:void 0!==P,onClose:function(){return F(void 0)}})]})})),F=n(92836),R=n(96423),z=(0,s.Pi)((function(e){var t=e.selectedRole,n=e.onSelectBack,r=void 0===n?function(){}:n;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"mb-8",children:(0,p.jsx)("div",{className:"",children:(0,p.jsxs)("nav",{className:"-mb-px flex",children:[(0,p.jsx)("div",{className:"group mr-4 inline-flex items-center p-1 ",children:(0,p.jsx)(i.zxk,{type:"outline",onClick:function(){return r()},icon:(0,p.jsx)(i.ed9,{size:"small"}),style:{padding:"5px"}})}),(0,p.jsx)("a",{href:"#",className:" group mx-4 inline-flex items-center border-b-2 border-green-500 p-1 text-sm font-medium text-typography-body-strong-light focus:outline-none dark:text-typography-body-strong-dark ","aria-current":"page",children:(0,p.jsx)("span",{children:"Permissions"})})]})})}),(0,p.jsxs)(R.Z,{children:[(0,p.jsxs)(R.Z.Content,{className:"flex w-full items-center justify-between",children:[(0,p.jsx)("p",{className:"text-sm",children:"Super user"}),(0,p.jsx)("code",{className:"text-sm",children:t.is_superuser?"true":"false"})]}),(0,p.jsx)(F.Z,{light:!0}),(0,p.jsxs)(R.Z.Content,{className:"flex w-full items-center justify-between",children:[(0,p.jsx)("p",{className:"text-sm",children:"User can login"}),(0,p.jsx)("code",{className:"text-sm",children:t.can_login?"true":"false"})]}),(0,p.jsx)(F.Z,{light:!0}),(0,p.jsxs)(R.Z.Content,{className:"flex w-full items-center justify-between",children:[(0,p.jsx)("p",{className:"text-sm",children:"User can create databases"}),(0,p.jsx)("code",{className:"text-sm",children:t.can_create_db?"true":"false"})]}),(0,p.jsx)(F.Z,{light:!0}),(0,p.jsxs)(R.Z.Content,{className:"flex w-full items-center justify-between",children:[(0,p.jsx)("p",{className:"text-sm",children:"User can initiate streaming replication and put the system in and out of backup mode"}),(0,p.jsx)("code",{className:"text-sm",children:t.is_replication_role?"true":"false"})]}),(0,p.jsx)(F.Z,{light:!0}),(0,p.jsxs)(R.Z.Content,{className:"flex w-full items-center justify-between",children:[(0,p.jsx)("p",{className:"text-sm",children:"User bypasses every row level security policy"}),(0,p.jsx)("code",{className:"text-sm",children:t.can_bypass_rls?"true":"false"})]})]})]})})),I=n(68740),D=["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_prewarm","pg_surgery","pg_visibility","pgstattuple","supabase_vault","intagg","xml2"],A=n(33114),B=n(79894),V=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,d.oR)().meta,n=(0,d.UO)().filter,s=(0,a.useState)(""),o=s[0],u=s[1],h=0===o.length?t.extensions.list():t.extensions.list((function(e){return e.name.includes(o)})),f=h.filter((function(e){return!D.includes(e.name)})),x=(0,l.partition)(f,(function(e){return!(0,l.isNull)(e.installed_version)})),b=(0,r.Z)(x,2),j=b[0],g=b[1],y=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"extensions");return(0,a.useEffect)((function(){void 0!==n&&u(n)}),[n]),(0,p.jsxs)("div",{className:"p-4",children:[(0,p.jsx)("div",{className:"mb-4",children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsx)(i.IIB,{size:"small",placeholder:"Filter",value:o,onChange:function(e){return u(e.target.value)},icon:(0,p.jsx)(i.jVj,{size:"tiny"})}),y?(0,p.jsx)(B.default,{passHref:!0,href:"https://supabase.com/docs/guides/database/extensions",children:(0,p.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,p.jsx)(i.zxk,{type:"default",iconRight:(0,p.jsx)(i.sDS,{}),children:"Learn more about extensions"})})}):(0,p.jsx)("div",{className:"w-[500px]",children:(0,p.jsx)(A.Z,{icon:(0,p.jsx)(i.Ldj,{className:"text-scale-1100",strokeWidth:2}),title:"You need additional permissions to update database extensions"})})]})}),0===h.length&&(0,p.jsx)(m.Z,{}),(0,p.jsxs)("div",{className:"my-8 w-full space-y-12",children:[j.length>0&&(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsx)("h4",{className:"text-lg",children:"Enabled extensions"}),(0,p.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3",children:j.map((function(e){return(0,p.jsx)(I.Z,{extension:e},e.name)}))})]}),g.length>0&&(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsx)("h4",{className:"text-lg",children:"Available extensions"}),(0,p.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3",children:g.map((function(e){return(0,p.jsx)(I.Z,{extension:e},e.name)}))})]})]})]})})),L=n(51991),W=function(e){var t=e.projectRef,n=e.connectionString,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,L.cp)({projectRef:t,connectionString:n,sql:"\n    select\n      s.oid as \"id\",\n      w.fdwname as \"name\",\n      s.srvname as \"server_name\",\n      s.srvoptions as \"server_options\",\n      c.proname as \"handler\",\n      (\n        select jsonb_agg(\n          jsonb_build_object(\n            'id', c.oid::bigint,\n            'schema', relnamespace::regnamespace::text,\n            'name', c.relname,\n            'columns', (\n              select jsonb_agg(\n                jsonb_build_object(\n                  'name', a.attname,\n                  'type', pg_catalog.format_type(a.atttypid, a.atttypmod)\n                )\n              )\n              from pg_catalog.pg_attribute a\n              where a.attrelid = c.oid and a.attnum > 0 and not a.attisdropped\n            ),\n            'options', t.ftoptions\n          )\n        )\n        from pg_catalog.pg_class c\n        join pg_catalog.pg_foreign_table t on c.oid = t.ftrelid\n        where c.oid = any (select t.ftrelid from pg_catalog.pg_foreign_table t where t.ftserver = s.oid)\n      ) as \"tables\"\n    from pg_catalog.pg_foreign_server s\n    join pg_catalog.pg_foreign_data_wrapper w on s.srvfdw = w.oid\n    join pg_catalog.pg_proc c on w.fdwhandler = c.oid;\n  ",queryKey:["fdws"]},r)},q=[{name:"stripe_wrapper",handlerName:"stripe_fdw_handler",validatorName:"stripe_fdw_validator",icon:"/img/icons/stripe-icon.svg",extensionName:"StripeFdw",label:"Stripe",docsUrl:"https://supabase.com/docs/guides/database/wrappers/stripe",server:{options:[{name:"api_key_id",label:"Stripe Secret Key",required:!0,encrypted:!0,hidden:!0,urlHelper:"https://stripe.com/docs/keys"},{name:"api_url",label:"Stripe API URL",defaultValue:"https://api.stripe.com/v1",required:!1,encrypted:!1,hidden:!1}]},tables:[{label:"Balance",description:"The balance currently on your Stripe account",availableColumns:[{name:"balance_type",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance",editable:!1,required:!0}]},{label:"Balance Transactions",description:"Transactions that have contributed to the balance on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"description",type:"text"},{name:"fee",type:"bigint"},{name:"net",type:"bigint"},{name:"status",type:"text"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance_transactions",editable:!1,required:!0}]},{label:"Charges",description:"Charges made on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"customer",type:"text"},{name:"description",type:"text"},{name:"invoice",type:"text"},{name:"payment_intent",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"charges",editable:!1,required:!0}]},{label:"Customers",description:"Customers on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"email",type:"text"},{name:"name",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"customers",editable:!1,required:!0}]},{label:"Invoices",description:"Invoices on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"subscription",type:"text"},{name:"status",type:"text"},{name:"total",type:"bigint"},{name:"currency",type:"text"},{name:"period_start",type:"timestamp"},{name:"period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"invoices",editable:!1,required:!0}]},{label:"Payment Intents",description:"Payment Intents on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"payment_method",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"payment_intents",editable:!1,required:!0}]},{label:"Products",description:"Products on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"name",type:"text"},{name:"active",type:"bool"},{name:"default_price",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"updated",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"products",editable:!1,required:!0}]},{label:"Subscriptions",description:"Subscriptions on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"currency",type:"text"},{name:"current_period_start",type:"timestamp"},{name:"current_period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"subscriptions",editable:!1,required:!0}]}]},{name:"firebase_wrapper",handlerName:"firebase_fdw_handler",validatorName:"firebase_fdw_validator",icon:"/img/icons/firebase-icon.svg",extensionName:"FirebaseFdw",label:"Firebase",docsUrl:"https://supabase.com/docs/guides/database/wrappers/firebase",server:{options:[{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0,isTextArea:!0,urlHelper:"https://firebase.google.com/docs/admin/setup#initialize-sdk"}]},tables:[{label:"Users",description:"Shows your Firebase users",availableColumns:[{name:"uid",type:"text"},{name:"email",type:"text"},{name:"created_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"auth/users",editable:!1,required:!0},{name:"base_url",label:"Base URL",defaultValue:"https://identitytoolkit.googleapis.com/v1/projects",editable:!0,required:!0},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0}]},{label:"Firestore Collection",description:"Map to a Firestore collection",availableColumns:[{name:"name",type:"text"},{name:"created_at",type:"timestamp"},{name:"updated_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",label:"Object",placeholder:"firestore/[collection_id]",editable:!0,required:!0},{name:"base_url",label:"Base URL",defaultValue:"https://firestore.googleapis.com/v1beta1/projects",editable:!0,required:!0},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0}]}]}],Y=n(38579),M=n(85945),U=n(48228),H=n(41532);function K(e){return"\n    begin;\n\n    ".concat(e,"\n    \n    commit;\n  ")}var Q=["onSuccess"];function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $=function(e){var t=e.wrapper,n=e.wrapperMeta.server.options.filter((function(e){return e.encrypted})).map((function(e){var n="".concat(t.name,"_").concat(e.name);return"\n      delete from vault.secrets where key_id = (select id from pgsodium.valid_key where name = '".concat(n,"');\n\n      delete from pgsodium.key where name = '").concat(n,"';\n    ")})).join("\n");return"\n    drop foreign data wrapper if exists ".concat(t.name," cascade;\n\n    ").concat(n,"\n  ")};function G(e){return ee.apply(this,arguments)}function ee(){return(ee=(0,x.Z)(j().mark((function e(t){var n,r,a,s,i,l,o;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.projectRef,r=t.connectionString,a=t.wrapper,s=t.wrapperMeta,n){e.next=3;break}throw new Error("projectRef is required");case 3:return i=K($({wrapper:a,wrapperMeta:s})),e.next=6,(0,L.Rj)({projectRef:n,connectionString:r,sql:i});case 6:return l=e.sent,o=l.result,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=(0,w.Z)(e,Q),r=(0,M.NL)(),a=(0,d.oR)(),s=a.vault;return(0,U.D)((function(e){return G(e)}),X({onSuccess:function(e,n,a){return(0,x.Z)(j().mark((function i(){var l;return j().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return l=n.projectRef,i.next=3,Promise.all([r.invalidateQueries(H.M.query(l,["fdws"])),s.load()]);case 3:return i.next=5,null===t||void 0===t?void 0:t(e,n,a);case 5:case"end":return i.stop()}}),i)})))()}},n))},ne=n(47510),re=n(44266),ae=function(e){var t=e.wrappers,n=void 0===t?[]:t,a=e.wrapperMeta,s=e.isOpen,u=e.onOpen,m=(0,d.oR)().ui,h=(0,d.UO)().ref,f=(0,ne.d2)().project,v=te().mutateAsync,b=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"wrappers");return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(i.zF9,{open:s,onOpenChange:function(){return u(a.name)},className:["bg-scale-100 dark:bg-scale-300 ","hover:bg-scale-200 dark:hover:bg-scale-500","data-open:bg-scale-200 dark:data-open:bg-scale-500","border-scale-300","dark:border-scale-500 hover:border-scale-500","dark:hover:border-scale-700 data-open:border-scale-700","col-span-12 mx-auto","-space-y-px overflow-hidden","transition border shadow hover:z-50","first:rounded-tl first:rounded-tr first:!border-t","last:rounded-bl last:rounded-br last:border-t-0"].join(" "),children:[(0,p.jsx)(i.zF9.Trigger,{asChild:!0,children:(0,p.jsxs)("button",{type:"button",className:"flex items-center justify-between w-full px-6 py-3 rounded group text-scale-1200",children:[(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(i.y_Q,{className:"transition text-scale-800 data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,p.jsx)(Y.default,{src:a.icon,width:20,height:20,alt:"".concat(a.name," wrapper icon")}),(0,p.jsx)("span",{className:"text-sm capitalize",children:a.label})]}),(0,p.jsx)("div",{className:"flex items-center gap-3",children:(0,p.jsxs)("div",{className:"px-3 py-1 text-xs border rounded-md border-scale-500 bg-scale-100 text-scale-1200 dark:border-scale-700 dark:bg-scale-300",children:[n.length," wrapper",n.length>1?"s":""]})})]})}),(0,p.jsx)(i.zF9.Content,{children:(0,p.jsx)("div",{className:"border-t group border-scale-500 bg-scale-100 text-scale-1200 dark:bg-scale-300 divide-y",children:n.map((function(e){var t=Object.fromEntries(e.server_options.map((function(e){return e.split("=")}))),n=(0,l.partition)(a.server.options,"hidden"),s=(0,r.Z)(n,2),c=s[0],d=s[1];return(0,p.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"space-y-1 w-3/4",children:[(0,p.jsx)("div",{className:"flex items-center space-x-2",children:(0,p.jsx)("p",{className:"text-base",children:e.name})}),d.map((function(e){return(0,p.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-scale-1000",children:[(0,p.jsxs)("p",{children:[e.label,":"]}),(0,p.jsx)("p",{children:t[e.name]})]},e.name)})),c.map((function(t){return(0,p.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,p.jsxs)("p",{className:"text-scale-1000",children:[t.label,":"]}),(0,p.jsx)(B.default,{href:"/project/".concat(h,"/settings/vault/secrets?search=").concat(e.name,"_").concat(t.name),children:(0,p.jsxs)("a",{className:"transition text-scale-1000 hover:text-scale-1100 flex items-center space-x-2",children:[(0,p.jsx)("span",{children:"Encrypted in Vault"}),(0,p.jsx)(i.TqL,{size:14,strokeWidth:1.5})]})})]},t.name)})),(0,p.jsxs)("div",{className:"!mt-3 space-y-1",children:[(0,p.jsxs)("p",{className:"text-sm text-scale-1100",children:["Foreign tables: (",e.tables.length,")"]}),(0,p.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tables.map((function(e){return(0,p.jsx)(B.default,{href:"/project/".concat(h,"/editor/").concat(e.id),children:(0,p.jsx)("a",{children:(0,p.jsx)("div",{className:"text-sm border rounded px-2 py-1 transition bg-scale-400 hover:bg-scale-500",children:e.name},e.id)})})}))})]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[b?(0,p.jsx)(B.default,{href:"/project/".concat(h,"/database/wrappers/").concat(e.id),children:(0,p.jsx)("a",{children:(0,p.jsx)(i.zxk,{type:"default",icon:(0,p.jsx)(i.yl5,{strokeWidth:1.5}),className:"py-2"})})}):(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{type:"default",disabled:!0,icon:(0,p.jsx)(i.yl5,{strokeWidth:1.5}),className:"py-2"})}),!b&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to edit wrappers"})})]})]}),(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{type:"default",disabled:!b,icon:(0,p.jsx)(i.IT9,{strokeWidth:1.5}),className:"py-2",onClick:function(){return function(e){(0,re._)({title:"Confirm to disable ".concat(e.name),message:"Are you sure you want to disable the ".concat(e.name," wrapper? This will also remove all tables created with this wrapper."),onAsyncConfirm:function(){var t=(0,x.Z)(j().mark((function t(){return j().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v({projectRef:null===f||void 0===f?void 0:f.ref,connectionString:null===f||void 0===f?void 0:f.connectionString,wrapper:e,wrapperMeta:a});case 3:m.setNotification({category:"success",message:"Successfully disabled ".concat(e.name," foreign data wrapper")}),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),m.setNotification({error:t.t0,category:"error",message:"Failed to disable ".concat(e.name,": ").concat(t.t0.message)});case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}()})}(e)}})}),!b&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to add wrappers"})})]})]})]})]},e.id)}))})})]})})},se=n(51452),ie=(0,s.Pi)((function(e){var t=e.buttonText,n=void 0===t?"Add wrapper":t,r=e.align,s=void 0===r?"end":r,l=(0,d.UO)().ref;return(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"wrappers")?(0,p.jsx)(i.Ltx,{side:"bottom",align:s,size:"small",overlay:(0,p.jsx)(p.Fragment,{children:q.map((function(e,t){return(0,p.jsxs)(a.Fragment,{children:[(0,p.jsx)(B.default,{href:"/project/".concat(l,"/database/wrappers/new?type=").concat(e.name.toLowerCase()),children:(0,p.jsx)("a",{children:(0,p.jsx)(i.Ltx.Item,{icon:(0,p.jsx)(Y.default,{src:e.icon,width:20,height:20,alt:"".concat(e.name," wrapper icon")}),children:e.label},e.name)})}),t!==q.length-1&&(0,p.jsx)(i.Ltx.Separator,{})]},t)}))}),children:(0,p.jsx)(i.zxk,{type:"primary",icon:(0,p.jsx)(i.SC9,{strokeWidth:1.5}),children:n})}):(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{disabled:!0,type:"primary",icon:(0,p.jsx)(i.SC9,{strokeWidth:1.5}),children:n})}),(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to add wrappers"})})]})]})})),le=(0,s.Pi)((function(){var e=(0,d.oR)(),t=e.ui,n=e.meta,r=(0,d.UO)().ref,s=n.extensions.byId("wrappers"),l=n.extensions.byId("supabase_vault"),u=void 0===s||void 0===l,m=(0,a.useState)(!1),h=m[0],f=m[1],v=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),b=function(){var e=(0,x.Z)(j().mark((function e(){var r,a,i,o;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==s&&void 0!==l){e.next=2;break}return e.abrupt("return");case 2:return f(!0),e.t0=Promise,e.next=6,n.extensions.create({schema:null!==(r=s.schema)&&void 0!==r?r:"extensions",name:s.name,version:s.default_version,cascade:!0});case 6:return e.t1=e.sent,e.next=9,n.extensions.create({schema:null!==(a=l.schema)&&void 0!==a?a:"vault",name:l.name,version:l.default_version,cascade:!0});case 9:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=13,e.t0.all.call(e.t0,e.t3);case 13:i=e.sent,(o=i.filter((function(e){return e.error&&!e.error.message.includes("already exists")}))).length>0?t.setNotification({error:o,category:"error",message:"Failed to enable Wrappers for your project: ".concat(o.map((function(e){return e.message})).join(", "))}):t.setNotification({category:"success",message:"Wrappers is now enabled for your project!"}),f(!1);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,p.jsx)("div",{children:(0,p.jsx)("div",{className:"w-full px-12 py-12 bg-white bg-no-repeat border rounded dark:bg-scale-200 border-scale-500",style:{backgroundSize:"45%",backgroundPosition:"105% 40%",backgroundImage:t.isDarkTheme?'url("/img/wrappers-dark.png")':'url("/img/wrappers-light.png")'},children:(0,p.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsx)("h4",{className:"text-lg",children:"Supabase Wrappers"}),(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"Supabase Wrappers is a framework for building Postgres Foreign Data Wrappers (FDW) which connect Postgres to external systems. Query your data warehouse or third-party APIs directly from your database."})]}),u?(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:"rounded border border-scale-500 px-4 py-2 flex items-center justify-between",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"text-scale-1100 text-sm",children:"Wrappers is not available for this project yet."}),(0,p.jsx)("p",{className:"text-scale-1000 text-sm",children:"Do reach out to us if you're interested!"})]}),(0,p.jsx)("div",{children:(0,p.jsx)(B.default,{href:"/support/new?ref=".concat(r,"&category=sales&subject=Request%20for%20access%20to%20wrappers"),children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(i.zxk,{type:"primary",children:"Contact us"})})})})]}),(0,p.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,p.jsx)(B.default,{href:"https://supabase.com/docs/guides/database/wrappers",children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(i.zxk,{type:"default",icon:(0,p.jsx)(i.TqL,{}),children:"About Wrappers"})})})})]}):(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(B.default,{href:"https://supabase.com/docs/guides/database/wrappers",children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(i.zxk,{type:"default",icon:(0,p.jsx)(i.TqL,{}),children:"About Wrappers"})})}),(0,p.jsxs)(o.fC,{delayDuration:0,children:[(0,p.jsx)(o.xz,{children:(0,p.jsx)(i.zxk,{type:"primary",loading:h,disabled:u||h||!v,onClick:function(){return b()},children:"Enable Wrappers"})}),!v&&(0,p.jsxs)(o.VY,{side:"bottom",children:[(0,p.jsx)(o.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to enable Wrappers for this project"})})]})]})]})]})})})})),oe=(0,s.Pi)((function(){var e,t=(0,d.oR)().meta,n=(0,ne.d2)().project,r=W({projectRef:null===n||void 0===n?void 0:n.ref,connectionString:null===n||void 0===n?void 0:n.connectionString}),s=r.data,o=r.isLoading,c=(0,a.useState)(""),u=c[0],m=c[1],h=null!==(e=null===s||void 0===s?void 0:s.result)&&void 0!==e?e:[],f=(0,l.groupBy)(h,"handler"),x=t.extensions.byId("wrappers"),v=t.extensions.byId("supabase_vault"),b=t.extensions.isLoading,j=void 0!==x&&null!==x.installed_version&&void 0!==v&&null!==v.installed_version;return(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"mb-2 text-xl text-scale-1200",children:"Foreign Data Wrappers"}),(0,p.jsx)("div",{className:"text-sm text-scale-900",children:"Query your data warehouse directly from your database, or third-party APIs using SQL."})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(B.default,{href:"",children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(i.zxk,{type:"default",icon:(0,p.jsx)(i.TqL,{strokeWidth:1.5}),children:"Documentation"})})}),j&&(0,p.jsx)(ie,{})]})]}),b||o?(0,p.jsxs)("div",{className:"p-12 space-y-2 border rounded border-scale-500",children:[(0,p.jsx)(se.Z,{}),(0,p.jsx)(se.Z,{className:"w-3/4"}),(0,p.jsx)(se.Z,{className:"w-1/2"})]}):j?(0,p.jsx)("div",{children:0===h.length?(0,p.jsxs)("div",{className:["border rounded border-scale-500 px-20 py-16","flex flex-col items-center justify-center space-y-4"].join(" "),children:[(0,p.jsx)("p",{className:"text-sm",children:"No wrappers created yet"}),(0,p.jsx)(ie,{align:"center",buttonText:"Create a new wrapper"})]}):(0,p.jsx)(p.Fragment,{children:q.map((function(e,t){var n,r=null!==(n=f[e.handlerName])&&void 0!==n?n:[];return r.length>0?(0,p.jsx)(ae,{wrapperMeta:e,wrappers:r,isOpen:u===e.name,onOpen:function(e){m(u!==e?e:"")}},t):null}))})}):(0,p.jsx)(le,{})]})})),ce=n(44285),de=n(86677),ue=["onSuccess"];function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function he(e){var t=e.wrapperMeta,n=e.formState,a=e.tables,s=a.filter((function(e){return e.is_new_schema})).map((function(e){return"create schema if not exists ".concat(e.schema_name,";")})).join("\n"),i="\n    create foreign data wrapper ".concat(n.wrapper_name,"\n    handler ").concat(t.handlerName,"\n    validator ").concat(t.validatorName,";\n  "),l=t.server.options.filter((function(e){return e.encrypted})),o=t.server.options.filter((function(e){return!e.encrypted})),c=l.map((function(e){var t="".concat(n.wrapper_name,"_").concat(e.name),r=(n[e.name]||"").replace(/'/g,"''");return"\n      select pgsodium.create_key(\n        name := '".concat(t,"'\n      );\n\n      select vault.create_secret (\n        new_secret := '").concat(r,"',\n        new_name   := '").concat(t,"',\n        new_key_id := (select id from pgsodium.valid_key where name = '").concat(t,"')\n      );\n    ")})).join("\n"),d=l.map((function(e){return"".concat(e.name," ''%s''")})),u=o.map((function(e){return"".concat(e.name," ''").concat(n[e.name],"''")})),m=[].concat((0,ce.Z)(d),(0,ce.Z)(u)).join(","),p="\n    do $$\n    declare\n      ".concat(l.map((function(e){return"v_".concat(e.name," text;")})).join("\n"),"\n    begin\n      ").concat(l.map((function(e){return"select id into v_".concat(e.name," from pgsodium.valid_key where name = '").concat(n.wrapper_name,"_").concat(e.name,"' limit 1;")})).join("\n"),"\n    \n      execute format(\n        E'create server ").concat(n.server_name,"\\n'\n        '   foreign data wrapper ").concat(n.wrapper_name,"\\n'\n        '   options (\\n'\n        '     ").concat(m,"\\n'\n        '   );',\n        ").concat(l.map((function(e){return"v_".concat(e.name)})).join(",\n"),"\n      );\n    end $$;\n  "),h=a.map((function(e){var a=t.tables[e.index],s=e.columns.map((function(e){return a.availableColumns.find((function(t){return t.name===e}))})).filter(Boolean);return"\n        create foreign table ".concat(e.schema_name,".").concat(e.table_name," (\n          ").concat(s.map((function(e){return"".concat(e.name," ").concat(e.type)})).join(",\n          "),"\n        )\n        server ").concat(n.server_name,"\n        options (\n          ").concat(Object.entries(e).filter((function(e){var t=(0,r.Z)(e,1)[0];return"table_name"!==t&&"schema_name"!==t&&"columns"!==t&&"index"!==t})).map((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];return"".concat(n," '").concat(a,"'")})).join(",\n          "),"\n        );\n      ")})).join("\n\n");return"\n    ".concat(s,"\n\n    ").concat(i,"\n\n    ").concat(c,"\n\n    ").concat(p,"\n\n    ").concat(h,"\n  ")}function fe(e){return xe.apply(this,arguments)}function xe(){return(xe=(0,x.Z)(j().mark((function e(t){var n,r,a,s,i,l,o,c;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,a=t.wrapperMeta,s=t.formState,i=t.tables,l=K(he({wrapperMeta:a,formState:s,tables:i})),e.next=4,(0,L.Rj)({projectRef:n,connectionString:r,sql:l});case 4:return o=e.sent,c=o.result,e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=(0,w.Z)(e,ue),r=(0,M.NL)(),a=(0,d.oR)(),s=a.vault;return(0,U.D)((function(e){return fe(e)}),pe({onSuccess:function(e,n,a){return(0,x.Z)(j().mark((function i(){var l;return j().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return l=n.projectRef,i.next=3,Promise.all([r.invalidateQueries(H.M.query(l,["fdws"]),{refetchType:"all"}),s.load()]);case 3:return i.next=5,null===t||void 0===t?void 0:t(e,n,a);case 5:case"end":return i.stop()}}),i)})))()}},n))},be=function(e){var t,n,r,s=e.option,l=e.loading,o=e.error,c=(0,a.useState)(!s.hidden),d=c[0],u=c[1];return s.isTextArea?(0,p.jsx)("div",{className:"text-area-text-sm text-area-resize-none",children:(0,p.jsx)(i.IIB.TextArea,{rows:6,error:o,className:"input-mono",disabled:l,id:s.name,name:s.name,label:(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("p",{children:s.label}),void 0!==s.urlHelper&&(0,p.jsx)(B.default,{href:s.urlHelper,children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(i.Sus,{strokeWidth:2,size:14,className:"text-scale-1000 hover:text-scale-1200 cursor-pointer transition"})})})]}),value:l?"Fetching value from Vault...":void 0,defaultValue:null!==(t=s.defaultValue)&&void 0!==t?t:"",required:null!==(n=s.required)&&void 0!==n&&n},s.name)}):(0,p.jsx)(i.IIB,{id:s.name,name:s.name,label:(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("p",{children:s.label}),void 0!==s.urlHelper&&(0,p.jsx)(B.default,{href:s.urlHelper,children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(i.Sus,{strokeWidth:2,size:14,className:"text-scale-1000 hover:text-scale-1200 cursor-pointer transition"})})})]}),defaultValue:null!==(r=s.defaultValue)&&void 0!==r?r:"",error:o,value:l?"Fetching value from Vault...":void 0,type:!s.hidden||l||d?"text":"password",disabled:l,actions:l?(0,p.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,p.jsx)(i.zxk,{disabled:!0,type:"default",icon:(0,p.jsx)(i.pAw,{className:"animate-spin"})})}):s.hidden?(0,p.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,p.jsx)(i.zxk,{type:"default",icon:d?(0,p.jsx)(i.tCy,{}):(0,p.jsx)(i.Jib,{}),onClick:function(){return u(!d)}})}):null},s.name)},je=function(e){return function(t){var n=new Set(e.filter((function(e){return e.required})).map((function(e){return e.name})));return Object.fromEntries(Object.entries(t).filter((function(e){var t=(0,r.Z)(e,2),a=t[0],s=t[1];return n.has(a)&&(Array.isArray(s)?s.length<1:!s)})).map((function(e){var t=(0,r.Z)(e,1)[0];return"table_name"===t?[t,"Please provide a name for your table"]:"columns"===t?[t,"Please select at least one column"]:[t,"This field is required"]})))}},ge=function(e){return e.map((function(e,t){var n=e.options.find((function(e){return e.startsWith("object=")})),r=void 0!==n?n.split("=")[1]:void 0;return{index:t,columns:e.columns.map((function(e){return e.name})),is_new_schema:!1,object:r,schema:e.schema,schema_name:e.schema,table_name:e.name}}))},ye=n(3305);function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ke=function(e){var t=e.visible,n=e.onCancel,r=e.onSave,s=e.tables,l=e.initialData,o=(0,a.useState)(""),c=o[0],d=o[1];(0,a.useEffect)((function(){l&&d(String(l.index))}),[l]);var u=""===c?void 0:s[parseInt(c)],m=function(){d(""),n()};return(0,p.jsx)(i.hsB,{size:"medium",visible:t,onCancel:m,header:(0,p.jsx)("span",{children:"Edit foreign table"}),customFooter:(0,p.jsx)(ye.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",formId:"wrapper-table-editor-form",closePanel:m}),children:(0,p.jsx)(i.hsB.Content,{children:(0,p.jsxs)("div",{className:"mt-4 space-y-6",children:[(0,p.jsxs)(i.RiT,{label:"Select a target the table will point to",value:c,onChange:function(e){return d(e)},children:[(0,p.jsx)(i.RiT.Option,{value:"",label:"---",children:"---"},"empty"),s.map((function(e,t){return(0,p.jsx)(i.RiT.Option,{className:"group",value:String(t),label:e.label,children:(0,p.jsxs)("div",{className:"space-y-1",children:[(0,p.jsx)("p",{children:e.label}),(0,p.jsx)("p",{className:"opacity-50",children:e.description})]})},String(t))}))]}),u&&(0,p.jsx)(_e,{table:u,onSubmit:function(e,t){var n=t.resetForm;r(we(we({},e),{},{index:parseInt(c),schema_name:"custom"===e.schema?e.schema_name:e.schema,is_new_schema:"custom"===e.schema})),n(),d("")},initialData:l})]})})},"WrapperTableEditor")},Se=function(e){var t,n,r=e.option;return(0,p.jsx)(i.IIB,{id:r.name,name:r.name,label:r.label,placeholder:null!==(t=r.placeholder)&&void 0!==t?t:"",defaultValue:null!==(n=r.defaultValue)&&void 0!==n?n:""},r.name)},_e=function(e){var t,n,r=e.table,a=e.onSubmit,s=e.initialData,l=(0,d.oR)().meta.schemas.list(),o=null!==(t=r.options.filter((function(e){return e.editable&&e.required&&!e.defaultValue})))&&void 0!==t?t:[],c=null!==(n=r.options.filter((function(e){return e.editable&&(!e.required||e.defaultValue)})))&&void 0!==n?n:[],u=null!==s&&void 0!==s?s:we(we({table_name:"",columns:r.availableColumns.map((function(e){return e.name}))},Object.fromEntries(r.options.map((function(e){var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]})))),{},{schema:"public",schema_name:""}),m=je([].concat((0,ce.Z)(r.options),[{name:"table_name",required:!0},{name:"columns",required:!0}]));return(0,p.jsx)(i.l09,{id:"wrapper-table-editor-form",initialValues:u,validate:m,onSubmit:a,enableReinitialize:!0,children:function(e){var t=e.errors,n=e.values,a=e.resetForm;return(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)(i.RiT,{size:"small",name:"schema",label:"Select a schema for the foreign table",children:[(0,p.jsx)(i.RiT.Option,{id:"custom",label:"Create a new schema",value:"custom",addOnBefore:function(){return(0,p.jsx)(i.SC9,{size:16,strokeWidth:1.5})},children:"Create a new schema"},"custom"),(0,p.jsx)(i.u_l.Separator,{}),l.map((function(e){return(0,p.jsx)(i.RiT.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:function(){return(0,p.jsx)(i.OQ8,{size:16,strokeWidth:1.5})},children:e.name},e.id)}))]}),"custom"===n.schema&&(0,p.jsx)(i.IIB,{id:"schema_name",name:"schema_name",label:"Schema name"}),(0,p.jsx)(i.IIB,{id:"table_name",name:"table_name",label:"Table name",descriptionText:"You can query from this table after the wrapper is enabled."}),o.map((function(e){return(0,p.jsx)(Se,{option:e},e.name)})),(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("label",{className:"!w-full",children:"Select the columns to be added to your table"}),(0,p.jsx)("div",{className:"flex flex-wrap gap-2",children:r.availableColumns.map((function(e){var t=n.columns.includes(e.name);return(0,p.jsx)("div",{className:["px-2 py-1 bg-scale-500 rounded cursor-pointer transition","".concat(t?"bg-brand-800":"hover:bg-scale-700")].join(" "),onClick:function(){a(t?{values:we(we({},n),{},{columns:n.columns.filter((function(t){return t!==e.name}))})}:{values:we(we({},n),{},{columns:n.columns.concat([e.name])})})},children:(0,p.jsx)("p",{className:"text-sm",children:e.name})},e.name)}))}),t.columns&&(0,p.jsx)("span",{className:"text-red-900 text-sm mt-2",children:t.columns})]}),c.map((function(e){return(0,p.jsx)(Se,{option:e},e.name)}))]})}})};function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ze=(0,s.Pi)((function(){var e="create-wrapper-form",t=(0,de.useRouter)(),n=(0,d.oR)().ui,r=(0,d.UO)(),s=r.ref,o=r.type,u=(0,ne.d2)().project,m=ve().mutateAsync,h=(0,a.useState)([]),f=h[0],v=h[1],b=(0,a.useState)(!1),g=b[0],N=b[1],w=(0,a.useState)(),k=w[0],S=w[1],_=(0,a.useState)({}),C=_[0],O=_[1],Z=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),T=q.find((function(e){return e.name===o})),E=void 0!==T?Oe({wrapper_name:"",server_name:""},Object.fromEntries(T.server.options.map((function(e){var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]})))):{};if(void 0===T)return(0,p.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,p.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,p.jsx)("p",{children:"Unsupported wrapper type"}),(0,p.jsxs)("p",{className:"text-sm text-center text-scale-1000",children:["The wrapper type ",o," not supported by the dashboard. Head back to create a different wrapper."]})]}),(0,p.jsx)(B.default,{href:"/project/".concat(s,"/database/wrappers"),children:(0,p.jsx)("a",{children:(0,p.jsx)(i.zxk,{type:"default",children:"Head back"})})})]});var P=function(){var e=(0,x.Z)(j().mark((function e(r,a){var i,o,c,d;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.setSubmitting,o=je(T.server.options),c=o(r),0===(d=r.wrapper_name).length&&(c.name="Please provide a name for your wrapper"),0===f.length&&(c.tables="Please add at least one table"),(0,l.isEmpty)(c)){e.next=8;break}return e.abrupt("return",O(c));case 8:return i(!0),e.prev=9,e.next=12,m({projectRef:null===u||void 0===u?void 0:u.ref,connectionString:null===u||void 0===u?void 0:u.connectionString,wrapperMeta:T,formState:Oe(Oe({},r),{},{server_name:"".concat(d,"_server")}),tables:f});case 12:n.setNotification({category:"success",message:"Successfully created ".concat(T.label," foreign data wrapper")}),v([]),t.push("/project/".concat(s,"/database/wrappers")),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(9),n.setNotification({error:e.t0,category:"error",message:"Failed to create ".concat(T.label," foreign data wrapper: ").concat(e.t0.message)});case 20:return e.prev=20,i(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[9,17,20,23]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,p.jsxs)(y.ld,{children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,p.jsx)("div",{className:["transition cursor-pointer","absolute -left-20 top-1 opacity-75 hover:opacity-100"].join(" "),children:(0,p.jsx)(B.default,{href:"/project/".concat(s,"/database/wrappers"),children:(0,p.jsx)("a",{children:(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(i.D6v,{strokeWidth:1.5,size:14}),(0,p.jsx)("p",{className:"text-sm",children:"Back"})]})})})}),(0,p.jsxs)("h3",{className:"mb-2 text-xl text-scale-1200",children:["Create a ",null===T||void 0===T?void 0:T.label," Wrapper"]}),(0,p.jsx)("div",{className:"flex items-center space-x-2",children:(0,p.jsx)(B.default,{href:"https://supabase.github.io/wrappers/stripe/",children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(i.zxk,{type:"default",icon:(0,p.jsx)(i.TqL,{strokeWidth:1.5}),children:"Documentation"})})})})]}),(0,p.jsx)(i.l09,{id:e,initialValues:E,onSubmit:P,children:function(t){var n,r=t.isSubmitting,a=t.handleReset,s=t.values,l=t.initialValues,o=JSON.stringify(s)!==JSON.stringify(l);return(0,p.jsxs)(y.by,{disabled:!Z,footer:(0,p.jsx)("div",{className:"flex px-8 py-4",children:(0,p.jsx)(y.iN,{form:e,isSubmitting:r,hasChanges:o,handleReset:a,disabled:!Z,helper:Z?void 0:"You need additional permissions to create a foreign data wrapper"})}),children:[(0,p.jsx)(y.hj,{header:(0,p.jsx)(y.S0,{children:"Wrapper Configuration"}),children:(0,p.jsx)(y.B4,{loading:!1,children:(0,p.jsx)(i.IIB,{id:"wrapper_name",label:"Wrapper Name",error:C.wrapper_name,descriptionText:(null!==(n=null===s||void 0===s?void 0:s.wrapper_name)&&void 0!==n?n:"").length>0?(0,p.jsxs)(p.Fragment,{children:["Your wrapper's server name will be"," ",(0,p.jsxs)("code",{className:"text-xs",children:[s.wrapper_name,"_server"]})]}):""})})}),(0,p.jsx)(y.hj,{header:(0,p.jsxs)(y.S0,{children:[T.label," Configuration"]}),children:(0,p.jsx)(y.B4,{loading:!1,children:T.server.options.map((function(e){return(0,p.jsx)(be,{option:e,loading:!1,error:C[e.name]},e.name)}))})}),(0,p.jsx)(y.hj,{header:(0,p.jsxs)(y.S0,{children:[(0,p.jsx)("p",{children:"Foreign Tables"}),(0,p.jsx)("p",{className:"text-scale-1000 mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,p.jsxs)(y.B4,{loading:!1,children:[0===f.length?(0,p.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,p.jsx)(i.zxk,{type:"default",onClick:function(){return N(!0)},children:"Add foreign table"})}):(0,p.jsx)("div",{className:"space-y-2",children:f.map((function(e,t){return(0,p.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-scale-600",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,p.jsxs)("p",{className:"text-sm text-scale-1000",children:[T.tables[e.index].label,": ",e.columns.join(", ")]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(i.zxk,{type:"default",className:"px-1",icon:(0,p.jsx)(i.yl5,{}),onClick:function(){N(!0),S(Oe(Oe({},e),{},{tableIndex:t}))}}),(0,p.jsx)(i.zxk,{type:"default",className:"px-1",icon:(0,p.jsx)(i.IT9,{}),onClick:function(){v((function(e){return e.filter((function(e,n){return n!==t}))}))}})]})]})}))}),f.length>0&&(0,p.jsx)("div",{className:"flex justify-end",children:(0,p.jsx)(i.zxk,{type:"default",onClick:function(){return N(!0)},children:"Add foreign table"})}),0===f.length&&C.tables&&(0,p.jsx)("p",{className:"text-sm text-right text-red-900",children:C.tables})]})})]})}})]}),(0,p.jsx)(ke,{visible:g,tables:T.tables,onCancel:function(){S(void 0),N(!1)},onSave:function(e){v((function(t){if(void 0!==e.tableIndex){var n=e.tableIndex,r=(0,ce.Z)(t);return delete e.tableIndex,r[n]=e,r}return[].concat((0,ce.Z)(t),[e])})),N(!1),S(void 0)},initialData:k})]})})),Te=["onSuccess"];function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fe=function(e){var t=e.wrapper,n=e.wrapperMeta,r=e.formState,a=e.tables,s=$({wrapper:t,wrapperMeta:n}),i=he({wrapperMeta:n,formState:r,tables:a});return"\n    ".concat(s,"\n\n    ").concat(i,"\n  ")};function Re(e){return ze.apply(this,arguments)}function ze(){return(ze=(0,x.Z)(j().mark((function e(t){var n,r,a,s,i,l,o,c,d;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.projectRef,r=t.connectionString,a=t.wrapper,s=t.wrapperMeta,i=t.formState,l=t.tables,n){e.next=3;break}throw new Error("projectRef is required");case 3:return o=K(Fe({wrapper:a,wrapperMeta:s,formState:i,tables:l})),e.next=6,(0,L.Rj)({projectRef:n,connectionString:r,sql:o});case 6:return c=e.sent,d=c.result,e.abrupt("return",d);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=(0,w.Z)(e,Te),r=(0,M.NL)(),a=(0,d.oR)(),s=a.vault;return(0,U.D)((function(e){return Re(e)}),Pe({onSuccess:function(e,n,a){return(0,x.Z)(j().mark((function i(){var l;return j().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return l=n.projectRef,i.next=3,Promise.all([r.invalidateQueries(H.M.query(l,["fdws"])),s.load()]);case 3:return i.next=5,null===t||void 0===t?void 0:t(e,n,a);case 5:case"end":return i.stop()}}),i)})))()}},n))},De=n(97588);function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve=(0,s.Pi)((function(){var e,t,n,s="edit-wrapper-form",o=(0,de.useRouter)(),u=(0,d.oR)(),m=u.ui,h=u.vault,f=(0,d.UO)(),v=f.ref,b=f.id,g=(0,ne.d2)().project,w=W({projectRef:null===g||void 0===g?void 0:g.ref,connectionString:null===g||void 0===g?void 0:g.connectionString}),k=w.data,S=w.isLoading,_=(null!==(e=null===k||void 0===k?void 0:k.result)&&void 0!==e?e:[]).find((function(e){return Number(e.id)===Number(b)})),C=(0,d.Je)(_),O=q.find((function(e){return e.handlerName===(null===C||void 0===C?void 0:C.handler)})),Z=Ie(),T=Z.mutateAsync,E=Z.isLoading,P=(0,a.useState)([]),F=P[0],R=P[1],z=(0,a.useState)(!1),I=z[0],D=z[1],A=(0,a.useState)(),V=A[0],L=A[1],Y=(0,a.useState)({}),M=Y[0],U=Y[1],H=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),K=void 0!==O?Be({wrapper_name:null===C||void 0===C?void 0:C.name,server_name:null===C||void 0===C?void 0:C.server_name},(n=null!==(t=null===C||void 0===C?void 0:C.server_options)&&void 0!==t?t:[],Object.fromEntries(n.map((function(e){return e.split("=")}))))):{};if((0,a.useEffect)((function(){var e;null!==C&&void 0!==C&&C.id&&R(ge(null!==(e=null===C||void 0===C?void 0:C.tables)&&void 0!==e?e:[]))}),[null===C||void 0===C?void 0:C.id]),S)return(0,p.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,p.jsx)(De.Z,{})});if(void 0===C||void 0===O)return E?(0,p.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:(0,p.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,p.jsx)(i.pAw,{className:"animate-spin",size:16}),(0,p.jsx)("p",{className:"text-sm",children:"Updating wrapper"})]})}):(0,p.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,p.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,p.jsx)("p",{children:"Unknown wrapper"}),(0,p.jsxs)("p",{className:"text-sm text-center text-scale-1000",children:["The wrapper ID ",b," cannot be found in your project. Head back to select another wrapper."]})]}),(0,p.jsx)(B.default,{href:"/project/".concat(v,"/database/wrappers"),children:(0,p.jsx)("a",{children:(0,p.jsx)(i.zxk,{type:"default",children:"Head back"})})})]});var Q=function(){var e=(0,x.Z)(j().mark((function e(t,n){var r,a,s,i;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.setSubmitting,a=je(O.server.options),s=a(t),0===(i=t.wrapper_name).length&&(s.name="Please provide a name for your wrapper"),0===F.length&&(s.tables="Please add at least one table"),(0,l.isEmpty)(s)){e.next=8;break}return e.abrupt("return",U(s));case 8:return r(!0),e.prev=9,e.next=12,T({projectRef:null===g||void 0===g?void 0:g.ref,connectionString:null===g||void 0===g?void 0:g.connectionString,wrapper:C,wrapperMeta:O,formState:Be(Be({},t),{},{server_name:"".concat(i,"_server")}),tables:F});case 12:m.setNotification({category:"success",message:"Successfully updated ".concat(O.label," foreign data wrapper")}),R([]),o.push("/project/".concat(v,"/database/wrappers")),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(9),m.setNotification({error:e.t0,category:"error",message:"Failed to create ".concat(O.label," foreign data wrapper: ").concat(e.t0.message)});case 20:return e.prev=20,r(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[9,17,20,23]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,p.jsxs)(y.ld,{children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,p.jsx)("div",{className:["transition cursor-pointer","absolute -left-20 top-1 opacity-75 hover:opacity-100"].join(" "),children:(0,p.jsx)(B.default,{href:"/project/".concat(v,"/database/wrappers"),children:(0,p.jsx)("a",{children:(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(i.D6v,{strokeWidth:1.5,size:14}),(0,p.jsx)("p",{className:"text-sm",children:"Back"})]})})})}),(0,p.jsxs)("h3",{className:"mb-2 text-xl text-scale-1200",children:["Edit wrapper: ",C.name]}),(0,p.jsx)("div",{className:"flex items-center space-x-2",children:(0,p.jsx)(B.default,{href:"https://supabase.github.io/wrappers/stripe/",children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(i.zxk,{type:"default",icon:(0,p.jsx)(i.TqL,{strokeWidth:1.5}),children:"Documentation"})})})})]}),(0,p.jsx)(i.l09,{id:s,initialValues:K,onSubmit:Q,children:function(e){var t,n=e.isSubmitting,l=e.handleReset,o=e.values,c=e.initialValues,d=e.resetForm,u=(0,a.useState)(!1),m=u[0],f=u[1],v=ge(null!==(t=null===C||void 0===C?void 0:C.tables)&&void 0!==t?t:[]),b=JSON.stringify(o)!==JSON.stringify(c),g=JSON.stringify(v)!==JSON.stringify(F),w=b||g,k=O.server.options.filter((function(e){return e.encrypted}));return(0,a.useEffect)((function(){var e=function(){var e=(0,x.Z)(j().mark((function e(){var t,n;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),e.next=3,Promise.all(k.map(function(){var e=(0,x.Z)(j().mark((function e(t){var n,a,s,i;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.listSecrets((function(e){return e.name==="".concat(C.name,"_").concat(t.name)})),a=(0,r.Z)(n,1),void 0===(s=a[0])){e.next=8;break}return e.next=4,h.fetchSecretValue(s.id);case 4:return i=e.sent,e.abrupt("return",(0,N.Z)({},t.name,i));case 8:return e.abrupt("return",(0,N.Z)({},t.name,""));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:t=e.sent,n=t.reduce((function(e,t){var n=Object.keys(t),a=(0,r.Z)(n,1)[0];return Be(Be({},e),{},(0,N.Z)({},a,t[a]))}),{}),d({values:Be(Be({},o),n),initialValues:Be(Be({},c),n)}),f(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();k.length>0&&e()}),[]),(0,p.jsxs)(y.by,{disabled:!H,footer:(0,p.jsx)("div",{className:"flex px-8 py-4",children:(0,p.jsx)(y.iN,{form:s,isSubmitting:n,hasChanges:w,handleReset:function(){l(),R(v)},disabled:!H,helper:H?void 0:"You need additional permissions to edit a foreign data wrapper"})}),children:[(0,p.jsx)(y.hj,{header:(0,p.jsx)(y.S0,{children:"Wrapper Configuration"}),children:(0,p.jsx)(y.B4,{loading:!1,children:(0,p.jsx)(i.IIB,{id:"wrapper_name",label:"Wrapper Name",error:M.wrapper_name,descriptionText:o.wrapper_name!==c.wrapper_name?(0,p.jsxs)(p.Fragment,{children:["Your wrapper's server name will be updated to"," ",(0,p.jsxs)("code",{className:"text-xs",children:[o.wrapper_name,"_server"]})]}):(0,p.jsxs)(p.Fragment,{children:["Your wrapper's server name is"," ",(0,p.jsxs)("code",{className:"text-xs",children:[o.wrapper_name,"_server"]})]})})})}),(0,p.jsx)(y.hj,{header:(0,p.jsxs)(y.S0,{children:[O.label," Configuration"]}),children:(0,p.jsx)(y.B4,{loading:!1,children:O.server.options.map((function(e){return(0,p.jsx)(be,{option:e,loading:!!e.encrypted&&m,error:M[e.name]},e.name)}))})}),(0,p.jsx)(y.hj,{header:(0,p.jsxs)(y.S0,{children:[(0,p.jsx)("p",{children:"Foreign Tables"}),(0,p.jsx)("p",{className:"text-scale-1000 mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,p.jsxs)(y.B4,{loading:!1,children:[0===F.length?(0,p.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,p.jsx)(i.zxk,{type:"default",onClick:function(){return D(!0)},children:"Add foreign table"})}):(0,p.jsx)("div",{className:"space-y-2",children:F.map((function(e,t){return(0,p.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-scale-600",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,p.jsxs)("p",{className:"text-sm text-scale-1000",children:[O.tables[e.index].label,": ",e.columns.join(", ")]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(i.zxk,{type:"default",className:"px-1",icon:(0,p.jsx)(i.yl5,{}),onClick:function(){D(!0),L(Be(Be({},e),{},{tableIndex:t}))}}),(0,p.jsx)(i.zxk,{type:"default",className:"px-1",icon:(0,p.jsx)(i.IT9,{}),onClick:function(){R((function(e){return e.filter((function(e,n){return n!==t}))}))}})]})]})}))}),F.length>0&&(0,p.jsx)("div",{className:"flex justify-end",children:(0,p.jsx)(i.zxk,{type:"default",onClick:function(){return D(!0)},children:"Add foreign table"})}),0===F.length&&M.tables&&(0,p.jsx)("p",{className:"text-sm text-right text-red-900",children:M.tables})]})})]})}})]}),(0,p.jsx)(ke,{visible:I,tables:O.tables,onCancel:function(){L(void 0),D(!1)},onSave:function(e){R((function(t){if(void 0!==e.tableIndex){var n=e.tableIndex,r=(0,ce.Z)(t);return delete e.tableIndex,r[n]=e,r}return[].concat((0,ce.Z)(t),[e])})),D(!1),L(void 0)},initialData:V})]})})),Le=(0,s.Pi)((function(e){var t=e.onSelectPublication,n=void 0===t?function(){}:t,r=(0,d.oR)(),s=r.ui,l=r.meta,o=(0,a.useState)(""),h=o[0],f=o[1],v=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"publications"),b=[{event:"Insert",key:"publish_insert"},{event:"Update",key:"publish_update"},{event:"Delete",key:"publish_delete"},{event:"Truncate",key:"publish_truncate"}],g=0===h.length?l.publications.list():l.publications.list((function(e){return e.name.includes(h)})),y=function(){var e=(0,x.Z)(j().mark((function e(t,n,r){var a;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=r?"stop":"start",(0,re._)({title:"Confirm",message:"Are you sure you want to ".concat(a," sending ").concat(n," events for ").concat(t.name,"?"),onAsyncConfirm:function(){var e=(0,x.Z)(j().mark((function e(){var a,i,o,c;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(a={id:t.id})["publish_".concat(n)]=!r,e.next=5,l.publications.update(t.id,a);case 5:if(i=e.sent,o=i.data,!(c=i.error)){e.next=12;break}throw c;case 12:return e.abrupt("return",o);case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(0),s.setNotification({category:"error",message:"Failed to toggle for ".concat(t.name,": ").concat(e.t0.message)}),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}()});case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"mb-4",children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsx)("div",{className:"flex items-center",children:(0,p.jsx)(i.IIB,{size:"small",icon:(0,p.jsx)(i.jVj,{size:"tiny"}),placeholder:"Filter",value:h,onChange:function(e){return f(e.target.value)}})}),!v&&(0,p.jsx)("div",{className:"w-[500px]",children:(0,p.jsx)(A.Z,{icon:(0,p.jsx)(i.Ldj,{className:"text-scale-1100",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),0===g.length?(0,p.jsx)(m.Z,{}):(0,p.jsx)("div",{className:"overflow-hidden rounded",children:(0,p.jsx)(u.Z,{head:[(0,p.jsx)(u.Z.th,{children:"Name"},"header.name"),(0,p.jsx)(u.Z.th,{className:"hidden lg:table-cell",children:"System ID"},"header.id"),(0,p.jsx)(u.Z.th,{className:"text-center",children:"Insert"},"header.insert"),(0,p.jsx)(u.Z.th,{className:"text-center",children:"Update"},"header.update"),(0,p.jsx)(u.Z.th,{className:"text-center",children:"Delete"},"header.delete"),(0,p.jsx)(u.Z.th,{className:"text-center",children:"Truncate"},"header.truncate"),(0,p.jsx)(u.Z.th,{className:"text-right",children:"Source"},"header.source")],body:g.map((function(e,t){return(0,p.jsxs)(u.Z.tr,{className:"border-t ",children:[(0,p.jsx)(u.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:e.name}),(0,p.jsx)(u.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:e.id}),b.map((function(t){return(0,p.jsx)(u.Z.td,{children:(0,p.jsx)("div",{className:"flex justify-center",children:(0,p.jsx)(i.ZDl,{size:"tiny",checked:e[t.key],disabled:!v,onChange:function(){return y(e,t.event.toLowerCase(),e[t.key])}})})},t.key)})),(0,p.jsx)(u.Z.td,{className:"px-4 py-3 pr-2",children:(0,p.jsx)("div",{className:"flex justify-end gap-2",children:(0,p.jsx)(i.zxk,{type:"default",style:{paddingTop:3,paddingBottom:3},onClick:function(){return n(e.id)},children:null==e.tables?"All tables":"".concat(e.tables.length," ").concat(e.tables.length>1||0==e.tables.length?"tables":"table")})})})]},e.name)}))})})]})})),We=(0,s.Pi)((function(e){var t,n=e.table,r=e.selectedPublication,s=(0,d.oR)(),l=s.ui,o=s.meta,m=null==r.tables,h=(0,a.useState)(!1),f=h[0],v=h[1],b=(0,a.useState)(void 0!=(null===(t=r.tables)||void 0===t?void 0:t.find((function(e){return e.id==n.id})))),g=b[0],y=b[1],N=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"publications"),w=function(){var e=(0,x.Z)(j().mark((function e(t,n){var r,a,s,i,c,d,u,m,p;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g,y(!g),v(!0),s=null!==(r=null===n||void 0===n?void 0:n.tables)&&void 0!==r?r:[],i=s.some((function(e){return e.id==t.id})),c=i?s.filter((function(e){return e.id!=t.id})).map((function(e){return"".concat(e.schema,".").concat(e.name)})):["".concat(t.schema,".").concat(t.name)].concat(s.map((function(e){return"".concat(e.schema,".").concat(e.name)}))),e.prev=6,d=n.id,u={tables:c,id:d},e.next=11,o.publications.update(d,u);case 11:if(m=e.sent,!(p=m.error)){e.next=15;break}throw p;case 15:v(!1),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(6),l.setNotification({category:"error",message:"Failed to toggle replication for ".concat(t.name,": ").concat(e.t0.message)}),y(a),v(!1);case 23:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,p.jsxs)(u.Z.tr,{children:[(0,p.jsx)(u.Z.td,{className:"whitespace-nowrap",children:n.name}),(0,p.jsx)(u.Z.td,{className:"whitespace-nowrap",children:n.schema}),(0,p.jsx)(u.Z.td,{className:"hidden max-w-sm truncate whitespace-nowrap lg:table-cell",children:n.comment}),(0,p.jsx)(u.Z.td,{className:"px-4 py-3 pr-2",children:(0,p.jsx)("div",{className:"flex justify-end gap-2",children:m?(0,p.jsxs)(i.Cts,{color:"scale",children:[(0,p.jsx)("span",{children:"Enabled"}),(0,p.jsx)("span",{className:"hidden lg:inline-block",children:"\xa0for all tables"})]}):(0,p.jsx)(i.ZDl,{size:"tiny",align:"right",disabled:!N||f,className:"m-0 ml-2 mt-1 -mb-1 p-0",checked:g,onChange:function(){return w(n,r)}})})})]},n.id)})),qe=(0,s.Pi)((function(e){var t=e.selectedPublication,n=e.onSelectBack,r=(0,d.oR)().meta,s=(0,a.useState)(""),l=s[0],o=s[1],h=(0,d.FH)(c.KA.TENANT_SQL_ADMIN_WRITE,"publications"),f=0===l.length?r.tables.list((function(e){return!r.excludedSchemas.includes(e.schema)})):r.tables.list((function(e){return!r.excludedSchemas.includes(e.schema)&&e.name.includes(l)}));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"mb-4",children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,p.jsx)(i.zxk,{type:"outline",onClick:function(){return n()},icon:(0,p.jsx)(i.ed9,{}),style:{padding:"5px"}}),(0,p.jsx)("div",{children:(0,p.jsx)(i.IIB,{size:"small",placeholder:"Filter",value:l,onChange:function(e){return o(e.target.value)},icon:(0,p.jsx)(i.jVj,{size:"tiny"})})})]}),!h&&(0,p.jsx)("div",{className:"w-[500px]",children:(0,p.jsx)(A.Z,{icon:(0,p.jsx)(i.Ldj,{className:"text-scale-1100",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),0===f.length?(0,p.jsx)(m.Z,{}):(0,p.jsx)("div",{children:(0,p.jsx)(u.Z,{head:[(0,p.jsx)(u.Z.th,{children:"Name"},"header-name"),(0,p.jsx)(u.Z.th,{children:"Schema"},"header-schema"),(0,p.jsx)(u.Z.th,{className:"hidden text-left lg:table-cell",children:"Description"},"header-desc"),(0,p.jsx)(u.Z.th,{},"header-all")],body:f.map((function(e,n){return(0,p.jsx)(We,{table:e,selectedPublication:t},e.id)}))})})]})})),Ye=n(69497),Me=n(27693),Ue=n.n(Me),He=n(20796),Ke=n(14919),Qe=(0,s.Pi)((function(e){var t,n,r=e.projectRef,s=e.backup,l=e.index,o=(0,de.useRouter)(),u=(0,d.oR)(),m=u.app,h=u.ui,f=(0,a.useState)(!1),v=f[0],b=f[1],g=(0,a.useState)(!1),y=g[0],N=g[1],w=null!==(t=null===(n=h.selectedProject)||void 0===n?void 0:n.id)&&void 0!==t?t:-1,k=(0,d.FH)(c.KA.INFRA_EXECUTE,"queue_job.restore.prepare");function S(e){return _.apply(this,arguments)}function _(){return _=(0,x.Z)(j().mark((function e(t){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N(!0);try{(0,Ke.v_)("".concat(He.T5,"/database/").concat(r,"/backups/restore"),t).then((function(){setTimeout((function(){m.onProjectStatusUpdated(w,He.S.RESTORING),h.setNotification({category:"success",message:"Restoring database back to ".concat(Ue()(t.inserted_at).format("DD MMM YYYY HH:mm:ss"))}),o.push("/project/".concat(r))}),3e3)}))}catch(n){h.setNotification({error:n,category:"error",message:"You do not have permission to restore from this backup"}),N(!1)}case 2:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function C(){return C=(0,x.Z)(j().mark((function e(t){var n,a,s,i;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,e.next=4,(0,Ke.v_)("".concat(He.T5,"/database/").concat(r,"/backups/download"),t);case 4:return n=e.sent,e.next=7,n;case 7:a=e.sent,s=a.fileUrl,(i=document.createElement("a")).href=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),b(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),h.setNotification({error:e.t0,category:"error",message:"You do not have permission to download this backup"}),b(!1);case 21:case"end":return e.stop()}}),e,null,[[1,17]])}))),C.apply(this,arguments)}function O(){(0,re._)({title:"Confirm to restore",message:"Are you sure you want to restore from ".concat(Ue()(s.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."),onAsyncConfirm:function(){var e=(0,x.Z)(j().mark((function e(){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(s);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})}return(0,p.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(l?"border-t dark:border-dark":""),children:[(0,p.jsx)("p",{className:"text-sm text-scale-1200 ",children:Ue()(s.inserted_at).format("DD MMM YYYY HH:mm:ss")}),(0,p.jsx)("div",{className:"",children:function(e){return"COMPLETED"===e.status?(0,p.jsxs)("div",{className:"flex space-x-4",children:[e.data.canRestore&&(0,p.jsx)(i.zxk,{type:"default",disabled:!k||y||v,onClick:O,children:"Restore"}),(0,p.jsx)(i.zxk,{type:"default",disabled:!k||y||v,onClick:function(){return function(e){return C.apply(this,arguments)}(e)},loading:v,icon:(0,p.jsx)(i.DjJ,{}),children:"Download"})]}):(0,p.jsx)(i.Cts,{color:"yellow",children:"Backup In Progress..."})}(s)})]})})),Je=n(84427),Xe=n(33944),$e=(0,s.Pi)((function(e){var t;(0,v.Z)(e);var n=(0,d.oR)(),r=n.ui,a=n.backups,s=(null===(t=r.selectedProject)||void 0===t?void 0:t.ref)||"default",l=(0,d.FH)(c.KA.INFRA_EXECUTE,"queue_job.restore.prepare");if(a.isLoading)return(0,p.jsx)(De.Z,{});if(a.error)return(0,p.jsx)(Je.Z,{});var o=a.configuration.tierKey,u=a.list();return"FREE"===o?(0,p.jsx)(Ye.Z,{icon:(0,p.jsx)(i.joI,{size:"large"}),primaryText:"Free Plan does not include project backups.",projectRef:s,secondaryText:"Upgrade to the Pro plan for up to 7 days of scheduled backups."}):(0,p.jsx)("div",{className:"space-y-6",children:null!==u&&void 0!==u&&u.length||"FREE"===o?(0,p.jsxs)(p.Fragment,{children:[!l&&(0,p.jsx)(A.Z,{icon:(0,p.jsx)(i.Ldj,{className:"text-scale-1100",strokeWidth:2}),title:"You need additional permissions to trigger a scheduled backup"}),(0,p.jsx)(R.Z,{children:null===u||void 0===u?void 0:u.map((function(e,t){return(0,p.jsx)(Qe,{projectRef:s,backup:e,index:t},e.id)}))})]}):(0,p.jsx)(Xe.Z,{})})})),Ge=(n(94804),n(43350)),et=n(80040),tt=n(79588),nt=n(38480),rt=n(42356),at=n(78906),st=n(89744),it=function(){function e(){(0,Ge.Z)(this,e),(0,N.Z)(this,"triggerFunctions",[])}return(0,et.Z)(e,[{key:"functionSchemas",get:function(){return(0,l.map)((0,l.uniqBy)(this.triggerFunctions,"schema"),"schema")}}]),e}(),lt=(0,a.createContext)(null),ot=(0,s.Pi)((function(e){var t=e.triggerFunctions,n=e.visible,r=e.onChange,a=e.setVisible,l=(0,s.fv)((function(){return new it}));function o(e){r(e),a(!n)}l.triggerFunctions=t;var c=l.triggerFunctions.length>=1;return(0,p.jsx)(i.hsB,{size:"large",header:"Pick a function",visible:n,onCancel:function(){return a(!n)},className:"hooks-sidepanel",children:c?(0,p.jsx)(lt.Provider,{value:l,children:(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsx)(ct,{}),l.functionSchemas.map((function(e){return(0,p.jsx)(ut,{schema:e,selectFunction:o},e)}))]})}):(0,p.jsx)(dt,{})})})),ct=function(e){(0,v.Z)(e);var t=(0,de.useRouter)(),n=t.query.ref;return(0,p.jsx)("div",{className:"px-6",children:(0,p.jsx)(A.Z,{icon:(0,p.jsx)(i.Sus,{size:"large",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,p.jsx)(i.zxk,{type:"secondary",onClick:function(){t.push("/project/".concat(n,"/database/functions"))},children:"Go to Functions"})})})},dt=function(e){(0,v.Z)(e);var t=(0,de.useRouter)(),n=t.query.ref;return(0,p.jsx)(st.Z,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:function(){t.push("/project/".concat(n,"/database/functions"))},children:(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"You will need to create a trigger based function before you can add it to your trigger."})})},ut=(0,s.Pi)((function(e){var t=e.schema,n=e.selectFunction,r=(0,a.useContext)(lt).triggerFunctions.filter((function(e){return e.schema==t}));return(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,p.jsx)("h5",{className:"text-scale-1000",children:"schema"}),(0,p.jsx)("h5",{children:t})]}),(0,p.jsx)("div",{className:"space-y-0 divide-y border-t border-b dark:divide-dark dark:border-dark",children:r.map((function(e){return(0,p.jsx)(mt,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:n},e.id)}))})]})})),mt=function(e){var t=e.id,n=e.completeStatement,r=e.name,s=e.onClick,l=(0,a.useState)(!1),o=l[0],c=l[1];return(0,p.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-bg-alt-light dark:hover:bg-bg-alt-dark",onClick:function(){return s(t)},children:[(0,p.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,p.jsx)("div",{className:"flex items-center justify-center rounded bg-scale-1200 p-1 text-scale-100 ",children:(0,p.jsx)(i.Chd,{strokeWidth:2,size:14})}),(0,p.jsx)("h5",{className:"mb-0",children:r})]}),(0,p.jsx)(i.zxk,{type:"text",onClick:function(e){e.stopPropagation(),c(!o)},icon:(0,p.jsx)(i.C26,{className:o?"rotate-0 transform":"rotate-180 transform"}),children:o?"Hide definition":"View definition"})]}),(0,p.jsx)(rt.u,{show:o,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,p.jsx)("div",{className:"mt-4 h-64 border dark:border-dark",children:(0,p.jsx)(at.Z,{defaultValue:n,readOnly:!0,contextmenu:!1})})})]})},pt=function(e){var t=e.icon,n=e.text;return(0,p.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2",children:[(0,p.jsx)("div",{className:"relative bg-scale-300 text-scale-900 w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,p.jsx)("p",{className:"text-scale-1000",children:n})]})},ht=n(95439);function ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vt=function(){function e(){(0,Ge.Z)(this,e),(0,N.Z)(this,"id",void 0),(0,N.Z)(this,"originalName",void 0),(0,N.Z)(this,"activation",void 0),(0,N.Z)(this,"enabledMode",void 0),(0,N.Z)(this,"events",void 0),(0,N.Z)(this,"functionName",void 0),(0,N.Z)(this,"functionSchema",void 0),(0,N.Z)(this,"orientation",void 0),(0,N.Z)(this,"name",void 0),(0,N.Z)(this,"schema",void 0),(0,N.Z)(this,"table",void 0),(0,N.Z)(this,"tableId",void 0),(0,tt.ky)(this),this.reset()}return(0,et.Z)(e,[{key:"requestBody",get:function(){return{id:this.id,activation:this.activation.value,enabled_mode:this.enabledMode.value,events:this.events.value,function_name:this.functionName.value,function_schema:this.functionSchema.value,orientation:this.orientation.value,name:this.name.value,schema:this.schema.value,table:this.table.value}}},{key:"reset",value:function(e){var t,n,r,a,s,i,l,o,c,d;this.id=null===e||void 0===e?void 0:e.id,this.originalName=null===e||void 0===e?void 0:e.name,this.activation={value:null!==(t=null===e||void 0===e?void 0:e.activation)&&void 0!==t?t:"BEFORE"},this.enabledMode={value:null!==(n=null===e||void 0===e?void 0:e.enabled_mode)&&void 0!==n?n:"ORIGIN"},this.events={value:null!==(r=null===e||void 0===e?void 0:e.events)&&void 0!==r?r:[]},this.functionName={value:null!==(a=null===e||void 0===e?void 0:e.function_name)&&void 0!==a?a:""},this.functionSchema={value:null!==(s=null===e||void 0===e?void 0:e.function_schema)&&void 0!==s?s:""},this.orientation={value:null!==(i=null===e||void 0===e?void 0:e.orientation)&&void 0!==i?i:"STATEMENT"},this.name={value:null!==(l=null===e||void 0===e?void 0:e.name)&&void 0!==l?l:""},this.schema={value:null!==(o=null===e||void 0===e?void 0:e.schema)&&void 0!==o?o:""},this.table={value:null!==(c=null===e||void 0===e?void 0:e.table)&&void 0!==c?c:""},this.tableId={value:null!==(d=null===e||void 0===e?void 0:e.table_id)&&void 0!==d?d:""}}},{key:"update",value:function(e){this.activation=e.activation,this.enabledMode=e.enabledMode,this.events=e.events,this.functionName=e.functionName,this.functionSchema=e.functionSchema,this.orientation=e.orientation,this.name=e.name,this.schema=e.schema,this.table=e.table,this.tableId=e.tableId}}]),e}(),bt=function(){function e(){var t=this;(0,Ge.Z)(this,e),(0,N.Z)(this,"chooseFunctionFormVisible",!1),(0,N.Z)(this,"loading",!1),(0,N.Z)(this,"formState",new vt),(0,N.Z)(this,"meta",null),(0,N.Z)(this,"tables",[]),(0,N.Z)(this,"triggerFunctions",[]),(0,N.Z)(this,"setChooseFunctionFormVisible",(function(e){t.chooseFunctionFormVisible=e})),(0,N.Z)(this,"setDefaultSelectedTable",(function(){var e;0!=(null===(e=t.tables)||void 0===e?void 0:e.length)&&(t.formState.table.value=t.tables[0].name,t.formState.schema.value=t.tables[0].schema,t.formState.tableId.value=t.tables[0].id)})),(0,N.Z)(this,"setLoading",(function(e){t.loading=e})),(0,N.Z)(this,"setTables",(function(e){t.tables=e,t.setDefaultSelectedTable()})),(0,N.Z)(this,"setTriggerFunctions",(function(e){t.triggerFunctions=e})),(0,N.Z)(this,"onFormChange",(function(e){var n=e.key,r=e.value;if((0,l.has)(t.formState,n)){var a=t.formState[n];t.formState[n]=xt(xt({},a),{},{value:r,error:void 0})}else t.formState[n]={value:r}})),(0,N.Z)(this,"onSelectFunction",(function(e){var n=t.triggerFunctions.find((function(t){return t.id==e}));n&&(t.formState.functionName.value=n.name,t.formState.functionSchema.value=n.schema)})),(0,N.Z)(this,"validateForm",(function(){var e=!0,n=(0,l.mapValues)(t.formState,(function(t,n){switch(n){case"name":return(0,l.isEmpty)(t.value)||(r=t.value,/\s/.test(r))?(e=!1,xt(xt({},t),{},{error:"Invalid trigger name"})):t;case"activation":return(0,l.isEmpty)(t.value)?(e=!1,xt(xt({},t),{},{error:"you have an error"})):t;case"events":return(0,l.isEmpty)(t.value)?(e=!1,xt(xt({},t),{},{error:"Select at least 1 event"})):t;case"tableId":return(0,l.isEmpty)("".concat(t.value))?(e=!1,xt(xt({},t),{},{error:"You must choose a table"})):t;default:return t}var r}));return e||t.formState.update(n),e})),(0,tt.ky)(this)}return(0,et.Z)(e,[{key:"selectedFunction",get:function(){var e=this;return this.triggerFunctions.find((function(t){return t.name==e.formState.functionName.value&&t.schema==e.formState.functionSchema.value}))}},{key:"title",get:function(){return this.formState.id?"Edit '".concat(this.formState.originalName,"' trigger"):"Add a new Trigger"}},{key:"isEditing",get:function(){return void 0!=this.formState.id}}]),e}();var jt=(0,a.createContext)(null),gt=(0,s.Pi)((function(e){var t=e.trigger,n=e.visible,r=e.setVisible,l=(0,d.oR)(),o=l.ui,c=l.meta,u=(0,s.fv)((function(){return new bt}));u.meta=c;(0,de.useRouter)().query.ref;function m(){return(m=(0,x.Z)(j().mark((function e(){var t,a,s,i;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!u.validateForm()){e.next=15;break}if(u.setLoading(!0),t=u.formState.requestBody,!u.isEditing){e.next=10;break}return e.next=7,u.meta.triggers.update(t.id,t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,u.meta.triggers.create(t);case 12:e.t0=e.sent;case 13:(a=e.t0).error?(o.setNotification({category:"error",message:"Failed to create trigger: ".concat(null!==(s=null===(i=a.error)||void 0===i?void 0:i.message)&&void 0!==s?s:"submit request failed")}),u.setLoading(!1)):(o.setNotification({category:"success",message:"".concat(u.isEditing?"Updated":"Created new"," trigger called ").concat(a.name)}),u.setLoading(!1),r(!n));case 15:e.next=21;break;case 17:e.prev=17,e.t1=e.catch(0),o.setNotification({category:"error",message:"Filed to create trigger: ".concat(e.t1.message)}),u.setLoading(!1);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}(0,a.useEffect)((function(){var e=function(){var e=(0,x.Z)(j().mark((function e(){var t;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.meta.tables.load();case 2:t=u.meta.tables.list(),u.setTables(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=(0,x.Z)(j().mark((function e(){var t;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.meta.functions.load();case 2:t=u.meta.functions.listTriggerFunctions(),u.setTriggerFunctions(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e(),t()}),[]),(0,a.useEffect)((function(){t?u.formState.reset(t):(u.formState.reset(),u.setDefaultSelectedTable())}),[n,t]);var h=u.tables.length>=1;return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(i.hsB,{size:"large",visible:n,onCancel:function(){return r(!n)},header:u.title,hideFooter:!h,className:u.chooseFunctionFormVisible?"hooks-sidepanel mr-16 transform transition-all duration-300 ease-in-out":"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:u.loading,onConfirm:function(){return m.apply(this,arguments)},children:h?(0,p.jsx)("div",{className:"",children:(0,p.jsxs)(jt.Provider,{value:u,children:[(0,p.jsx)("div",{className:"my-6 space-y-10",children:u.isEditing?(0,p.jsxs)("div",{className:"space-y-6 px-6",children:[(0,p.jsx)(yt,{}),(0,p.jsx)(Nt,{})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"px-6",children:(0,p.jsx)(yt,{})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsxs)("div",{className:"space-y-12 px-6",children:[(0,p.jsx)("h5",{children:"Conditions to fire trigger"}),(0,p.jsx)(kt,{}),(0,p.jsx)(St,{}),(0,p.jsx)(_t,{}),(0,p.jsx)(wt,{})]}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(Ct,{})]})}),(0,p.jsx)(ot,{triggerFunctions:u.triggerFunctions,visible:u.chooseFunctionFormVisible,setVisible:u.setChooseFunctionFormVisible,onChange:function(e){return u.onSelectFunction(e)}})]})}):(0,p.jsx)(ht.Z,{message:"You will need to create a table first before you can make a trigger"})})})})),yt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsx)(i.IIB,{id:"name",label:"Name of trigger",layout:"horizontal",placeholder:"Name of trigger",value:t.formState.name.value,onChange:function(e){return t.onFormChange({key:"name",value:e.target.value})},size:"small",error:t.formState.name.error,descriptionText:"The name is also stored as the actual postgres name of the trigger. Do not use spaces/whitespace."})})),Nt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsxs)(i.RiT,{id:"enabled-mode",label:"Enabled mode",layout:"horizontal",value:t.formState.enabledMode.value,onChange:function(e){return t.onFormChange({key:"enabledMode",value:e})},size:"small",descriptionText:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:[(0,p.jsxs)(i.RiT.Option,{addOnBefore:function(e){e.active,e.selected;return(0,p.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ORIGIN",label:"Origin",children:["Origin",(0,p.jsx)("span",{className:"block text-scale-900",children:"This is a default behaviour"})]}),(0,p.jsxs)(i.RiT.Option,{addOnBefore:function(e){e.active,e.selected;return(0,p.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"REPLICA",label:"Replica",children:["Replica",(0,p.jsx)("span",{className:"block text-scale-900",children:"Will only fire if the session is in \u201creplica\u201d mode"})]}),(0,p.jsxs)(i.RiT.Option,{addOnBefore:function(e){e.active,e.selected;return(0,p.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ALWAYS",label:"Always",children:["Always",(0,p.jsx)("span",{className:"block text-scale-900",children:"Will fire regardless of the current replication role"})]}),(0,p.jsxs)(i.RiT.Option,{addOnBefore:function(e){e.active,e.selected;return(0,p.jsx)("div",{className:"h-3 w-3 rounded-full border border-red-700 bg-red-900 shadow-sm"})},value:"DISABLED",label:"Disabled",children:["Disabled",(0,p.jsx)("span",{className:"block text-scale-900",children:"Will not fire"})]})]})})),wt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsxs)(i.RiT,{id:"orientation",label:"Orientation",layout:"horizontal",value:t.formState.orientation.value,onChange:function(e){return t.onFormChange({key:"orientation",value:e})},size:"small",descriptionText:"Identifies whether the trigger fires once for each processed row or once for each statement",children:[(0,p.jsxs)(i.RiT.Option,{value:"ROW",label:"Row",children:["Row",(0,p.jsx)("span",{className:"block text-scale-900",children:"fires once for each processed row"})]}),(0,p.jsxs)(i.RiT.Option,{value:"STATEMENT",label:"Statement",children:["Statement",(0,p.jsx)("span",{className:"block text-scale-900",children:"fires once for each statement"})]})]})})),kt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsx)(i.RiT,{id:"table",label:"Table",layout:"horizontal",value:t.formState.tableId.value,onChange:function(e){var n=t.tables.find((function(t){return t.id===e}));n&&(t.onFormChange({key:"table",value:n.name}),t.onFormChange({key:"schema",value:n.schema}),t.onFormChange({key:"tableId",value:e}))},size:"small",error:t.formState.tableId.error,descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:t.tables.map((function(e){return(0,p.jsx)(i.RiT.Option,{id:e.id,value:e.id,label:e.name,addOnBefore:function(){return(0,p.jsx)("div",{className:"flex items-center justify-center rounded bg-scale-1200 p-1 text-scale-100 ",children:(0,p.jsx)(nt.Z,{src:"/img/table-editor.svg",style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:function(e){return e.replace(/svg/,'svg class="m-auto text-color-inherit"')}})})},children:(0,p.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,p.jsx)("p",{children:e.name}),(0,p.jsx)("p",{className:"text-sm text-scale-1000",children:e.schema})]})},e.id)}))})})),St=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsxs)(i.XZJ.Group,{name:"events",label:"Events",id:"events",labelOptional:"The type of events that will trigger your trigger",layout:"horizontal",descriptionText:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",size:"small",onChange:function(e){var n=t.formState.events.value,r=e.target.checked?(0,l.union)(n,[e.target.value]):(0,l.without)(n,e.target.value);t.onFormChange({key:"events",value:r})},error:t.formState.events.error,children:[(0,p.jsx)(i.XZJ,{value:"INSERT",label:"Insert",description:"Any insert operation on the table",checked:t.formState.events.value.includes("INSERT")}),(0,p.jsx)(i.XZJ,{value:"UPDATE",label:"Update",description:"Any update operation, of any column in the table",checked:t.formState.events.value.includes("UPDATE")}),(0,p.jsx)(i.XZJ,{value:"DELETE",label:"Delete",description:"Any deletion of a record",checked:t.formState.events.value.includes("DELETE")})]})})),_t=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsxs)(i.RiT,{id:"activation",label:"Trigger type",descriptionText:"This determines when your Hook fires",onChange:function(e){t.onFormChange({key:"activation",value:e})},value:t.formState.activation.value,layout:"horizontal",size:"small",error:t.formState.activation.error,children:[(0,p.jsx)(i.RiT.Option,{id:"before",value:"BEFORE",label:"Before the event",addOnBefore:function(){return(0,p.jsx)("div",{className:"flex  items-center justify-center rounded bg-scale-1200 p-1 text-scale-100 ",children:(0,p.jsx)(i._Xu,{strokeWidth:2,size:"small"})})},children:(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)("span",{children:"before"}),(0,p.jsx)("span",{className:"block text-scale-900",children:"Trigger fires before the operation is attempted"})]})}),(0,p.jsx)(i.RiT.Option,{id:"after",value:"AFTER",label:"After the event",addOnBefore:function(){return(0,p.jsx)("div",{className:"flex  items-center justify-center rounded bg-green-1200 p-1 text-scale-100 ",children:(0,p.jsx)(i.UdX,{strokeWidth:2,size:"small"})})},children:(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)("span",{children:"after"}),(0,p.jsx)("span",{className:"block text-scale-900",children:"Trigger fires after the operation has completed"})]})})]})})),Ct=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsx)("div",{className:"space-y-6 px-6",children:(0,p.jsx)("h5",{children:"Function to trigger"})}),(0,p.jsx)("div",{className:"px-6",children:(0,l.isEmpty)(t.formState.functionName.value)?(0,p.jsx)(Ot,{}):(0,p.jsx)(Zt,{})})]})})),Ot=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsx)("button",{type:"button",onClick:function(){return t.setChooseFunctionFormVisible(!0)},className:"relative w-full rounded border border-scale-600 bg-scale-200 px-5 py-1 shadow-sm transition-all hover:border-scale-700 hover:bg-scale-300 dark:bg-scale-400 dark:hover:bg-scale-500 ",children:(0,p.jsx)(pt,{icon:(0,p.jsx)(i.Chd,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})})})),Zt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(jt);return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{className:" relative flex w-full items-center justify-between space-x-3 rounded border border-scale-200 px-5 py-4 shadow-sm transition-shadow dark:border-scale-500",children:[(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-scale-1200 text-scale-100 focus-within:bg-opacity-10",children:(0,p.jsx)(i.Chd,{size:"small",strokeWidth:2,width:14})}),(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("p",{className:"text-scale-1000",children:t.formState.functionName.value}),(0,p.jsx)("div",{children:(0,p.jsx)(i.Cts,{children:t.formState.functionSchema.value})})]})]}),(0,p.jsx)(i.zxk,{type:"default",onClick:function(){return t.setChooseFunctionFormVisible(!0)},children:"Change function"})]})})})),Tt=n(44198),Et=(0,s.Pi)((function(e){e.store;var t=e.trigger,n=e.visible,r=e.setVisible,s=(0,d.oR)(),i=s.ui,l=s.meta,o=(0,a.useState)(!1),c=o[0],u=o[1],m=null!==t&&void 0!==t?t:{},h=m.id,f=m.name,v=m.schema;function b(){return(b=(0,x.Z)(j().mark((function e(){var t;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u(!0),h){e.next=4;break}throw Error("Invalid trigger info");case 4:return e.next=6,l.triggers.del(h);case 6:if(!(t=e.sent).error){e.next=11;break}throw t.error;case 11:i.setNotification({category:"success",message:"Successfully removed ".concat(f)}),r(!1);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),i.setNotification({category:"error",message:"Failed to delete ".concat(f,": ").concat(e.t0.message)});case 18:return e.prev=18,u(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[0,15,18,21]])})))).apply(this,arguments)}return(0,p.jsx)(Tt.Z,{visible:n,onCancel:function(){return r(!n)},onConfirm:function(){return b.apply(this,arguments)},title:"Delete this trigger",loading:c,confirmLabel:"Delete trigger ".concat(f),confirmPlaceholder:"Type in name of trigger",confirmString:f,text:"This will delete your trigger called ".concat(f," of schema ").concat(v,"."),alert:"You cannot recover this trigger once it is deleted!"})})),Pt=n(53797),Ft=n(63840);function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){(0,N.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var It=function(){function e(){(0,Ge.Z)(this,e),(0,N.Z)(this,"id",void 0),(0,N.Z)(this,"originalName",void 0),(0,N.Z)(this,"args",void 0),(0,N.Z)(this,"behavior",void 0),(0,N.Z)(this,"configParams",void 0),(0,N.Z)(this,"definition",void 0),(0,N.Z)(this,"language",void 0),(0,N.Z)(this,"name",void 0),(0,N.Z)(this,"returnType",void 0),(0,N.Z)(this,"schema",void 0),(0,N.Z)(this,"securityDefiner",void 0),(0,tt.ky)(this),this.reset()}return(0,et.Z)(e,[{key:"requestBody",get:function(){return{id:this.id,name:this.name.value,schema:this.schema.value,definition:this.definition.value,return_type:this.returnType.value,language:this.language.value,behavior:this.behavior.value,security_definer:this.securityDefiner.value,args:this.args.value.map((function(e){return"".concat(e.name," ").concat(e.type)})),config_params:(0,l.mapValues)((0,l.keyBy)(this.configParams.value,"name"),"value")}}},{key:"reset",value:function(e){var t,n,r,a,s,i,o;this.id=null===e||void 0===e?void 0:e.id,this.originalName=null===e||void 0===e?void 0:e.name,this.args=function(e){var t=null===e||void 0===e?void 0:e.split(",");return(0,l.isEmpty)(e)||!t||0==(null===t||void 0===t?void 0:t.length)?{value:[]}:{value:t.map((function(e){var t=e.trim(),n=t.indexOf(" ");return{name:t.slice(0,1!==n?n:0),type:t.slice(n+1)}}))}}(null===e||void 0===e?void 0:e.argument_types),this.behavior={value:null!==(t=null===e||void 0===e?void 0:e.behavior)&&void 0!==t?t:"VOLATILE"},this.configParams=function(e){var t=[];if(e)for(var n in e)t.push({name:n,value:e[n]});return{value:t}}(null===e||void 0===e?void 0:e.config_params),this.definition={value:null!==(n=null===e||void 0===e?void 0:e.definition)&&void 0!==n?n:""},this.language={value:null!==(r=null===e||void 0===e?void 0:e.language)&&void 0!==r?r:"plpgsql"},this.name={value:null!==(a=null===e||void 0===e?void 0:e.name)&&void 0!==a?a:""},this.returnType={value:null!==(s=null===e||void 0===e?void 0:e.return_type)&&void 0!==s?s:"void"},this.schema={value:null!==(i=null===e||void 0===e?void 0:e.schema)&&void 0!==i?i:"public"},this.securityDefiner={value:null!==(o=null===e||void 0===e?void 0:e.security_definer)&&void 0!==o&&o}}},{key:"update",value:function(e){this.args=e.args,this.behavior=e.behavior,this.configParams=e.configParams,this.definition=e.definition,this.language=e.language,this.name=e.name,this.returnType=e.returnType,this.schema=e.schema,this.securityDefiner=e.securityDefiner}}]),e}();var Dt=function(){function e(){var t=this;(0,Ge.Z)(this,e),(0,N.Z)(this,"loading",!1),(0,N.Z)(this,"formState",new It),(0,N.Z)(this,"meta",null),(0,N.Z)(this,"schemas",[]),(0,N.Z)(this,"advancedVisible",!1),(0,N.Z)(this,"isDirty",!1),(0,N.Z)(this,"toggleAdvancedVisible",(function(){t.advancedVisible=!t.advancedVisible})),(0,N.Z)(this,"setSchemas",(function(e){t.schemas=e})),(0,N.Z)(this,"setLoading",(function(e){t.loading=e})),(0,N.Z)(this,"setIsDirty",(function(e){t.isDirty=e})),(0,N.Z)(this,"onFormChange",(function(e){var n=e.key,r=e.value;if(t.isDirty=!0,(0,l.has)(t.formState,n)){var a=t.formState[n];t.formState[n]=zt(zt({},a),{},{value:r,error:void 0})}else t.formState[n]={value:r}})),(0,N.Z)(this,"onFormArrayChange",(function(e){var n=e.operation,r=e.key,a=e.idx,s=e.value;switch(n){case"add":if((0,l.has)(t.formState,r))t.formState[r].value.push(s);else{t.formState[r]={value:[s]}}break;case"delete":if((0,l.has)(t.formState,r)){var i=(0,l.filter)(t.formState[r].value,(function(e,t){return t!=a}));t.formState[r].value=i}break;default:(0,l.has)(t.formState,r)&&!(0,l.isUndefined)(a)?t.formState[r].value[a]=s:t.formState[r]={value:[s]}}})),(0,N.Z)(this,"validateForm",(function(){var e=!0,n=(0,l.mapValues)(t.formState,(function(t,n){switch(n){case"name":return(0,l.isEmpty)(t.value)||At(t.value)?(e=!1,zt(zt({},t),{},{error:"Invalid function name"})):t;case"args":var r,a=null===(r=t.value)||void 0===r?void 0:r.map((function(t){return(0,l.isEmpty)(t.name)||At(t.name)?(e=!1,zt(zt({},t),{},{error:"Invalid argument name"})):t}));return t.value=a,t;case"configParams":var s,i=null===(s=t.value)||void 0===s?void 0:s.map((function(t){var n={name:void 0,value:void 0};return((0,l.isEmpty)(t.name)||At(t.name))&&(e=!1,n.name="Invalid config name"),(0,l.isEmpty)(t.value)&&(e=!1,n.value="Missing config value"),zt(zt({},t),{},{error:n})}));return t.value=i,t;default:return t}}));return e||t.formState.update(n),e})),(0,tt.ky)(this)}return(0,et.Z)(e,[{key:"title",get:function(){return this.formState.id?"Edit '".concat(this.formState.originalName,"' function"):"Add a new function"}},{key:"isEditing",get:function(){return void 0!=this.formState.id}}]),e}();function At(e){return/\s/.test(e)}var Bt=(0,a.createContext)(null),Vt=(0,s.Pi)((function(e){var t=e.func,n=e.visible,r=e.setVisible,l=(0,d.oR)(),o=l.ui,c=l.meta,u=(0,s.fv)((function(){return new Dt}));u.meta=c;var m=(0,a.useState)(!1),h=m[0],f=m[1];function v(){return(v=(0,x.Z)(j().mark((function e(){var t,a,s,i;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!u.validateForm()){e.next=15;break}if(u.setLoading(!0),!(t=u.formState.requestBody).id){e.next=10;break}return e.next=7,u.meta.functions.update(t.id,t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,u.meta.functions.create(t);case 12:e.t0=e.sent;case 13:(a=e.t0).error?(o.setNotification({category:"error",message:"Failed to create function: ".concat(null!==(s=null===(i=a.error)||void 0===i?void 0:i.message)&&void 0!==s?s:"Submit request failed")}),u.setLoading(!1)):(o.setNotification({category:"success",message:"".concat(u.isEditing?"Updated":"Created new"," function called ").concat(a.name)}),u.setLoading(!1),r(!n));case 15:e.next=21;break;case 17:e.prev=17,e.t1=e.catch(0),o.setNotification({category:"error",message:"Failed to create function: ".concat(e.t1.message)}),u.setLoading(!1);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}return(0,a.useEffect)((function(){var e=function(){var e=(0,x.Z)(j().mark((function e(){var t;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.meta.schemas.load();case 2:t=u.meta.schemas.list(),u.setSchemas(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),(0,a.useEffect)((function(){u.formState.reset(t),u.setIsDirty(!1)}),[n,t]),(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(i.hsB,{size:"large",visible:n,onCancel:function(){u.isDirty?f(!0):r(!n)},header:u.title,className:"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:u.loading,onConfirm:function(){return v.apply(this,arguments)},children:[(0,p.jsx)(Bt.Provider,{value:u,children:(0,p.jsx)("div",{className:"mt-4 space-y-10",children:u.isEditing?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.hsB.Content,{children:(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsx)(Lt,{}),(0,p.jsx)(Ht,{})]})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(i.hsB.Content,{children:(0,p.jsx)(Wt,{readonly:!0})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(i.hsB.Content,{children:(0,p.jsx)(Ut,{})})]}):(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsx)(i.hsB.Content,{children:(0,p.jsx)(Lt,{})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(i.hsB.Content,{children:(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsx)(Ht,{}),(0,p.jsx)(Qt,{})]})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(i.hsB.Content,{children:(0,p.jsx)(Wt,{})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(i.hsB.Content,{children:(0,p.jsx)(Ut,{})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(i.hsB.Content,{children:(0,p.jsx)(R.Z,{children:(0,p.jsx)("div",{className:"space-y-8 rounded bg-bg-alt-light py-4 dark:bg-bg-alt-dark",children:(0,p.jsx)("div",{className:"px-6",children:(0,p.jsx)(i.ZDl,{onChange:function(){return u.toggleAdvancedVisible()},label:"Show advanced settings",checked:u.advancedVisible,labelOptional:"These are settings that might be familiar for postgres heavy users "})})})})}),u.advancedVisible&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.hsB.Content,{children:(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsx)(Kt,{}),(0,p.jsx)(Jt,{})]})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(i.hsB.Content,{children:(0,p.jsx)(Yt,{})}),(0,p.jsx)(i.hsB.Separator,{}),(0,p.jsx)(i.hsB.Content,{children:(0,p.jsx)(Xt,{})})]})]})})}),(0,p.jsx)(Ft.Z,{visible:h,header:"Confirm to close",buttonLabel:"Confirm",onSelectCancel:function(){return f(!1)},onSelectConfirm:function(){f(!1),r(!n)},children:(0,p.jsx)(i.u_l.Content,{children:(0,p.jsx)("p",{className:"py-4 text-sm text-scale-1100",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]})})})),Lt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(Bt);return(0,p.jsx)(i.IIB,{id:"name",label:"Name of function",layout:"horizontal",placeholder:"Name of function",value:t.formState.name.value,onChange:function(e){return t.onFormChange({key:"name",value:e.target.value})},size:"small",error:t.formState.name.error,descriptionText:"Name will also be used for the function name in postgres"})})),Wt=(0,s.Pi)((function(e){var t=e.readonly,n=(0,a.useContext)(Bt);return(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)("h5",{className:"text-base text-scale-1200",children:"Arguments"}),(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"Arguments can be referenced in the function body using either names or numbers."})]}),(0,p.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&(0,l.isEmpty)(n.formState.args.value)&&(0,p.jsx)("span",{className:"text-scale-900",children:"No argument for this function"}),n.formState.args.value.map((function(e,n){return(0,p.jsx)(qt,{idx:n,name:e.name,type:e.type,error:e.error,readonly:t},"arg-".concat(n))})),!t&&(0,p.jsx)("div",{className:"",children:(0,p.jsx)(i.zxk,{type:"default",icon:(0,p.jsx)(i.SC9,{}),onClick:function(){n.onFormArrayChange({key:"args",value:{name:"",type:"bool"},operation:"add"})},disabled:t,children:"Add a new argument"})})]})]})})),qt=(0,s.Pi)((function(e){var t=e.idx,n=e.name,r=e.type,s=e.error,l=e.readonly,o=(0,a.useContext)(Bt);return(0,p.jsxs)("div",{className:"flex flex-row space-x-1 items-center",children:[(0,p.jsx)(i.IIB,{id:"name-".concat(t),className:"flex-1 flex-grow",value:n,placeholder:"Name of argument",onChange:function(e){var n=e.currentTarget.value;o.onFormArrayChange({key:"args",value:{name:n,type:r},idx:t,operation:"update"})},size:"small",error:s,disabled:l}),(0,p.jsxs)(i.RiT,{id:"type-".concat(t),className:"flex-1",value:r,size:"small",onChange:function(e){o.onFormArrayChange({key:"args",value:{name:n,type:e},idx:t,operation:"update"})},disabled:l,children:[(0,p.jsx)(i.RiT.Option,{value:"integer",label:"integer",children:"integer"}),Pt.DL.map((function(e){return(0,p.jsx)(i.RiT.Option,{value:e,label:e,children:e},e)}))]}),!l&&(0,p.jsx)("div",{children:(0,p.jsx)(i.zxk,{danger:!0,type:"default",icon:(0,p.jsx)(i.IT9,{size:"tiny"}),onClick:function(){o.onFormArrayChange({key:"args",idx:t,operation:"delete"})},size:"small"})})]})})),Yt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(Bt);return(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{className:"flex items-center justify-between",children:(0,p.jsx)("h5",{className:"text-base text-scale-1200",children:"Config Params"})}),(0,p.jsx)("div",{className:"space-y-2 pt-4",children:t.formState.configParams.value.map((function(e,t){return(0,p.jsx)(Mt,{idx:t,name:e.name,value:e.value,error:e.error},"configParam-".concat(t))}))}),(0,p.jsx)("div",{className:"pt-2",children:(0,p.jsx)(i.zxk,{type:"default",icon:(0,p.jsx)(i.SC9,{}),onClick:function(){t.onFormArrayChange({key:"configParams",value:{name:"",value:""},operation:"add"})},children:"Add a new config"})})]})})),Mt=(0,s.Pi)((function(e){var t=e.idx,n=e.name,r=e.value,s=e.error,l=(0,a.useContext)(Bt);return(0,p.jsxs)("div",{className:"flex space-x-1 items-center",children:[(0,p.jsx)(i.IIB,{id:"name-".concat(t),className:"flex-1",placeholder:"Name of config",value:n,onChange:function(e){var n=e.currentTarget.value;l.onFormArrayChange({key:"configParams",value:{name:n,value:r},idx:t,operation:"update"})},size:"small",error:null===s||void 0===s?void 0:s.name}),(0,p.jsx)(i.IIB,{id:"value-".concat(t),className:"flex-1",placeholder:"Value of config",value:r,onChange:function(e){var r=e.currentTarget.value;l.onFormArrayChange({key:"configParams",value:{name:n,value:r},idx:t,operation:"update"})},size:"small",error:null===s||void 0===s?void 0:s.value}),(0,p.jsx)("div",{children:(0,p.jsx)(i.zxk,{danger:!0,type:"default",icon:(0,p.jsx)(i.IT9,{size:"tiny"}),onClick:function(){l.onFormArrayChange({key:"configParams",idx:t,operation:"delete"})},size:"small"})})]})})),Ut=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(Bt);return(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)("h5",{className:"text-base text-scale-1200",children:"Definition"}),(0,p.jsxs)("p",{className:"text-sm text-scale-1100",children:["The language below should be written in `",t.formState.language.value,"`."]}),(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"Change the language in the Advanced Settings below."})]}),(0,p.jsx)("div",{className:"h-40 border dark:border-dark",children:(0,p.jsx)(at.Z,{defaultValue:t.formState.definition.value,onInputChange:function(e){t.onFormChange({key:"definition",value:e})},contextmenu:!1})})]})})),Ht=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(Bt);return(0,p.jsx)(i.RiT,{id:"schema",label:"Schema",size:"small",layout:"horizontal",placeholder:"Pick a schema",value:t.formState.schema.value,descriptionText:"Tables made in the table editor will be in 'public'",onChange:function(e){return t.onFormChange({key:"schema",value:e})},children:t.schemas.map((function(e){return(0,p.jsx)(i.RiT.Option,{label:e.name,value:e.name,children:e.name},e.name)}))})})),Kt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,d.oR)().meta,n=(0,a.useContext)(Bt),s=(0,l.partition)(t.extensions.list(),(function(e){return!(0,l.isNull)(e.installed_version)})),o=(0,r.Z)(s,1)[0];return(0,p.jsxs)(i.RiT,{id:"language",size:"small",label:"Language",layout:"horizontal",value:n.formState.language.value,placeholder:"Pick a language",onChange:function(e){return n.onFormChange({key:"language",value:e})},children:[(0,p.jsx)(i.RiT.Option,{value:"sql",label:"sql",children:"sql"}),o.filter((function(e){return e.name.startsWith("pl")})).map((function(e){return(0,p.jsx)(i.RiT.Option,{value:e.name,label:e.name,children:e.name},e.name)}))]})})),Qt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(Bt);return(0,p.jsxs)(i.RiT,{id:"returnType",size:"small",label:"Return type",layout:"horizontal",value:t.formState.returnType.value,onChange:function(e){return t.onFormChange({key:"returnType",value:e})},children:[(0,p.jsx)(i.RiT.Option,{value:"void",label:"void",children:"void"}),(0,p.jsx)(i.RiT.Option,{value:"record",label:"record",children:"record"}),(0,p.jsx)(i.RiT.Option,{value:"trigger",label:"trigger",children:"trigger"}),(0,p.jsx)(i.RiT.Option,{value:"integer",label:"integer",children:"integer"}),Pt.DL.map((function(e){return(0,p.jsx)(i.RiT.Option,{value:e,label:e,children:e},e)}))]})})),Jt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(Bt);return(0,p.jsxs)(i.RiT,{id:"behavior",size:"small",label:"Behavior",layout:"horizontal",value:t.formState.behavior.value,onChange:function(e){return t.onFormChange({key:"behavior",value:e})},children:[(0,p.jsx)(i.RiT.Option,{value:"IMMUTABLE",label:"immutable",children:"immutable"}),(0,p.jsx)(i.RiT.Option,{value:"STABLE",label:"stable",children:"stable"}),(0,p.jsx)(i.RiT.Option,{value:"VOLATILE",label:"volatile",children:"volatile"})]})})),Xt=(0,s.Pi)((function(e){(0,v.Z)(e);var t=(0,a.useContext)(Bt);return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)("div",{className:"space-y-4",children:(0,p.jsxs)(i.Y8K.Group,{type:"cards",label:"Type of security",layout:"vertical",onChange:function(e){t.onFormChange({key:"securityDefiner",value:"SECURITY_DEFINER"==e.target.value})},value:t.formState.securityDefiner.value?"SECURITY_DEFINER":"SECURITY_INVOKER",error:t.formState.securityDefiner.error,children:[(0,p.jsx)(i.Y8K,{id:"SECURITY_INVOKER",label:"SECURITY INVOKER",value:"SECURITY_INVOKER",checked:!t.formState.securityDefiner.value,description:"Function is to be executed with the privileges of the user that calls it."}),(0,p.jsx)(i.Y8K,{id:"SECURITY_DEFINER",label:"SECURITY DEFINER",value:"SECURITY_DEFINER",checked:t.formState.securityDefiner.value,description:"Function is to be executed with the privileges of the user that created it."})]})})})})),$t=(0,s.Pi)((function(e){var t=e.func,n=e.visible,r=e.setVisible,s=(0,d.oR)(),i=s.ui,l=s.meta,o=(0,a.useState)(!1),c=o[0],u=o[1],m=null!==t&&void 0!==t?t:{},h=m.id,f=m.name,v=m.schema;function b(){return(b=(0,x.Z)(j().mark((function e(){var t;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u(!0),h){e.next=4;break}throw Error("Invalid function info");case 4:return e.next=6,l.functions.del(h);case 6:if(!(t=e.sent).error){e.next=11;break}throw t.error;case 11:i.setNotification({category:"success",message:"Successfully removed ".concat(f)}),r(!1);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),i.setNotification({category:"error",message:"Failed to delete ".concat(f,": ").concat(e.t0.message)});case 18:return e.prev=18,u(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[0,15,18,21]])})))).apply(this,arguments)}return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(Tt.Z,{visible:n,onCancel:function(){return r(!n)},onConfirm:function(){return b.apply(this,arguments)},title:"Delete this function",loading:c,confirmLabel:"Delete function ".concat(f),confirmPlaceholder:"Type in name of function",confirmString:f,text:"This will delete your function called ".concat(f," of schema ").concat(v,"."),alert:"You cannot recover this function once it is deleted!"})})}))},30259:function(e,t,n){var r=n(38480),a=n(24246);t.Z=function(){return(0,a.jsxs)("div",{className:"flex h-64 flex-col items-center justify-center",children:[(0,a.jsx)(r.Z,{src:"/img/no-search-results.svg",preProcessor:function(e){return e.replace(/svg/,'svg className="mb-2 w-16 h-16 text-color-inherit"')}}),(0,a.jsx)("p",{className:"w-64 text-center text-sm opacity-50",children:"Hmm, we couldn't find any results that matches your query. Try another?"})]})}},55671:function(e,t,n){var r=n(90849),a=n(90089),s=(n(27378),n(24246)),i=["children","colSpan","className","style"];function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e){var t=e.body,n=e.head,r=e.className,a=e.containerClassName,i=e.borderless,l=e.headTrClasses,o=e.bodyClassName,c=e.style,d=["table-container"];a&&d.push(a),i&&d.push("table-container--borderless");var u=["table"];return r&&u.push(r),(0,s.jsx)("div",{className:d.join(" "),children:(0,s.jsxs)("table",{className:u.join(" "),style:c,children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{className:l,children:n})}),(0,s.jsx)("tbody",{className:o,children:t})]})})}c.th=function(e){var t=e.children,n=e.className,r=e.style,a=["p-3 px-4 text-left"];return n&&a.push(n),(0,s.jsx)("th",{className:a.join(" "),style:r,children:t})},c.td=function(e){var t=e.children,n=e.colSpan,r=e.className,l=e.style,c=(0,a.Z)(e,i);return(0,s.jsx)("td",o(o({className:r,colSpan:n,style:l},c),{},{children:t}))},c.tr=function(e){var t=e.children,n=e.className,r=e.onClick,a=e.style,i=e.hoverable,l=[n];return(r||i)&&l.push("tr--link"),(0,s.jsx)("tr",{className:l.join(" "),onClick:r,style:a,children:t})},t.Z=c},78906:function(e,t,n){var r=n(55732),a=n(34707),s=n.n(a),i=n(90085),l=n(27378),o=n(42791),c=n(24246);t.Z=function(e){var t=e.queryId,n=e.language,a=void 0===n?"pgsql":n,d=e.defaultValue,u=void 0===d?"":d,m=e.readOnly,p=void 0!==m&&m,h=e.contextmenu,f=void 0===h||h,x=e.onInputChange,v=void 0===x?function(){}:x,b=(0,i.Ik)(),j=(0,o.oR)().meta,g=(0,l.useRef)();function y(e){return N.apply(this,arguments)}function N(){return(N=(0,r.Z)(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.formatQuery(t);case 3:if(!(n=e.sent).error){e.next=6;break}throw n.error;case 6:return e.abrupt("return",n);case 9:return e.prev=9,e.t0=e.catch(0),console.error("formatPgsql error:",e.t0),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}(0,l.useEffect)((function(){if(b){b.editor.defineTheme("supabase",{base:"vs-dark",inherit:!0,colors:{},rules:[{token:"",background:"4a5568"},{token:"string.sql",foreground:"24b47e"},{token:"comment",foreground:"666666"},{token:"predefined.sql",foreground:"D4D4D4"}]});var e=b.languages.registerDocumentFormattingEditProvider("pgsql",{provideDocumentFormattingEdits:function(e){return(0,r.Z)(s().mark((function t(){var n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getValue(),t.next=3,y(n);case 3:return r=t.sent,t.abrupt("return",[{range:e.getFullModelRange(),text:r}]);case 5:case"end":return t.stop()}}),t)})))()}});return function(){e.dispose()}}}),[b]),(0,l.useEffect)((function(){var e;g.current&&(null===(e=g.current)||void 0===e||e.changeViewZones((function(e){e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})))}),[t]);var w=function(){return(0,c.jsx)("h4",{className:"text-lg",children:"Loading"})};return(0,c.jsx)(i.ZP,{className:"monaco-editor",theme:"vs-dark",defaultLanguage:a,defaultValue:u,path:t,loading:(0,c.jsx)(w,{}),options:{readOnly:p,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,contextmenu:f},onMount:function(e,t){g.current=e,e.changeViewZones((function(e){e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}))},onChange:v})}},95439:function(e,t,n){var r=n(86677),a=n(89744),s=n(24246);t.Z=function(e){var t=e.message,n=(0,r.useRouter)(),i=n.query.ref;return(0,s.jsx)(a.Z,{title:"No public tables found",ctaButtonLabel:"Create a new table",onClickCta:function(){n.push("/project/".concat(i,"/editor"))},children:(0,s.jsx)("p",{className:"text-sm text-scale-1100",children:t})})}},69497:function(e,t,n){var r=n(88983),a=n(25229),s=n(79894),i=n(24532),l=n(42791),o=n(20796),c=n(68043),d=n(24246);t.Z=(0,a.Pi)((function(e){var t,n=e.icon,a=e.primaryText,u=(e.projectRef,e.secondaryText),m=(0,l.oR)().ui,p=(0,l.UO)().ref,h=null===(t=m.selectedProject)||void 0===t?void 0:t.subscription_tier,f=(0,l.FH)(c.KA.BILLING_WRITE,"stripe.subscriptions"),x=(0,l.P5)("disableProjectCreationAndUpdate"),v=h===o.ev.ENTERPRISE;return(0,d.jsx)("div",{className:["block w-full rounded border border-opacity-20 py-4 px-6","border-gray-600 bg-gray-100","dark:border-gray-300 dark:bg-gray-400"].join(" "),children:(0,d.jsxs)("div",{className:"flex space-x-3",children:[n&&(0,d.jsx)("div",{className:"mt-1",children:n}),(0,d.jsxs)("div",{className:"flex w-full items-center justify-between space-x-32",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("p",{className:"text-sm",children:a}),(0,d.jsx)("div",{children:(0,d.jsx)("p",{className:"text-sm text-scale-1100",children:u})})]}),(0,d.jsxs)(i.fC,{delayDuration:0,children:[(0,d.jsx)(i.xz,{children:(0,d.jsx)(r.zxk,{type:"primary",disabled:!f||x,children:(0,d.jsx)(s.default,{href:"/project/".concat(p,v?"/settings/billing/update/enterprise":"/settings/billing/update"),children:(0,d.jsx)("a",{children:h===o.ev.FREE?"Upgrade to Pro":"Modify subscription"})})})}),!f||x?(0,d.jsxs)(i.VY,{side:"bottom",children:[(0,d.jsx)(i.Eh,{className:"radix-tooltip-arrow"}),(0,d.jsx)("div",{className:["border border-scale-200 text-center","rounded bg-scale-100 py-1 px-2 leading-none shadow"].join(" "),children:(0,d.jsx)("span",{className:"text-xs text-scale-1200",children:x?(0,d.jsxs)(d.Fragment,{children:["Subscription changes are currently disabled.",(0,d.jsx)("br",{}),"Our engineers are working on a fix."]}):f?"":"You need additional permissions to amend subscriptions"})})]}):(0,d.jsx)(d.Fragment,{})]})]})]})})}))},42356:function(e,t,n){n.d(t,{u:function(){return K}});var r=n(27378);function a(e,t,...n){if(e in t){let r=t[e];return"function"==typeof r?r(...n):r}let r=new Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map((e=>`"${e}"`)).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,a),r}var s,i=((s=i||{})[s.None=0]="None",s[s.RenderStrategy=1]="RenderStrategy",s[s.Static=2]="Static",s),l=(e=>(e[e.Unmount=0]="Unmount",e[e.Hidden=1]="Hidden",e))(l||{});function o({ourProps:e,theirProps:t,slot:n,defaultTag:r,features:s,visible:i=!0,name:l}){let o=d(t,e);if(i)return c(o,n,r,l);let u=null!=s?s:0;if(2&u){let{static:e=!1,...t}=o;if(e)return c(t,n,r,l)}if(1&u){let{unmount:e=!0,...t}=o;return a(e?0:1,{0:()=>null,1:()=>c({...t,hidden:!0,style:{display:"none"}},n,r,l)})}return c(o,n,r,l)}function c(e,t={},n,a){let{as:s=n,children:i,refName:l="ref",...o}=p(e,["unmount","static"]),c=void 0!==e.ref?{[l]:e.ref}:{},u="function"==typeof i?i(t):i;o.className&&"function"==typeof o.className&&(o.className=o.className(t));let h={};if(t){let e=!1,n=[];for(let[r,a]of Object.entries(t))"boolean"==typeof a&&(e=!0),!0===a&&n.push(r);e&&(h["data-headlessui-state"]=n.join(" "))}if(s===r.Fragment&&Object.keys(m(o)).length>0){if(!(0,r.isValidElement)(u)||Array.isArray(u)&&u.length>1)throw new Error(['Passing props on "Fragment"!',"",`The current component <${a} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(o).map((e=>`  - ${e}`)).join("\n"),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map((e=>`  - ${e}`)).join("\n")].join("\n"));return(0,r.cloneElement)(u,Object.assign({},d(u.props,m(p(o,["ref"]))),h,c,function(...e){return{ref:e.every((e=>null==e))?void 0:t=>{for(let n of e)null!=n&&("function"==typeof n?n(t):n.current=t)}}}(u.ref,c.ref)))}return(0,r.createElement)(s,Object.assign({},p(o,["ref"]),s!==r.Fragment&&c,s!==r.Fragment&&h),u)}function d(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},n={};for(let r of e)for(let e in r)e.startsWith("on")&&"function"==typeof r[e]?(null!=n[e]||(n[e]=[]),n[e].push(r[e])):t[e]=r[e];if(t.disabled||t["aria-disabled"])return Object.assign(t,Object.fromEntries(Object.keys(n).map((e=>[e,void 0]))));for(let r in n)Object.assign(t,{[r](e,...t){let a=n[r];for(let n of a){if((e instanceof Event||(null==e?void 0:e.nativeEvent)instanceof Event)&&e.defaultPrevented)return;n(e,...t)}}});return t}function u(e){var t;return Object.assign((0,r.forwardRef)(e),{displayName:null!=(t=e.displayName)?t:e.name})}function m(e){let t=Object.assign({},e);for(let n in t)void 0===t[n]&&delete t[n];return t}function p(e,t=[]){let n=Object.assign({},e);for(let r of t)r in n&&delete n[r];return n}let h=(0,r.createContext)(null);h.displayName="OpenClosedContext";var f=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(f||{});function x(){return(0,r.useContext)(h)}function v({value:e,children:t}){return r.createElement(h.Provider,{value:e},t)}let b="undefined"==typeof window||"undefined"==typeof document?r.useEffect:r.useLayoutEffect;function j(){let e=(0,r.useRef)(!1);return b((()=>(e.current=!0,()=>{e.current=!1})),[]),e}function g(e){let t=(0,r.useRef)(e);return b((()=>{t.current=e}),[e]),t}let y={serverHandoffComplete:!1};function N(){let[e,t]=(0,r.useState)(y.serverHandoffComplete);return(0,r.useEffect)((()=>{!0!==e&&t(!0)}),[e]),(0,r.useEffect)((()=>{!1===y.serverHandoffComplete&&(y.serverHandoffComplete=!0)}),[]),e}let w=function(e){let t=g(e);return r.useCallback(((...e)=>t.current(...e)),[t])},k=Symbol();function S(...e){let t=(0,r.useRef)(e);(0,r.useEffect)((()=>{t.current=e}),[e]);let n=w((e=>{for(let n of t.current)null!=n&&("function"==typeof n?n(e):n.current=e)}));return e.every((e=>null==e||(null==e?void 0:e[k])))?void 0:n}function _(){let e=[],t=[],n={enqueue(e){t.push(e)},addEventListener:(e,t,r,a)=>(e.addEventListener(t,r,a),n.add((()=>e.removeEventListener(t,r,a)))),requestAnimationFrame(...e){let t=requestAnimationFrame(...e);return n.add((()=>cancelAnimationFrame(t)))},nextFrame:(...e)=>n.requestAnimationFrame((()=>n.requestAnimationFrame(...e))),setTimeout(...e){let t=setTimeout(...e);return n.add((()=>clearTimeout(t)))},microTask(...e){let t={current:!0};return function(e){"function"==typeof queueMicrotask?queueMicrotask(e):Promise.resolve().then(e).catch((e=>setTimeout((()=>{throw e}))))}((()=>{t.current&&e[0]()})),n.add((()=>{t.current=!1}))},add:t=>(e.push(t),()=>{let n=e.indexOf(t);if(n>=0){let[t]=e.splice(n,1);t()}}),dispose(){for(let t of e.splice(0))t()},async workQueue(){for(let e of t.splice(0))await e()}};return n}function C(e,...t){e&&t.length>0&&e.classList.add(...t)}function O(e,...t){e&&t.length>0&&e.classList.remove(...t)}var Z,T=((Z=T||{}).Ended="ended",Z.Cancelled="cancelled",Z);function E(e,t,n,r){let s=n?"enter":"leave",i=_(),l=void 0!==r?function(e){let t={called:!1};return(...n)=>{if(!t.called)return t.called=!0,e(...n)}}(r):()=>{};"enter"===s&&(e.removeAttribute("hidden"),e.style.display="");let o=a(s,{enter:()=>t.enter,leave:()=>t.leave}),c=a(s,{enter:()=>t.enterTo,leave:()=>t.leaveTo}),d=a(s,{enter:()=>t.enterFrom,leave:()=>t.leaveFrom});return O(e,...t.enter,...t.enterTo,...t.enterFrom,...t.leave,...t.leaveFrom,...t.leaveTo,...t.entered),C(e,...o,...d),i.nextFrame((()=>{O(e,...d),C(e,...c),function(e,t){let n=_();if(!e)return n.dispose;let{transitionDuration:r,transitionDelay:a}=getComputedStyle(e),[s,i]=[r,a].map((e=>{let[t=0]=e.split(",").filter(Boolean).map((e=>e.includes("ms")?parseFloat(e):1e3*parseFloat(e))).sort(((e,t)=>t-e));return t}));if(s+i!==0){let r=[];r.push(n.addEventListener(e,"transitionrun",(a=>{a.target===a.currentTarget&&(r.splice(0).forEach((e=>e())),r.push(n.addEventListener(e,"transitionend",(e=>{e.target===e.currentTarget&&(t("ended"),r.splice(0).forEach((e=>e())))})),n.addEventListener(e,"transitioncancel",(e=>{e.target===e.currentTarget&&(t("cancelled"),r.splice(0).forEach((e=>e())))}))))})))}else t("ended");n.add((()=>t("cancelled"))),n.dispose}(e,(n=>("ended"===n&&(O(e,...o),C(e,...t.entered)),l(n))))})),i.dispose}function P(){let[e]=(0,r.useState)(_);return(0,r.useEffect)((()=>()=>e.dispose()),[e]),e}function F({container:e,direction:t,classes:n,onStart:r,onStop:s}){let i=j(),l=P(),o=g(t);b((()=>{let t=_();l.add(t.dispose);let c=e.current;if(c&&"idle"!==o.current&&i.current)return t.dispose(),r.current(o.current),t.add(E(c,n.current,"enter"===o.current,(e=>{t.dispose(),a(e,{[T.Ended](){s.current(o.current)},[T.Cancelled]:()=>{}})}))),t.dispose}),[t])}function R(e=""){return e.split(" ").filter((e=>e.trim().length>1))}let z=(0,r.createContext)(null);z.displayName="TransitionContext";var I,D=((I=D||{}).Visible="visible",I.Hidden="hidden",I);let A=(0,r.createContext)(null);function B(e){return"children"in e?B(e.children):e.current.filter((({el:e})=>null!==e.current)).filter((({state:e})=>"visible"===e)).length>0}function V(e,t){let n=g(e),s=(0,r.useRef)([]),i=j(),o=P(),c=w(((e,t=l.Hidden)=>{let r=s.current.findIndex((({el:t})=>t===e));-1!==r&&(a(t,{[l.Unmount](){s.current.splice(r,1)},[l.Hidden](){s.current[r].state="hidden"}}),o.microTask((()=>{var e;!B(s)&&i.current&&(null==(e=n.current)||e.call(n))})))})),d=w((e=>{let t=s.current.find((({el:t})=>t===e));return t?"visible"!==t.state&&(t.state="visible"):s.current.push({el:e,state:"visible"}),()=>c(e,l.Unmount)})),u=(0,r.useRef)([]),m=(0,r.useRef)(Promise.resolve()),p=(0,r.useRef)({enter:[],leave:[],idle:[]}),h=w(((e,n,r)=>{u.current.splice(0),t&&(t.chains.current[n]=t.chains.current[n].filter((([t])=>t!==e))),null==t||t.chains.current[n].push([e,new Promise((e=>{u.current.push(e)}))]),null==t||t.chains.current[n].push([e,new Promise((e=>{Promise.all(p.current[n].map((([e,t])=>t))).then((()=>e()))}))]),"enter"===n?m.current=m.current.then((()=>null==t?void 0:t.wait.current)).then((()=>r(n))):r(n)})),f=w(((e,t,n)=>{Promise.all(p.current[t].splice(0).map((([e,t])=>t))).then((()=>{var e;null==(e=u.current.shift())||e()})).then((()=>n(t)))}));return(0,r.useMemo)((()=>({children:s,register:d,unregister:c,onStart:h,onStop:f,wait:m,chains:p})),[d,c,s,h,f,p,m])}function L(){}A.displayName="NestingContext";let W=["beforeEnter","afterEnter","beforeLeave","afterLeave"];function q(e){var t;let n={};for(let r of W)n[r]=null!=(t=e[r])?t:L;return n}let Y=i.RenderStrategy,M=u((function(e,t){let{beforeEnter:n,afterEnter:s,beforeLeave:i,afterLeave:c,enter:d,enterFrom:u,enterTo:m,entered:p,leave:h,leaveFrom:x,leaveTo:b,...j}=e,y=(0,r.useRef)(null),k=S(y,t),_=j.unmount?l.Unmount:l.Hidden,{show:C,appear:O,initial:Z}=function(){let e=(0,r.useContext)(z);if(null===e)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),[T,E]=(0,r.useState)(C?"visible":"hidden"),P=function(){let e=(0,r.useContext)(A);if(null===e)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),{register:I,unregister:D}=P,L=(0,r.useRef)(null);(0,r.useEffect)((()=>I(y)),[I,y]),(0,r.useEffect)((()=>{if(_===l.Hidden&&y.current)return C&&"visible"!==T?void E("visible"):a(T,{hidden:()=>D(y),visible:()=>I(y)})}),[T,y,I,D,C,_]);let W=g({enter:R(d),enterFrom:R(u),enterTo:R(m),entered:R(p),leave:R(h),leaveFrom:R(x),leaveTo:R(b)}),M=function(e){let t=(0,r.useRef)(q(e));return(0,r.useEffect)((()=>{t.current=q(e)}),[e]),t}({beforeEnter:n,afterEnter:s,beforeLeave:i,afterLeave:c}),U=N();(0,r.useEffect)((()=>{if(U&&"visible"===T&&null===y.current)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}),[y,T,U]);let H=Z&&!O,K=!U||H||L.current===C?"idle":C?"enter":"leave",Q=w((e=>a(e,{enter:()=>M.current.beforeEnter(),leave:()=>M.current.beforeLeave(),idle:()=>{}}))),J=w((e=>a(e,{enter:()=>M.current.afterEnter(),leave:()=>M.current.afterLeave(),idle:()=>{}}))),X=V((()=>{E("hidden"),D(y)}),P);F({container:y,classes:W,direction:K,onStart:g((e=>{X.onStart(y,e,Q)})),onStop:g((e=>{X.onStop(y,e,J),"leave"===e&&!B(X)&&(E("hidden"),D(y))}))}),(0,r.useEffect)((()=>{!H||(_===l.Hidden?L.current=null:L.current=C)}),[C,H,T]);let $=j,G={ref:k};return r.createElement(A.Provider,{value:X},r.createElement(v,{value:a(T,{visible:f.Open,hidden:f.Closed})},o({ourProps:G,theirProps:$,defaultTag:"div",features:Y,visible:"visible"===T,name:"Transition.Child"})))})),U=u((function(e,t){let{show:n,appear:s=!1,unmount:i,...l}=e,c=(0,r.useRef)(null),d=S(c,t);N();let u=x();if(void 0===n&&null!==u&&(n=a(u,{[f.Open]:!0,[f.Closed]:!1})),![!0,!1].includes(n))throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[m,p]=(0,r.useState)(n?"visible":"hidden"),h=V((()=>{p("hidden")})),[v,j]=(0,r.useState)(!0),g=(0,r.useRef)([n]);b((()=>{!1!==v&&g.current[g.current.length-1]!==n&&(g.current.push(n),j(!1))}),[g,n]);let y=(0,r.useMemo)((()=>({show:n,appear:s,initial:v})),[n,s,v]);(0,r.useEffect)((()=>{if(n)p("visible");else if(B(h)){let e=c.current;if(!e)return;let t=e.getBoundingClientRect();0===t.x&&0===t.y&&0===t.width&&0===t.height&&p("hidden")}else p("hidden")}),[n,h]);let w={unmount:i};return r.createElement(A.Provider,{value:h},r.createElement(z.Provider,{value:y},o({ourProps:{...w,as:r.Fragment,children:r.createElement(M,{ref:d,...w,...l})},theirProps:{},defaultTag:r.Fragment,features:Y,visible:"visible"===m,name:"Transition"})))})),H=u((function(e,t){let n=null!==(0,r.useContext)(z),a=null!==x();return r.createElement(r.Fragment,null,!n&&a?r.createElement(U,{ref:t,...e}):r.createElement(M,{ref:t,...e}))})),K=Object.assign(U,{Child:H,Root:U})}}]);
//# sourceMappingURL=6743-5ca3d51fc4e1085d.js.map