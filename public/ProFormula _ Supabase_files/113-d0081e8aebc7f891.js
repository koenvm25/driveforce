"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{30113:function(e,s,t){t.d(s,{dF:function(){return N},AR:function(){return T},V8:function(){return O},du:function(){return p}});var a=t(55732),r=t(34707),n=t.n(r),i=t(79894),c=t(25229),l=t(27378),d=t(24532),o=t(88983),u=t(68043),x=t(42791),m=t(24246),p=(0,c.Pi)((function(){var e=(0,x.oR)(),s=e.meta,t=e.ui,r=(0,x.UO)().ref,c=(0,l.useState)(!1),p=c[0],h=c[1],j=(0,x.FH)(u.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),y=s.extensions.byId("supabase_vault"),f=void 0===y,v=function(){var e=(0,a.Z)(n().mark((function e(){var a,r,i,c,l,d;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==y){e.next=2;break}return e.abrupt("return");case 2:return h(!0),e.next=5,s.query("create schema if not exists ".concat(null!==(a=y.schema)&&void 0!==a?a:"vault",";"));case 5:if(i=e.sent,!(c=i.error)){e.next=10;break}return h(!1),e.abrupt("return",t.setNotification({error:c,category:"error",message:"Failed to create schema: ".concat(c.message)}));case 10:return e.next=12,s.extensions.create({schema:null!==(r=y.schema)&&void 0!==r?r:"vault",name:y.name,version:y.default_version,cascade:!0});case 12:l=e.sent,(d=l.error)?(t.setNotification({error:d,category:"error",message:"Failed to enable Vault for your project: ".concat(d.message)}),h(!1)):t.setNotification({category:"success",message:"Vault is now enabled for your project!"});case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,m.jsx)("div",{children:(0,m.jsx)("div",{className:"px-12 py-12 w-full bg-white dark:bg-scale-200 border border-scale-500 rounded bg-no-repeat",style:{backgroundSize:f?"50%":"40%",backgroundPosition:"100% 24%",backgroundImage:t.isDarkTheme?'url("/img/vault-dark.png")':'url("/img/vault-light.png")'},children:(0,m.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsx)("h4",{className:"text-lg",children:"Enable Vault today"}),(0,m.jsx)("p",{className:"text-sm text-scale-1100",children:"Supabase Vault is a Postgres extension for managing secrets and encryption inside your database without leaking any sensitive information."})]}),f?(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{className:"rounded border border-scale-500 px-4 py-2 flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-scale-1100 text-sm",children:"Vault is not available for this project yet."}),(0,m.jsx)("p",{className:"text-scale-1000 text-sm",children:"Do reach out to us if you're interested!"})]}),(0,m.jsx)("div",{children:(0,m.jsx)(i.default,{href:"/support/new?ref=".concat(r,"&category=sales&subject=Request%20for%20access%20to%20vault"),children:(0,m.jsx)("a",{target:"_blank",children:(0,m.jsx)(o.zxk,{type:"primary",children:"Contact us"})})})})]}),(0,m.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,m.jsx)(i.default,{href:"https://supabase.com/docs/guides/database/vault",children:(0,m.jsx)("a",{target:"_blank",children:(0,m.jsx)(o.zxk,{type:"default",icon:(0,m.jsx)(o.TqL,{}),children:"About Vault"})})})})]}):(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)(i.default,{href:"https://supabase.com/docs/guides/database/vault",children:(0,m.jsx)("a",{target:"_blank",children:(0,m.jsx)(o.zxk,{type:"default",icon:(0,m.jsx)(o.TqL,{}),children:"About Vault"})})}),(0,m.jsxs)(d.fC,{delayDuration:0,children:[(0,m.jsx)(d.xz,{children:(0,m.jsx)(o.zxk,{type:"primary",loading:p,disabled:f||p||!j,onClick:function(){return v()},children:"Enable Vault"})}),!j&&(0,m.jsxs)(d.VY,{side:"bottom",children:[(0,m.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,m.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,m.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to enable Vault for this project"})})]})]})]})]})})})})),h=t(79305),j=t(27693),y=t.n(j),f=function(e){var s,t=e.secret,r=e.onSelectEdit,c=e.onSelectRemove,p=(0,x.oR)().vault,h=(0,x.UO)().ref,j=(0,l.useState)(!1),f=j[0],v=j[1],b=(0,l.useState)(),N=b[0],g=b[1],k=null!==(s=null===t||void 0===t?void 0:t.name)&&void 0!==s?s:"No name provided",w=(0,x.FH)(u.KA.TENANT_SQL_ADMIN_WRITE,"tables"),S=function(){var e=(0,a.Z)(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),void 0!==N){e.next=14;break}if(e.t0=g,void 0===t.decryptedSecret){e.next=7;break}e.t1=t.decryptedSecret,e.next=10;break;case 7:return e.next=9,p.fetchSecretValue(t.id);case 9:e.t1=e.sent;case 10:e.t2=e.t1,(0,e.t0)(e.t2),e.next=15;break;case 14:g(void 0);case 15:v(!1);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,m.jsxs)("div",{className:"px-6 py-4 flex items-center space-x-4",children:[(0,m.jsxs)("div",{className:"space-y-1 min-w-[35%] max-w-[35%]",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm text-scale-1200",title:k,children:k}),void 0!==t.description&&(0,m.jsx)("p",{className:"text-sm text-scale-1100",title:t.description,children:t.description})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-2 group",children:[(0,m.jsx)(o.Ol,{size:14,strokeWidth:2,className:"text-scale-1000 transition group-hover:text-brand-900"}),(0,m.jsx)(i.default,{href:"/project/".concat(h,"/settings/vault/keys?id=").concat(t.key_id),children:(0,m.jsx)("a",{className:"text-scale-1100 font-mono text-xs cursor-pointer transition group-hover:text-brand-900",title:t.key_id,children:t.key_id})})]})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-2 w-[40%]",children:[(0,m.jsx)(o.zxk,{type:"text",className:"px-1.5",icon:f?(0,m.jsx)(o.pAw,{className:"animate-spin",size:16,strokeWidth:1.5}):void 0===N?(0,m.jsx)(o.tCy,{size:16,strokeWidth:1.5}):(0,m.jsx)(o.Jib,{size:16,strokeWidth:1.5}),onClick:function(){return S()}}),(0,m.jsx)("div",{className:"flex-grow",children:void 0===N?(0,m.jsx)("p",{className:"text-sm font-mono",children:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"}):(0,m.jsx)(o.IIB,{copy:!0,size:"small",className:"font-mono",value:N})})]}),(0,m.jsxs)("div",{className:"flex items-center justify-end w-[25%] space-x-4",children:[(0,m.jsxs)("p",{className:"text-sm text-scale-1100",children:[t.updated_at===t.created_at?"Added":"Updated"," on"," ",y()(t.updated_at).format("MMM D, YYYY")]}),(0,m.jsx)(o.Ltx,{side:"bottom",className:"w-[120px]",overlay:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(d.fC,{delayDuration:0,children:[(0,m.jsx)(d.xz,{children:(0,m.jsx)(o.Ltx.Item,{icon:(0,m.jsx)(o.W_r,{size:"tiny"}),disabled:!w,onClick:function(){return r(t)},children:"Edit"})}),!w&&(0,m.jsxs)(d.VY,{side:"bottom",children:[(0,m.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,m.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,m.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to edit secrets"})})]})]}),(0,m.jsxs)(d.fC,{delayDuration:0,children:[(0,m.jsx)(d.xz,{children:(0,m.jsx)(o.Ltx.Item,{disabled:!w,icon:(0,m.jsx)(o.IT9,{stroke:"red",size:"tiny"}),onClick:function(){return c(t)},children:"Delete"})}),!w&&(0,m.jsxs)(d.VY,{side:"bottom",children:[(0,m.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,m.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,m.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to delete secrets"})})]})]})]}),children:(0,m.jsx)(o.zxk,{as:"span",type:"text",className:"px-1",icon:(0,m.jsx)(o.nqv,{})})})]})]})},v=t(90849),b=t(98784),N=function(e){var s=e.id,t=void 0===s?"keyId":s,a=e.nameId,r=void 0===a?"keyName":a,n=e.label,i=void 0===n?"Encryption key":n,c=e.labelOptional,l=e.selectedKeyId,d=e.error,u=e.onSelectKey,p=void 0===u?function(){}:u,h=e.onUpdateDescription,j=void 0===h?function(){}:h,y=(0,x.oR)().vault.listKeys();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(o.RiT,{id:t,label:i,size:"small",defaultValue:l,value:l,labelOptional:c,onChange:p,children:[(0,m.jsx)(o.RiT.Option,{id:"create-new",value:"create-new",label:"Create a new Encryption Key",addOnBefore:function(){return(0,m.jsx)(o.SC9,{size:16,strokeWidth:1.5})},children:"Create a new Encryption Key"},"create-new"),y.length>0&&(0,m.jsx)(o.u_l.Separator,{}),y.map((function(e){return(0,m.jsx)(o.RiT.Option,{label:e.name,value:e.id,children:(0,m.jsxs)("div",{className:"space-y-1",children:[(0,m.jsx)("p",{children:e.name||"No name provided"}),(0,m.jsxs)("p",{className:"text-xs",children:["ID: ",(0,m.jsx)("span",{className:"font-mono",children:e.id})]})]})},e.id)}))]}),"create-new"===l&&(0,m.jsx)(o.IIB,{id:r,label:"Name",error:d,onChange:function(e){return j(e.target.value)}})]})},g=t(51452);function k(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s&&(a=a.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,a)}return t}function w(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?k(Object(t),!0).forEach((function(s){(0,v.Z)(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):k(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}var S=function(e){var s,t,r,i=e.selectedSecret,c=e.onClose,d=(0,x.oR)(),u=d.ui,p=d.vault,h=(0,l.useState)(),j=h[0],y=h[1],f=(0,l.useState)(!1),v=f[0],k=f[1],S=(0,l.useState)(!1),C=S[0],_=S[1],I={name:null!==(s=null===i||void 0===i?void 0:i.name)&&void 0!==s?s:"",description:null!==(t=null===i||void 0===i?void 0:i.description)&&void 0!==t?t:"",secret:null!==(r=null===i||void 0===i?void 0:i.decryptedSecret)&&void 0!==r?r:""};(0,l.useEffect)((function(){void 0!==i&&(k(!1),y(i.key_id))}),[i]);var z=function(){var e=(0,a.Z)(n().mark((function e(s,t){var a,r,l,d,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.setSubmitting,r={},s.name!==i.name&&(r.name=s.name),s.description!==i.description&&(r.description=s.description),j===i.key_id){e.next=16;break}if(l=j,"create-new"!==s.keyId){e.next=15;break}return e.next=9,p.addKey(s.keyName||void 0);case 9:if(!(d=e.sent).error){e.next=14;break}return e.abrupt("return",u.setNotification({error:d.error,category:"error",message:"Failed to create new key: ".concat(d.error.message)}));case 14:l=d[0].id;case 15:r.key_id=l;case 16:if(r.secret=s.secret,(0,b.isEmpty)(r)){e.next=23;break}return a(!0),e.next=21,p.updateSecret(i.id,r);case 21:(o=e.sent).error?(u.setNotification({error:o.error,category:"error",message:"Failed to update secret: ".concat(o.error.message)}),a(!1)):(u.setNotification({category:"success",message:"Successfully updated secret"}),a(!1),c());case 23:case"end":return e.stop()}}),e)})));return function(s,t){return e.apply(this,arguments)}}();return(0,m.jsx)(o.u_l,{closable:!0,hideFooter:!0,size:"medium",visible:void 0!==i,onCancel:c,header:(0,m.jsx)("h5",{className:"text-sm text-scale-1200",children:"Edit secret"}),children:(0,m.jsx)(o.l09,{id:"add-new-secret-form",initialValues:I,validate:function(e){var s={};return 0===e.name.length&&(s.name="Please provide a name for your secret"),0===e.secret.length&&(s.secret="Please enter your secret value"),s},validateOnBlur:!1,onSubmit:z,children:function(e){var s=e.isSubmitting,t=e.resetForm;(0,l.useEffect)((function(){void 0!==i&&void 0===i.decryptedSecret&&r()}),[i]);var r=function(){var e=(0,a.Z)(n().mark((function e(){var s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==i){e.next=2;break}return e.abrupt("return");case 2:return _(!0),e.next=5,p.fetchSecretValue(i.id);case 5:s=e.sent,t({values:w(w({},I),{},{secret:s}),initialValues:w(w({},I),{},{secret:s})}),_(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return C?(0,m.jsxs)("div",{className:"space-y-2 py-4 px-2",children:[(0,m.jsx)(g.Z,{}),(0,m.jsx)("div",{className:"w-3/4",children:(0,m.jsx)(g.Z,{})}),(0,m.jsx)("div",{className:"w-1/2",children:(0,m.jsx)(g.Z,{})})]}):(0,m.jsxs)("div",{className:"py-4",children:[(0,m.jsx)(o.u_l.Content,{children:(0,m.jsxs)("div",{className:"space-y-4 pb-4",children:[(0,m.jsx)(o.IIB,{id:"name",label:"Name"}),(0,m.jsx)(o.IIB,{id:"description",label:"Description",labelOptional:"Optional"}),(0,m.jsx)(o.IIB,{id:"secret",type:v?"text":"password",label:"Secret value",actions:(0,m.jsx)("div",{className:"mr-1",children:(0,m.jsx)(o.zxk,{type:"default",icon:v?(0,m.jsx)(o.Jib,{}):(0,m.jsx)(o.tCy,{}),onClick:function(){return k(!v)}})})})]})}),(0,m.jsx)(o.u_l.Separator,{}),(0,m.jsx)(o.u_l.Content,{children:(0,m.jsx)("div",{className:"py-4 space-y-4",children:(0,m.jsx)(N,{id:"keyId",nameId:"keyName",label:"Select a key to encrypt your secret with",labelOptional:"Optional",selectedKeyId:j,onSelectKey:y})})}),(0,m.jsx)(o.u_l.Separator,{}),(0,m.jsx)(o.u_l.Content,{children:(0,m.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,m.jsx)(o.zxk,{type:"default",disabled:s,onClick:function(){return c()},children:"Cancel"}),(0,m.jsx)(o.zxk,{htmlType:"submit",disabled:s,loading:s,children:"Update secret"})]})})]})}})})},C=function(e){var s=e.selectedSecret,t=e.onClose,r=(0,x.oR)(),i=r.vault,c=r.ui,d=(0,l.useState)(!1),u=d[0],p=d[1],h=function(){var e=(0,a.Z)(n().mark((function e(){var a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.next=3,i.deleteSecret(s.id);case 3:(a=e.sent).error?c.setNotification({error:a.error,category:"error",message:"Failed to delete secret: ".concat(a.error.message)}):(c.setNotification({category:"success",message:"Successfully deleted secret ".concat(s.name)}),t()),p(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,m.jsx)(o.u_l,{closable:!0,size:"small",alignFooter:"right",visible:void 0!==s,onCancel:t,onConfirm:h,loading:u,header:(0,m.jsx)("h5",{className:"text-sm text-scale-1200",children:"Confirm to delete secret"}),children:(0,m.jsx)("div",{className:"py-4",children:(0,m.jsx)(o.u_l.Content,{children:(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsx)("p",{className:"text-sm",children:"The following secret will be permanently removed and cannot be recovered. Are you sure?"}),(0,m.jsxs)("div",{className:"space-y-1",children:[(0,m.jsx)("p",{className:"text-sm",children:null===s||void 0===s?void 0:s.description}),(0,m.jsxs)("p",{className:"text-sm text-scale-1100",children:["ID: ",(0,m.jsx)("span",{className:"font-mono",children:null===s||void 0===s?void 0:s.key_id})]})]})]})})})})},_=t(33114),I=function(e){var s=e.visible,t=e.onClose,r=(0,x.oR)(),i=r.vault,c=r.ui,d=(0,l.useState)(!1),u=d[0],p=d[1],h=(0,l.useState)(),j=h[0],y=h[1],f=i.listKeys();(0,l.useEffect)((function(){var e,t;s&&(p(!1),y(null!==(e=null===(t=f[0])||void 0===t?void 0:t.id)&&void 0!==e?e:"create-new"))}),[s]);var v=function(){var e=(0,a.Z)(n().mark((function e(s,a){var r,l,d,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=a.setSubmitting)(!0),l=j,"create-new"!==j){e.next=12;break}return e.next=6,i.addKey(s.keyName||void 0);case 6:if(!(d=e.sent).error){e.next=11;break}return e.abrupt("return",c.setNotification({error:d.error,category:"error",message:"Failed to create new key: ".concat(d.error.message)}));case 11:l=d[0].id;case 12:return e.next=14,i.addSecret({name:s.name,description:s.description,secret:s.secret,key_id:l});case 14:(o=e.sent).error?(c.setNotification({error:o.error,category:"error",message:"Failed to add secret ".concat(s.name,": ").concat(o.error.message)}),r(!1)):(c.setNotification({category:"success",message:"Successfully added new secret ".concat(s.name)}),t(),r(!1));case 16:case"end":return e.stop()}}),e)})));return function(s,t){return e.apply(this,arguments)}}();return(0,m.jsx)(o.u_l,{closable:!0,hideFooter:!0,size:"medium",visible:s,onCancel:t,header:(0,m.jsx)("h5",{className:"text-sm text-scale-1200",children:"Add new secret"}),children:(0,m.jsx)(o.l09,{id:"add-new-secret-form",initialValues:{name:"",description:"",secret:"",keyId:"",keyName:""},validate:function(e){var s={};return 0===e.name.length&&(s.name="Please provide a name for your secret"),0===e.secret.length&&(s.secret="Please enter your secret value"),"create-new"===j&&0===e.keyName.length&&(s.keyName="Please provide a name for your new key"),s},validateOnBlur:!1,onSubmit:v,children:function(e){var s=e.isSubmitting;return(0,m.jsxs)("div",{className:"py-4",children:[(0,m.jsx)(o.u_l.Content,{children:(0,m.jsxs)("div",{className:"space-y-4 pb-4",children:[(0,m.jsx)(o.IIB,{id:"name",label:"Name"}),(0,m.jsx)(o.IIB,{id:"description",label:"Description",labelOptional:"Optional"}),(0,m.jsx)(o.IIB,{id:"secret",type:u?"text":"password",label:"Secret value",actions:(0,m.jsx)("div",{className:"mr-1",children:(0,m.jsx)(o.zxk,{type:"default",icon:u?(0,m.jsx)(o.Jib,{}):(0,m.jsx)(o.tCy,{}),onClick:function(){return p(!u)}})})})]})}),(0,m.jsx)(o.u_l.Separator,{}),(0,m.jsx)(o.u_l.Content,{children:(0,m.jsxs)("div",{className:"py-4 space-y-4",children:[(0,m.jsx)(N,{id:"keyId",nameId:"keyName",label:"Select a key to encrypt your secret with",labelOptional:"Optional",selectedKeyId:j,onSelectKey:y}),(0,m.jsx)(_.Z,{icon:(0,m.jsx)(o.Sus,{size:18,strokeWidth:2}),url:"https://supabase.com/docs/guides/database/vault",urlLabel:"Vault documentation",title:"What is a key?",description:(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsx)("p",{children:"Keys are used to encrypt data inside your database, and every secret in the Vault is encrypted with a key."}),(0,m.jsx)("p",{children:"You may create different keys for different purposes, such as one for encrypting user data, and another for application data."})]})})]})}),(0,m.jsx)(o.u_l.Separator,{}),(0,m.jsx)(o.u_l.Content,{children:(0,m.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,m.jsx)(o.zxk,{type:"default",disabled:s,onClick:t,children:"Cancel"}),(0,m.jsx)(o.zxk,{htmlType:"submit",disabled:s,loading:s,children:"Add secret"})]})})]})}})})},z=t(92836),O=(0,c.Pi)((function(e){(0,h.Z)(e);var s=(0,x.oR)().vault,t=(0,x.UO)().search,a=(0,l.useState)(""),r=a[0],n=a[1],c=(0,l.useState)("updated_at"),p=c[0],j=c[1],y=(0,l.useState)(!1),v=y[0],b=y[1],N=(0,l.useState)(),g=N[0],k=N[1],w=(0,l.useState)(),_=w[0],O=w[1],D=(0,x.FH)(u.KA.TENANT_SQL_ADMIN_WRITE,"tables");(0,l.useEffect)((function(){void 0!==t&&n(t)}),[t]);var T=(r.length>0?s.listSecrets((function(e){var s;return(null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:"").toLowerCase().includes(r.toLowerCase())||e.key_id.toLowerCase().includes(r.toLowerCase())})):s.listSecrets()).sort((function(e,s){return"updated_at"===p?Number(new Date(e.updated_at))-Number(new Date(s.updated_at)):e[p]>s[p]?1:-1}));return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)(o.IIB,{className:"w-64",size:"small",placeholder:"Search by name or key ID",value:r,onChange:function(e){return n(e.target.value)},icon:(0,m.jsx)(o.jVj,{strokeWidth:2,size:16}),actions:r.length>0?[(0,m.jsx)(o.zxk,{size:"tiny",type:"text",icon:(0,m.jsx)(o.kLi,{}),className:"px-1",onClick:function(){return n("")}})]:[]}),(0,m.jsx)("div",{className:"w-32",children:(0,m.jsxs)(o.RiT,{size:"small",value:p,onChange:j,children:[(0,m.jsx)(o.RiT.Option,{id:"updated_at",className:"max-w-[180px]",value:"updated_at",label:"Sort by updated at",children:"Updated at"}),(0,m.jsx)(o.RiT.Option,{id:"name",className:"max-w-[180px]",value:"name",label:"Sort by name",children:"Name"}),(0,m.jsx)(o.RiT.Option,{id:"key_id",className:"max-w-[180px]",value:"key_id",label:"Sort by key ID",children:"Key ID"})]})})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)(i.default,{href:"https://supabase.com/docs/guides/database/vault",children:(0,m.jsx)("a",{target:"_blank",children:(0,m.jsx)(o.zxk,{type:"default",icon:(0,m.jsx)(o.TqL,{strokeWidth:1.5}),children:"Vault Documentation"})})}),(0,m.jsxs)(d.fC,{delayDuration:0,children:[(0,m.jsx)(d.xz,{children:(0,m.jsx)(o.zxk,{type:"primary",disabled:!D,onClick:function(){return b(!0)},children:"Add new secret"})}),!D&&(0,m.jsxs)(d.VY,{side:"bottom",children:[(0,m.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,m.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,m.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to add secrets"})})]})]})]})]}),(0,m.jsx)("div",{className:"border border-scale-500 rounded",children:s.isLoaded?(0,m.jsxs)(m.Fragment,{children:[T.map((function(e,s){return(0,m.jsxs)(l.Fragment,{children:[(0,m.jsx)(f,{secret:e,onSelectEdit:k,onSelectRemove:O}),s!==T.length-1&&(0,m.jsx)(z.Z,{light:!0})]},"secret-".concat(s))})),0===T.length&&(0,m.jsx)(m.Fragment,{children:0===r.length?(0,m.jsxs)("div",{className:"px-6 py-6 space-y-1 flex flex-col items-center justify-center",children:[(0,m.jsx)("p",{className:"text-sm text-scale-1200",children:"No secrets added yet"}),(0,m.jsx)("p",{className:"text-sm text-scale-1100",children:"The Vault allows you to store sensitive information like API keys"})]}):(0,m.jsxs)("div",{className:"px-6 py-4 space-y-1",children:[(0,m.jsx)("p",{className:"text-sm text-scale-1200",children:"No results found"}),(0,m.jsxs)("p",{className:"text-sm text-scale-1100",children:['Your search for "',r,'" did not return any results']})]})})]}):(0,m.jsxs)("div",{className:"px-6 py-6 space-x-2 flex items-center justify-center",children:[(0,m.jsx)(o.pAw,{className:"animate-spin text-scale-1100",size:16,strokeWidth:1.5}),(0,m.jsx)("p",{className:"text-sm text-scale-1200",children:"Loading secrets from the Vault"})]})})]}),(0,m.jsx)(S,{selectedSecret:g,onClose:function(){return k(void 0)}}),(0,m.jsx)(C,{selectedSecret:_,onClose:function(){return O(void 0)}}),(0,m.jsx)(I,{visible:v,onClose:function(){return b(!1)}})]})})),D="No description provided",T=(0,c.Pi)((function(e){var s;(0,h.Z)(e);var t=(0,x.oR)(),r=t.vault,c=t.ui,p=(0,x.UO)().id,j=(0,l.useState)(""),f=j[0],v=j[1],b=(0,l.useState)("created"),N=b[0],g=b[1],k=(0,l.useState)(!1),w=k[0],S=k[1],C=(0,l.useState)(),_=C[0],I=C[1],O=(0,l.useState)(!1),T=O[0],E=O[1],V=(0,x.FH)(u.KA.TENANT_SQL_ADMIN_WRITE,"tables");(0,l.useEffect)((function(){void 0!==p&&v(p)}),[p]);var F=(f?r.listKeys((function(e){var s;return(null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:"").toLowerCase().includes(f.toLowerCase())||e.id.toLowerCase().includes(f.toLowerCase())})):r.listKeys()).sort((function(e,s){return"created"===N?Number(new Date(e.created))-Number(new Date(s.created)):e[N]>s[N]?1:-1})),A=function(){var e=(0,a.Z)(n().mark((function e(s,t){var a,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.setSubmitting)(!0),e.next=4,r.addKey(s.name);case 4:(i=e.sent).error?c.setNotification({error:i.error,category:"error",message:"Failed to add new key: ".concat(i.error.message)}):(c.setNotification({category:"success",message:"Successfully added new key"}),S(!1)),a(!1);case 7:case"end":return e.stop()}}),e)})));return function(s,t){return e.apply(this,arguments)}}(),L=function(){var e=(0,a.Z)(n().mark((function e(){var s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=2;break}return e.abrupt("return");case 2:return E(!0),e.next=5,r.deleteKey(_.id);case 5:(s=e.sent).error?c.setNotification({error:s.error,category:"error",message:"Failed to delete encryption key: ".concat(s.error.message)}):(c.setNotification({category:"success",message:"Successfully deleted encryption key"}),I(void 0)),E(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)(o.IIB,{className:"w-64 input-clear",size:"small",placeholder:"Search by name or ID",value:f,onChange:function(e){return v(e.target.value)},icon:(0,m.jsx)(o.jVj,{strokeWidth:2,size:16}),actions:f.length>0?[(0,m.jsx)(o.zxk,{size:"tiny",type:"text",icon:(0,m.jsx)(o.kLi,{}),className:"px-1",onClick:function(){return v("")}})]:[]}),(0,m.jsx)("div",{className:"w-32",children:(0,m.jsxs)(o.RiT,{size:"small",value:N,onChange:g,children:[(0,m.jsx)(o.RiT.Option,{id:"created",className:"max-w-[180px]",value:"created",label:"Sort by created at",children:"Created at"}),(0,m.jsx)(o.RiT.Option,{id:"name",className:"max-w-[180px]",value:"name",label:"Sort by name",children:"Name"})]})})]}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)(i.default,{href:"https://supabase.com/docs/guides/database/vault",children:(0,m.jsx)("a",{target:"_blank",children:(0,m.jsx)(o.zxk,{type:"default",icon:(0,m.jsx)(o.TqL,{strokeWidth:1.5}),children:"Vault Documentation"})})}),(0,m.jsxs)(d.fC,{delayDuration:0,children:[(0,m.jsx)(d.xz,{children:(0,m.jsx)(o.zxk,{type:"primary",disabled:!V,onClick:function(){return S(!0)},children:"Add new key"})}),!V&&(0,m.jsxs)(d.VY,{side:"bottom",children:[(0,m.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,m.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,m.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to add keys"})})]})]})]})]}),(0,m.jsx)("div",{className:"border border-scale-500 rounded",children:r.isLoaded?(0,m.jsxs)(m.Fragment,{children:[F.map((function(e,s){return(0,m.jsxs)(l.Fragment,{children:[(0,m.jsxs)("div",{className:"px-6 py-4 flex items-center space-x-4",children:[(0,m.jsx)(o.Ol,{className:"text-scale-1100",strokeWidth:2}),(0,m.jsxs)("div",{className:"space-y-1 min-w-[70%] max-w-[70%]",children:[(0,m.jsx)("p",{className:"text-sm truncate text-scale-1200",title:e.name||D,children:e.name||D}),(0,m.jsxs)("p",{title:e.id,className:"text-xs text-scale-1100 font-bold truncate",children:["ID: ",(0,m.jsx)("span",{className:"font-mono",children:e.id})]})]}),(0,m.jsxs)("div",{className:"flex items-center justify-end w-[30%] space-x-4",children:[(0,m.jsxs)("p",{className:"text-sm text-scale-1100",children:["Added on ",y()(e.created).format("MMM D, YYYY")]}),(0,m.jsxs)(d.fC,{delayDuration:0,children:[(0,m.jsx)(d.xz,{children:(0,m.jsx)(o.zxk,{type:"default",className:"py-2",icon:(0,m.jsx)(o.IT9,{}),disabled:!V,onClick:function(){return I(e)}})}),!V&&(0,m.jsxs)(d.VY,{side:"bottom",children:[(0,m.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,m.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,m.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to delete keys"})})]})]})]})]}),s!==F.length-1&&(0,m.jsx)(z.Z,{light:!0})]},e.key_id)})),0===F.length&&(0,m.jsx)(m.Fragment,{children:0===f.length?(0,m.jsxs)("div",{className:"px-6 py-6 space-y-1 flex flex-col items-center justify-center",children:[(0,m.jsx)("p",{className:"text-sm text-scale-1200",children:"No encryption keys added yet"}),(0,m.jsx)("p",{className:"text-sm text-scale-1100 text-center",children:"Encryption keys are created by the pgsodium extension and can be used to encrypt your columns and secrets"})]}):(0,m.jsxs)("div",{className:"px-6 py-4 space-y-1",children:[(0,m.jsx)("p",{className:"text-sm text-scale-1200",children:"No results found"}),(0,m.jsxs)("p",{className:"text-sm text-scale-1100",children:['Your search for "',f,'" did not return any results']})]})})]}):(0,m.jsxs)("div",{className:"px-6 py-6 space-x-2 flex items-center justify-center",children:[(0,m.jsx)(o.pAw,{className:"animate-spin text-scale-1100",size:16,strokeWidth:1.5}),(0,m.jsx)("p",{className:"text-sm text-scale-1200",children:"Loading keys from the Vault"})]})})]}),(0,m.jsx)(o.u_l,{closable:!0,size:"medium",alignFooter:"right",visible:void 0!==_,onCancel:function(){return I(void 0)},onConfirm:L,loading:T,header:(0,m.jsx)("h5",{className:"text-sm text-scale-1200",children:"Confirm to delete key"}),children:(0,m.jsx)("div",{className:"py-4",children:(0,m.jsx)(o.u_l.Content,{children:(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsx)(o.bZj,{withIcon:!0,variant:"warning",title:"Deleting a key that's in use will cause any secret or column which depends on it to be unusable.",children:"Do ensure that the key is not currently in use to prevent any issues."}),(0,m.jsx)("p",{className:"text-sm",children:"The following key will be permanently removed and cannot be recovered."}),(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsx)("p",{className:"text-sm text-scale-1200",children:null!==(s=null===_||void 0===_?void 0:_.name)&&void 0!==s?s:D}),(0,m.jsx)("p",{className:"text-xs text-scale-1100",children:(0,m.jsxs)("code",{className:"!mx-0",children:["ID: ",null===_||void 0===_?void 0:_.id]})})]})]})})})}),(0,m.jsx)(o.u_l,{closable:!0,hideFooter:!0,size:"medium",visible:w,onCancel:function(){return S(!1)},header:(0,m.jsx)("h5",{className:"text-sm text-scale-1200",children:"Add a new key"}),children:(0,m.jsx)(o.l09,{id:"add-new-key-form",validateOnBlur:!1,initialValues:{name:""},validate:function(e){var s={};return 0===e.name.length&&(s.name="Please provide a name for your key"),s},onSubmit:A,children:function(e){var s=e.isSubmitting;return(0,m.jsxs)("div",{className:"py-4",children:[(0,m.jsxs)(o.u_l.Content,{children:[(0,m.jsx)("p",{className:"text-sm mb-4",children:"Provide a name for your key for easier identification."}),(0,m.jsx)("div",{className:"space-y-4 pb-4",children:(0,m.jsx)(o.IIB,{id:"name",label:"Key Name",descriptionText:"Keys are of standard UUID types."})})]}),(0,m.jsx)(o.u_l.Separator,{}),(0,m.jsx)(o.u_l.Content,{children:(0,m.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,m.jsx)(o.zxk,{type:"default",disabled:s,onClick:function(){return S(!1)},children:"Cancel"}),(0,m.jsx)(o.zxk,{htmlType:"submit",disabled:s,loading:s,children:"Add key"})]})})]})}})})]})}))}}]);
//# sourceMappingURL=113-d0081e8aebc7f891.js.map