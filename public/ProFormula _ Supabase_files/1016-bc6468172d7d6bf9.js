"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1016],{33885:function(e,t,n){n.d(t,{CM:function(){return r},$L:function(){return m},ZP:function(){return p}});var s=n(88983),i=n(24246),r=function(e){var t=e.name,n=void 0===t?"":t,r=e.limit,a=void 0===r?100:r,c=e.onUpdatePolicyName;return(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsx)("label",{className:"text-base text-scale-1100",htmlFor:"policy-name",children:"Policy name"}),(0,i.jsx)("p",{className:"text-sm text-scale-900",children:"A descriptive name for your policy"})]}),(0,i.jsx)("div",{className:"relative w-2/3",children:(0,i.jsx)(s.IIB,{id:"policy-name",value:n,onChange:function(e){return c(e.target.value)},actions:(0,i.jsxs)("span",{className:"mr-3 text-sm text-scale-900",children:[n.length,"/",a]})})})]})},a=n(27378),c=n(24532),l=n(42791),o=n(78906),d=function(e){var t=e.operation,n=void 0===t?"":t,r=e.definition,d=void 0===r?"":r,u=e.check,x=void 0===u?"":u,m=e.onUpdatePolicyUsing,h=e.onUpdatePolicyCheck,p=function(e){return["SELECT","UPDATE","DELETE","ALL"].includes(e)||!e},f=function(e){return["INSERT","UPDATE","ALL"].includes(e)},v=(0,l.D9)(n)||"";return(0,a.useEffect)((function(){p(v)&&!p(n)&&m(void 0),f(v)&&!f(n)&&h(void 0)}),[n]),(0,i.jsxs)("div",{className:"space-y-4",children:[p(n)&&(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("label",{className:"text-base text-scale-1100",htmlFor:"policy-name",children:"USING expression"}),(0,i.jsxs)(c.fC,{delayDuration:0,children:[(0,i.jsx)(c.xz,{children:(0,i.jsx)(s.Sus,{className:"text-scale-1100",size:16,strokeWidth:1.5})}),(0,i.jsxs)(c.VY,{side:"bottom",children:[(0,i.jsx)(c.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsxs)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","w-[300px] space-y-2 border border-scale-200"].join(" "),children:[(0,i.jsx)("p",{className:"text-xs text-scale-1200",children:"This expression will be added to queries that refer to the table if row-level security is enabled."}),(0,i.jsx)("p",{className:"text-xs text-scale-1200",children:"Rows for which the expression returns true will be visible. Any rows for which the expression returns false or null will not be visible to the user (in a SELECT), and will not be available for modification (in an UPDATE or DELETE)."}),(0,i.jsx)("p",{className:"text-xs text-scale-1200",children:"Such rows are silently suppressed - no error is reported."})]})]})]})]}),(0,i.jsx)("p",{className:"text-sm text-scale-900",children:"Provide a SQL conditional expression that returns a boolean."})]}),(0,i.jsx)("div",{className:"w-2/3 ".concat(f(n)?"h-32":"h-56"),children:(0,i.jsx)(o.Z,{defaultValue:d,onInputChange:m})})]}),f(n)&&(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("label",{className:"text-base text-scale-1100",htmlFor:"policy-name",children:"WITH CHECK expression"}),(0,i.jsxs)(c.fC,{delayDuration:0,children:[(0,i.jsx)(c.xz,{children:(0,i.jsx)(s.Sus,{className:"text-scale-1100",size:16,strokeWidth:1.5})}),(0,i.jsxs)(c.VY,{side:"bottom",children:[(0,i.jsx)(c.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsxs)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","w-[300px] space-y-2 border border-scale-200"].join(" "),children:[(0,i.jsx)("p",{className:"text-xs text-scale-1200",children:"This expression will be used in INSERT and UPDATE queries against the table if row-level security is enabled."}),(0,i.jsx)("p",{className:"text-xs text-scale-1200",children:"Only rows for which the expression evaluates to true will be allowed. An error will be thrown if the expression evaluates to false or null for any of the records inserted or any of the records that result from the update."}),(0,i.jsx)("p",{className:"text-xs text-scale-1200",children:"Note that this expression is evaluated against the proposed new contents of the row, not the original contents."})]})]})]})]}),(0,i.jsx)("p",{className:"text-sm text-scale-900",children:"Provide a SQL conditional expression that returns a boolean."})]}),(0,i.jsx)("div",{className:"w-2/3 ".concat(p(n)?"h-32":"h-56"),children:(0,i.jsx)(o.Z,{defaultValue:x,onInputChange:h})})]})]})},u=function(e){var t=e.operation,n=void 0===t?"":t,r=e.onSelectOperation;return(0,i.jsxs)("div",{className:"flex justify-between space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsx)("label",{className:"text-base text-scale-1100",htmlFor:"allowed-operation",children:"Allowed operation"}),(0,i.jsx)("p",{className:"text-sm text-scale-900",children:"Select an operation for this policy"})]}),(0,i.jsx)("div",{className:"w-2/3",children:(0,i.jsx)("div",{className:"flex items-center space-x-8",children:(0,i.jsx)(s.Y8K.Group,{type:"small-cards",size:"tiny",id:"allowed-operation",children:["SELECT","INSERT","UPDATE","DELETE","ALL"].map((function(e){return(0,i.jsx)(s.Y8K,{name:"allowed-operation",label:e,value:e,checked:n===e,onChange:function(e){return r(e.target.value)}},e)}))})})})]})},x=n(27434),m=function(e){var t=e.roles,n=e.selectedRoles,s=e.onUpdateSelectedRoles,r=t.map((function(e){return{id:e.id,name:e.name,value:e.name,disabled:!1}}));return(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsx)("label",{className:"text-scale-1100 text-base",htmlFor:"policy-name",children:"Target roles"}),(0,i.jsx)("p",{className:"text-scale-900 text-sm",children:"Apply policy to the selected roles"})]}),(0,i.jsx)("div",{className:"relative w-2/3",children:(0,i.jsx)(x.Z,{options:r,value:n,placeholder:"Defaults to all (public) roles if none selected",searchPlaceholder:"Search for a role",onChange:s})})]})},h=function(e){var t=e.showTemplates,n=e.onViewTemplates,r=e.onReviewPolicy;return(0,i.jsxs)("div",{className:"flex justify-between items-center border-t px-6 py-4 dark:border-dark",children:[(0,i.jsx)("a",{href:"https://supabase.com/docs/learn/auth-deep-dive/auth-policies",target:"_blank",children:(0,i.jsx)(s.zxk,{type:"link",icon:(0,i.jsx)(s.TqL,{size:14,strokeWidth:1.5}),children:"Documentation"})}),(0,i.jsxs)("div",{className:"flex w-full items-center justify-end gap-2",children:[t&&(0,i.jsx)(s.zxk,{type:"default",onClick:n,children:"View templates"}),(0,i.jsx)(s.zxk,{type:"primary",onClick:r,children:"Review"})]})]})},p=function(e){var t,n,a,c,l=e.isNewPolicy,o=void 0===l||l,x=e.roles,p=void 0===x?[]:x,f=e.policyFormFields,v=void 0===f?{}:f,j=e.onUpdatePolicyFormFields,y=void 0===j?function(){}:j,b=e.onViewTemplates,g=void 0===b?function(){}:b,N=e.onReviewPolicy,w=void 0===N?function(){}:N,E=null!==(t=null===v||void 0===v?void 0:v.command)&&void 0!==t?t:"",k=null!==(n=null===v||void 0===v?void 0:v.definition)&&void 0!==n?n:"",S=null!==(a=null===v||void 0===v?void 0:v.check)&&void 0!==a?a:"",T=(null!==(c=null===v||void 0===v?void 0:v.roles)&&void 0!==c?c:[]).filter((function(e){return"public"!==e}));return(0,i.jsxs)("div",{className:"",children:[(0,i.jsxs)("div",{className:"space-y-8 py-8",children:[(0,i.jsx)(s.u_l.Content,{children:(0,i.jsx)(r,{name:v.name,limit:63,onUpdatePolicyName:function(e){return y({name:e})}})}),(0,i.jsx)(s.u_l.Separator,{}),o&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.u_l.Content,{children:(0,i.jsx)(u,{operation:E,onSelectOperation:function(e){return y({command:e})}})}),(0,i.jsx)(s.u_l.Separator,{})]}),(0,i.jsx)(s.u_l.Content,{children:(0,i.jsx)(m,{roles:p,selectedRoles:T,onUpdateSelectedRoles:function(e){return y({roles:e})}})}),(0,i.jsx)(s.u_l.Separator,{}),(0,i.jsx)(s.u_l.Content,{children:(0,i.jsx)(d,{operation:E,definition:k,check:S,onUpdatePolicyUsing:function(e){return y({definition:e})},onUpdatePolicyCheck:function(e){return y({check:e})}})})]}),(0,i.jsx)(h,{showTemplates:o,onViewTemplates:g,onReviewPolicy:w})]})}},1016:function(e,t,n){n.d(t,{$A:function(){return D},rE:function(){return v},yV:function(){return z},pT:function(){return C},tV:function(){return H},jm:function(){return S}});var s=n(55732),i=n(34707),r=n.n(i),a=n(27378),c=n(98784),l=n(88983),o=n(86677),d=n(25229),u=n(42791),x=n(96364),m=n(30259),h=n(89744),p=n(33114),f=n(24246),v=(0,d.Pi)((function(e){var t=e.tables,n=e.hasTables,i=e.isLocked,d=(0,o.useRouter)(),v=(0,u.UO)().ref,j=(0,u.oR)(),y=j.ui,b=j.meta,g=b.roles.list((function(e){return!b.roles.systemRoles.includes(e.name)})),N=(0,a.useState)({}),w=N[0],E=N[1],k=(0,a.useState)({}),S=k[0],T=k[1],C=(0,a.useState)({}),L=C[0],P=C[1],O=(0,a.useState)({}),R=O[0],I=O[1],D=function(){P({}),E({})},A=function(){I({}),T({})},Z=function(e){T(e)},_=function(e){E({schema:e.schema,table:e.name})},U=function(e){P(e),E({schema:e.schema,table:e.table})},F=function(e){I(e)},V=function(){var e=(0,s.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.setNotification({category:"success",message:"Policy successfully saved!"}),D();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=(0,s.Z)(r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={id:S.id,rls_enabled:!S.rls_enabled},e.next=3,b.tables.update(t.id,t);case 3:(n=e.sent).error&&y.setNotification({category:"error",message:"Failed to toggle RLS: ".concat(n.error.message)}),A();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=(0,s.Z)(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.policies.create(t);case 2:if(!(n=e.sent).error){e.next=6;break}return y.setNotification({category:"error",message:"Error adding policy: ".concat(n.error.message)}),e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=(0,s.Z)(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.policies.update(t.id,t);case 2:if(!(n=e.sent).error){e.next=6;break}return y.setNotification({category:"error",message:"Error updating policy: ".concat(n.error.message)}),e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=(0,s.Z)(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.policies.del(R.id);case 2:"boolean"!==typeof(t=e.sent)&&t.error?y.setNotification({category:"error",message:"Error deleting policy: ".concat(t.error.message)}):y.setNotification({category:"success",message:"Successfully deleted policy!"}),A();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,f.jsxs)(f.Fragment,{children:[t.length>0?t.map((function(e){return(0,f.jsx)("section",{children:(0,f.jsx)(H,{table:e,isLocked:i,onSelectToggleRLS:Z,onSelectCreatePolicy:_,onSelectEditPolicy:U,onSelectDeletePolicy:F})},e.id)})):n?(0,f.jsx)(m.Z,{}):(0,f.jsx)("div",{className:"flex-grow",children:(0,f.jsx)(h.Z,{size:"large",title:"Row-Level Security (RLS) Policies",ctaButtonLabel:"Create a table",infoButtonLabel:"What is RLS?",infoButtonUrl:"https://supabase.com/docs/guides/auth/row-level-security",onClickCta:function(){return d.push("/project/".concat(v,"/editor"))},children:(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsx)(p.Z,{title:"What are policies?",icon:(0,f.jsx)(l.Sus,{strokeWidth:2}),description:(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("p",{className:"text-sm",children:"Policies restrict, on a per-user basis, which rows can be returned by normal queries, or inserted, updated, or deleted by data modification commands."}),(0,f.jsx)("p",{className:"text-sm",children:"This is also known as Row-Level Security (RLS). Each policy is attached to a table, and the policy is executed each time its accessed."})]})}),(0,f.jsx)("p",{className:"text-sm text-scale-1100",children:"Create a table in this schema first before creating a policy."})]})})}),(0,f.jsx)(z,{visible:!(0,c.isEmpty)(w),roles:g,schema:w.schema,table:w.table,selectedPolicyToEdit:L,onSelectCancel:D,onCreatePolicy:q,onUpdatePolicy:Y,onSaveSuccess:V}),(0,f.jsx)(x.Z,{danger:!0,visible:!(0,c.isEmpty)(R),title:"Confirm to delete policy",description:'This is permanent! Are you sure you want to delete the policy "'.concat(R.name,'"'),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:A,onSelectConfirm:M}),(0,f.jsx)(x.Z,{danger:S.rls_enabled,visible:!(0,c.isEmpty)(S),title:"Confirm to ".concat(S.rls_enabled?"disable":"enable"," RLS"),description:"Are you sure you want to ".concat(S.rls_enabled?"disable":"enable",' row level security for the table "').concat(S.name,'"?'),buttonLabel:"Confirm",buttonLoadingLabel:"Saving",onSelectCancel:A,onSelectConfirm:W})]})})),j=n(90849),y=function(e){var t=e.view,n=e.schema,s=e.table,i=e.isNewPolicy,r=e.onSelectBackFromTemplates,a=void 0===r?function(){}:r;return t===D.TEMPLATES?(0,f.jsx)("div",{className:"",children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("span",{onClick:a,className:"cursor-pointer text-scale-900 transition-colors hover:text-scale-1200",children:(0,f.jsx)(l.ed9,{strokeWidth:2,size:14})}),(0,f.jsx)("h4",{className:"m-0 text-lg",children:"Select a template to use for your new policy"})]})}):(0,f.jsx)("div",{className:"flex items-center space-x-3",children:(0,f.jsx)("h4",{className:"m-0 truncate text-lg",children:t===D.EDITOR||t===D.SELECTION?"".concat(i?"Adding new policy to":"Editing policy from"," ").concat(n,".").concat(s):t===D.REVIEW?"Reviewing policy to be ".concat(i?"created":"updated"," on ").concat(n,".").concat(s):void 0})})},b=function(e,t){return[{id:"policy-1",templateName:"Enable read access to everyone",description:"This policy gives read access to your table for all users via the SELECT operation.",statement:'\nCREATE POLICY "policy_name"\nON '.concat(e,".").concat(t,"\nFOR SELECT USING (\n  true\n);").trim(),name:"Enable read access for all users",definition:"true",check:"",command:"SELECT",roles:[]},{id:"policy-2",templateName:"Enable insert access for authenticated users only",description:"This policy gives insert access to your table for all authenticated users only.",statement:'\nCREATE POLICY "policy_name"\nON '.concat(e,".").concat(t,"\nFOR INSERT \nTO authenticated \nWITH CHECK (true);").trim(),name:"Enable insert for authenticated users only",definition:"",check:"true",command:"INSERT",roles:["authenticated"]},{id:"policy-3",templateName:"Enable update access for users based on their email *",description:'This policy assumes that your table has a column "email", and allows users to update rows which the "email" column matches their email.',statement:'\nCREATE POLICY "policy_name"\nON '.concat(e,".").concat(t,"\nFOR UPDATE USING (\n  auth.jwt() ->> 'email' = email\n) WITH CHECK (\n  auth.jwt() ->> 'email' = email\n);").trim(),name:"Enable update for users based on email",definition:"auth.jwt() ->> 'email' = email",check:"auth.jwt() ->> 'email' = email",command:"UPDATE",roles:[]},{id:"policy-4",templateName:"Enable delete access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to delete rows which the "user_id" column matches their ID',statement:'\nCREATE POLICY "policy_name"\nON '.concat(e,".").concat(t,"\nFOR DELETE USING (\n  auth.uid() = user_id\n);").trim(),name:"Enable delete for users based on user_id",definition:"auth.uid() = user_id",check:"",command:"DELETE",roles:[]}]},g=n(33885),N=n(78906),w=function(e){var t=e.policy,n=void 0===t?{}:t,s=e.onSelectBack,i=void 0===s?function(){}:s,r=e.onSelectSave,o=void 0===r?function(){}:r,d=(0,a.useState)(!1),u=d[0],x=d[1],m=n.statement||"";return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(l.u_l.Content,{children:(0,f.jsxs)("div",{className:"space-y-6 py-8",children:[(0,f.jsx)("div",{className:"flex items-center justify-between space-y-8",children:(0,f.jsx)("div",{className:"flex flex-col",children:(0,f.jsx)("p",{className:"text-sm text-scale-1100",children:"This is the SQL statement that will be used to create your policy."})})}),(0,f.jsx)("div",{className:"space-y-4 overflow-y-auto",style:{maxHeight:"25rem"},children:(0,c.isEmpty)(n)?(0,f.jsx)("div",{className:"my-10 flex items-center justify-center space-x-2 opacity-50",children:(0,f.jsx)("p",{className:"text-base text-scale-1100",children:"There are no changes made to this policy"})}):(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("span",{children:n.description}),(0,f.jsx)("div",{className:"h-40",children:(0,f.jsx)(N.Z,{readOnly:!0,defaultValue:m})})]})})]})}),(0,f.jsxs)("div",{className:"flex w-full items-center justify-end gap-2 border-t px-6 py-4 dark:border-dark",children:[(0,f.jsx)(l.zxk,{type:"default",onClick:i,children:"Back to edit"}),(0,f.jsx)(l.zxk,{type:"primary",disabled:(0,c.isEmpty)(n),onClick:function(){x(!0),o()},loading:u,children:"Save policy"})]})]})},E=function(e){var t=e.templates,n=void 0===t?[]:t,s=e.templatesNote,i=void 0===s?"":s,r=e.selectedTemplate,a=e.setSelectedTemplate,c=void 0===a?function(){}:a;return(0,f.jsxs)("div",{className:"flex flex-col justify-between border-r dark:border-dark",style:{width:"30%"},children:[(0,f.jsx)("div",{className:"hide-scrollbar  divide-border-primary space-y-0 divide-y divide-solid overflow-y-auto",style:{maxHeight:"24rem"},children:(0,f.jsx)(l.v2r,{type:"border",children:n.map((function(e,t){var n=r===e;return(0,f.jsx)("div",{className:"border-b border-scale-400 hover:bg-scale-400 "+(n?"bg-scale-300 dark:bg-scale-500":""),children:(0,f.jsx)(l.v2r.Item,{active:n,onClick:function(){return c(e)},children:(0,f.jsx)("div",{className:"truncate py-2",children:e.templateName})},e.id)},t)}))})}),i&&(0,f.jsx)("div",{className:"px-4 py-2",children:(0,f.jsx)("p",{className:"text-xs text-scale-900",children:i})})]})},k=function(e){var t=e.selectedTemplate,n=t.id,s=t.templateName,i=t.description,r=t.statement;return(0,f.jsx)("div",{className:"space-y-8",style:{width:"70%"},children:!(0,c.isEmpty)(t)&&(0,f.jsx)("div",{className:"flex h-full flex-col justify-between",children:(0,f.jsxs)("div",{className:"my-5 h-full space-y-6 px-6",children:[(0,f.jsx)("div",{className:"space-y-2",children:(0,f.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,f.jsx)("h3",{className:"text-scale-1200 text-base",children:s}),(0,f.jsx)("p",{className:"text-scale-1100 text-sm",children:i})]})}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("label",{className:"text-scale-1100 text-sm",children:"Policy SQL template:"}),(0,f.jsx)("div",{className:"h-64",children:(0,f.jsx)(N.Z,{readOnly:!0,queryId:n,defaultValue:r})})]})]})})})},S=function(e){var t=e.templates,n=void 0===t?[]:t,s=e.templatesNote,i=void 0===s?"":s,r=e.onUseTemplate,o=void 0===r?function(){}:r,d=(0,a.useState)(n[0]),u=d[0],x=d[1];return(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"flex justify-between border-t dark:border-dark",children:[(0,f.jsx)(E,{templatesNote:i,templates:n,selectedTemplate:u,setSelectedTemplate:x}),(0,f.jsx)(k,{selectedTemplate:u})]}),(0,f.jsxs)("div",{className:"flex w-full items-center justify-end gap-3 border-t px-6 py-4 dark:border-dark",children:[(0,f.jsx)("span",{className:"text-sm text-scale-900",children:"This will override any existing code you've written"}),(0,f.jsx)(l.zxk,{type:"primary",disabled:(0,c.isEmpty)(u),onClick:function(){return o(u)},children:"Use this template"})]})]})},T=n(84151),C=function(e){var t=e.description,n=void 0===t?"":t,s=e.onViewTemplates,i=void 0===s?function(){}:s,r=e.onViewEditor,a=void 0===r?function(){}:r;return(0,f.jsx)(l.u_l.Content,{children:(0,f.jsxs)("div",{className:"space-y-6 py-8",children:[(0,f.jsx)("div",{children:(0,f.jsx)("p",{className:"text-sm text-scale-1100",children:n})}),(0,f.jsxs)("div",{className:"grid grid-cols-1 gap-2 lg:grid-cols-1",children:[(0,f.jsx)(T.Z,{title:"Get started quickly",description:"Create a policy from a template",icon:(0,f.jsx)("div",{className:"flex",children:(0,f.jsx)("div",{className:" flex h-8 w-8 items-center justify-center rounded bg-scale-1200 text-scale-100   ",children:(0,f.jsx)(l.w2d,{size:14,strokeWidth:2})})}),onClick:i}),(0,f.jsx)(T.Z,{title:"For full customization",description:"Create a policy from scratch",icon:(0,f.jsx)("div",{className:"flex",children:(0,f.jsx)("div",{className:" flex h-8 w-8 items-center justify-center rounded bg-scale-1200 text-scale-100   ",children:(0,f.jsx)(l.yl5,{size:14,strokeWidth:2})})}),onClick:a})]}),(0,f.jsxs)("p",{className:"text-sm text-scale-1100",children:["Not sure what policies are? Check out our resources"," ",(0,f.jsx)("a",{target:"_blank",className:"text-brand-900 transition-colors hover:text-brand-1200",href:"https://supabase.com/docs/guides/auth#policies",children:"here"}),"."]})]})})},L=n(44285);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,j.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R=function(e){var t=e.name,n=e.definition,s=e.check,i=e.command,r=e.schema,a=e.table,c=0===e.roles.length?["public"]:e.roles;return{description:"Add policy for the ".concat(i,' operation under the policy "').concat(t,'"'),statement:['CREATE POLICY "'.concat(t,'" ON "').concat(r,'"."').concat(a,'"'),"AS PERMISSIVE FOR ".concat(i),"TO ".concat(c.join(", ")),"".concat(n?"USING (".concat(n,")"):""),"".concat(s?"WITH CHECK (".concat(s,")"):"")].join("\n")}},I=function(e,t){var n,s=e.name,i=e.schema,r=e.table,a=(0,c.has)(t,["definition"]),l=(0,c.has)(t,["check"]),o=(0,c.has)(t,["name"]),d=(0,c.has)(t,["roles"]),u=Object.keys(t),x="Update policy's ".concat(1===u.length?u[0]:"".concat(u.slice(0,u.length-1).join(", ")," and ").concat(u[u.length-1])," "),m=0===(null!==(n=null===t||void 0===t?void 0:t.roles)&&void 0!==n?n:[]).length?["public"]:t.roles,h='ALTER POLICY "'.concat(s,'" ON "').concat(i,'"."').concat(r,'"');return{description:x,statement:["BEGIN;"].concat((0,L.Z)(a?["  ".concat(h," USING (").concat(t.definition,");")]:[]),(0,L.Z)(l?["  ".concat(h," WITH CHECK (").concat(t.check,");")]:[]),(0,L.Z)(d?["  ".concat(h," TO ").concat(m.join(", "),";")]:[]),(0,L.Z)(o?["  ".concat(h,' RENAME TO "').concat(t.name,'";')]:[]),["COMMIT;"]).join("\n")}},D={SELECTION:"SELECTION",TEMPLATES:"TEMPLATES",EDITOR:"EDITOR",REVIEW:"REVIEW"};function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,j.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=function(e){var t=e.visible,n=void 0!==t&&t,i=e.roles,o=void 0===i?[]:i,d=e.schema,x=void 0===d?"":d,m=e.table,h=void 0===m?"":m,p=e.selectedPolicyToEdit,v=void 0===p?{}:p,j=e.onSelectCancel,N=void 0===j?function(){}:j,E=e.onCreatePolicy,k=void 0===E?function(){}:E,T=e.onUpdatePolicy,L=void 0===T?function(){}:T,P=e.onSaveSuccess,A=void 0===P?function(){}:P,z=(0,u.oR)().ui,_={schema:x,table:h,name:"",definition:"",check:"",command:null,roles:[]},U=(0,c.isEmpty)(v),F=U?_:v,V=(0,a.useState)(""),W=V[0],q=V[1],H=(0,a.useState)(D.EDITOR),Y=H[0],M=H[1],B=(0,a.useState)(F),K=B[0],G=B[1],Q=(0,a.useState)(""),J=Q[0],$=Q[1];(0,a.useEffect)((function(){n&&(U?X():ee(),G(F))}),[n]);var X=function(){return M(D.SELECTION)},ee=function(){return M(D.EDITOR)},te=function(){q(Y),M(D.TEMPLATES)},ne=function(){var e=(0,s.Z)(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!U){e.next=6;break}return e.next=3,k(t);case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,L(t);case 8:e.t0=e.sent;case 9:e.t0?ee():A();case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,f.jsx)(l.u_l,{size:Y===D.SELECTION?"medium":"xxlarge",closable:!0,hideFooter:!0,visible:n,contentStyle:{padding:0},header:[(0,f.jsx)(y,{view:Y,isNewPolicy:U,schema:x,table:h,onSelectBackFromTemplates:function(){return M(W)}},"0")],onCancel:N,onInteractOutside:function(e){var t;(null===(t=e.target)||void 0===t?void 0:t.closest("#toast"))&&e.preventDefault()},children:(0,f.jsx)("div",{className:"",children:Y===D.SELECTION?(0,f.jsx)(C,{description:"Write rules with PostgreSQL's policies to fit your unique business needs.",onViewTemplates:te,onViewEditor:ee}):Y===D.EDITOR?(0,f.jsx)(g.ZP,{isNewPolicy:U,roles:o,policyFormFields:K,onUpdatePolicyFormFields:function(e){e.name&&e.name.length>63||G(Z(Z({},K),e))},onViewTemplates:te,onReviewPolicy:function(){var e=K.name,t=K.definition,n=K.check,s=K.command;if(0===e.length)return z.setNotification({category:"error",message:"Do give your policy a name"});if(!s)return z.setNotification({category:"error",message:"You will need to allow at one operation in your policy",duration:4e3});if(["SELECT","DELETE"].includes(s)&&!t)return z.setNotification({category:"error",message:"Did you forget to provide a USING expression for your policy?",duration:4e3});if("INSERT"===s&&!n)return z.setNotification({category:"error",message:"Did you forget to provide a WITH CHECK expression for your policy?",duration:4e3});if("UPDATE"===s&&!t&&!n)return z.setNotification({category:"error",message:"You will need to provide either a USING, or WITH CHECK expression, or both for your policy",duration:4e3});var i=function(e,t){var n=e.definition,s=e.check,i=O(O({},e),{},{definition:n?n.replace(/\s+/g," ").trim():void 0===n?null:n,check:s?s.replace(/\s+/g," ").trim():void 0===s?null:s});if((0,c.isEmpty)(t))return R(i);if((0,c.isEqual)(e,t))return{};var r={};return(0,c.isEqual)(i.name,t.name)||(r.name=i.name),(0,c.isEqual)(i.definition,t.definition)||(r.definition=i.definition),(0,c.isEqual)(i.check,t.check)||(r.check=i.check),(0,c.isEqual)(i.roles,t.roles)||(r.roles=i.roles),(0,c.isEmpty)(r)?{}:I(i,r)}(K,v);$(i),M(D.REVIEW)}}):Y===D.TEMPLATES?(0,f.jsx)(S,{templates:b(x,h),templatesNote:"* References a specific column in the table",onUseTemplate:function(e){G(Z(Z({},K),{},{name:e.name,definition:e.definition,check:e.check,command:e.command,roles:e.roles})),ee()}}):Y===D.REVIEW?(0,f.jsx)(w,{policy:J,onSelectBack:ee,onSelectSave:function(){var e=U?function(e){var t=e.command,n=e.definition,s=e.check,i=e.roles;return O(O({},e),{},{action:"PERMISSIVE",command:t||void 0,definition:n||void 0,check:s||void 0,roles:i.length>0?i:void 0})}(K):function(e,t){var n=e.definition,s=e.check,i=O(O({},e),{},{definition:n?n.replace(/\s+/g," ").trim():n,check:s?s.replace(/\s+/g," ").trim():s}),r={id:t.id};return(0,c.isEqual)(i.name,t.name)||(r.name=i.name),(0,c.isEqual)(i.definition,t.definition)||(r.definition=i.definition||void 0),(0,c.isEqual)(i.check,t.check)||(r.check=i.check||void 0),(0,c.isEqual)(i.roles,t.roles)||(0===i.roles.length?r.roles=["public"]:r.roles=i.roles||void 0),r}(K,v);ne(e)}}):(0,f.jsx)("div",{})})})},_=n(79894),U=n(24532),F=n(68043),V=function(e){var t=e.table,n=e.isLocked,s=e.onSelectToggleRLS,i=void 0===s?function(){}:s,r=e.onSelectCreatePolicy,a=void 0===r?function(){}:r,c=(0,o.useRouter)().query.ref,d=(0,u.FH)(F.KA.TENANT_SQL_ADMIN_WRITE,"tables"),x=(0,u.FH)(F.KA.TENANT_SQL_ADMIN_WRITE,"policies");return(0,f.jsxs)("div",{id:t.id.toString(),className:"flex w-full items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex space-x-4 text-left",children:[(0,f.jsx)(_.default,{href:"/project/".concat(c,"/editor/").concat(t.id),children:(0,f.jsx)("a",{children:(0,f.jsx)("h4",{className:"m-0",children:t.name})})}),(0,f.jsx)(l.Cts,{color:t.rls_enabled?"green":"yellow",children:t.rls_enabled?"RLS enabled":"RLS disabled"})]}),!n&&(0,f.jsx)("div",{className:"flex-1",children:(0,f.jsxs)("div",{className:"flex flex-row-reverse",children:[(0,f.jsxs)(U.fC,{delayDuration:0,children:[(0,f.jsx)(U.xz,{children:(0,f.jsx)(l.zxk,{type:"outline",disabled:!x,className:"ml-2",onClick:function(){return a(t)},children:"New Policy"})}),!x&&(0,f.jsxs)(U.VY,{side:"bottom",children:[(0,f.jsx)(U.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to create RLS policies"})})]})]}),(0,f.jsxs)(U.fC,{delayDuration:0,children:[(0,f.jsx)(U.xz,{children:(0,f.jsx)(l.zxk,{type:"default",disabled:!d,onClick:function(){return i(t)},children:t.rls_enabled?"Disable RLS":"Enable RLS"})}),!d&&(0,f.jsxs)(U.VY,{side:"bottom",children:[(0,f.jsx)(U.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to toggle RLS"})})]})]})]})})]})},W=n(96423),q=function(e){var t=e.policy,n=e.onSelectEditPolicy,s=void 0===n?function(){}:n,i=e.onSelectDeletePolicy,r=void 0===i?function(){}:i,a=(0,u.FH)(F.KA.TENANT_SQL_ADMIN_WRITE,"policies");return(0,f.jsxs)(W.Z.Content,{className:["flex border-panel-border-light dark:border-panel-border-dark","w-full space-x-4 border-b py-4 lg:items-center"].join(" "),children:[(0,f.jsxs)("div",{className:"flex grow flex-col space-y-1",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,f.jsx)("p",{className:"font-mono text-xs text-scale-1000",children:t.command}),(0,f.jsx)("p",{className:"text-sm text-scale-1200",children:t.name})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)("p",{className:"text-scale-1000 text-sm",children:"Applied to:"}),t.roles.map((function(e,t){return(0,f.jsx)("code",{className:"text-scale-1000 text-xs",children:e},"policy-".concat(e,"-").concat(t))}))]})]}),(0,f.jsx)("div",{children:a?(0,f.jsx)(l.Ltx,{side:"bottom",align:"end",size:"small",overlay:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(l.Ltx.Item,{icon:(0,f.jsx)(l.yl5,{size:14}),onClick:function(){return s(t)},children:"Edit"}),(0,f.jsx)(l.Ltx.Separator,{}),(0,f.jsx)(l.Ltx.Item,{icon:(0,f.jsx)(l.IT9,{size:14}),onClick:function(){return r(t)},children:"Delete"})]}),children:(0,f.jsx)(l.zxk,{type:"default",style:{paddingLeft:4,paddingRight:4},icon:(0,f.jsx)(l.nqv,{})})}):(0,f.jsxs)(U.fC,{delayDuration:0,children:[(0,f.jsx)(U.xz,{children:(0,f.jsx)(l.zxk,{disabled:!0,type:"default",style:{paddingLeft:4,paddingRight:4},icon:(0,f.jsx)(l.nqv,{})})}),!a&&(0,f.jsxs)(U.VY,{side:"left",children:[(0,f.jsx)(U.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to edit RLS policies"})})]})]})})]})},H=(0,d.Pi)((function(e){var t=e.table,n=e.isLocked,s=e.onSelectToggleRLS,i=void 0===s?function(){}:s,r=e.onSelectCreatePolicy,a=void 0===r?function(){}:r,c=e.onSelectEditPolicy,o=void 0===c?function(){}:c,d=e.onSelectDeletePolicy,x=void 0===d?function(){}:d,m=(0,u.oR)().meta.policies.list((function(e){return e.schema===t.schema&&e.table===t.name}));return(0,f.jsxs)(W.Z,{title:(0,f.jsx)(V,{table:t,isLocked:n,onSelectToggleRLS:i,onSelectCreatePolicy:a}),children:[0===m.length&&(0,f.jsxs)("div",{className:"p-4 px-6 space-y-1",children:[(0,f.jsx)("p",{className:"text-scale-1100 text-sm",children:"No policies created yet"}),t.rls_enabled?(0,f.jsx)("p",{className:"text-scale-1000 text-sm",children:"RLS is enabled - create a policy to allow access to this table."}):(0,f.jsx)(l.bZj,{withIcon:!0,variant:"warning",className:"!px-4 !py-3 !mt-3",title:"Warning: RLS is disabled",children:"Anonymous access is allowed to this table"})]}),m.map((function(e){return(0,f.jsx)(q,{policy:e,onSelectEditPolicy:o,onSelectDeletePolicy:x},e.id)}))]})}))},30259:function(e,t,n){var s=n(38480),i=n(24246);t.Z=function(){return(0,i.jsxs)("div",{className:"flex h-64 flex-col items-center justify-center",children:[(0,i.jsx)(s.Z,{src:"/img/no-search-results.svg",preProcessor:function(e){return e.replace(/svg/,'svg className="mb-2 w-16 h-16 text-color-inherit"')}}),(0,i.jsx)("p",{className:"w-64 text-center text-sm opacity-50",children:"Hmm, we couldn't find any results that matches your query. Try another?"})]})}},89744:function(e,t,n){var s=n(88983),i=n(24532),r=n(24246);t.Z=function(e){var t=e.title,n=void 0===t?"":t,a=e.size,c=void 0===a?"medium":a,l=e.children,o=e.ctaButtonLabel,d=void 0===o?"":o,u=e.infoButtonLabel,x=void 0===u?"":u,m=e.infoButtonUrl,h=void 0===m?"":m,p=e.onClickCta,f=void 0===p?function(){}:p,v=e.disabled,j=void 0!==v&&v,y=e.disabledMessage,b=void 0===y?"":y,g=d&&f||h&&x;return(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,r.jsx)("div",{className:"flex space-x-4 rounded border border-panel-border-light bg-panel-body-light p-6 shadow-md dark:border-panel-border-dark dark:bg-panel-body-dark",children:(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsxs)("div",{className:"".concat("medium"===c?"w-80":"w-[400px]"," space-y-4"),children:[(0,r.jsx)("h5",{children:n}),(0,r.jsx)("div",{className:"flex flex-col space-y-2",children:l}),g&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[d&&f&&(0,r.jsxs)(i.fC,{delayDuration:0,children:[(0,r.jsx)(i.xz,{children:(0,r.jsx)(s.zxk,{type:"primary",onClick:f,disabled:j,children:d})}),j&&b.length>0&&(0,r.jsxs)(i.VY,{side:"bottom",children:[(0,r.jsx)(i.Eh,{className:"radix-tooltip-arrow"}),(0,r.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,r.jsx)("span",{className:"text-xs text-scale-1200",children:b})})]})]}),h&&x?(0,r.jsx)(s.zxk,{type:"default",icon:(0,r.jsx)(s.TqL,{size:14,strokeWidth:1.5}),children:(0,r.jsx)("a",{target:"_blank",href:h,children:x})}):null]})]})})})})}},84151:function(e,t,n){var s=n(44285),i=(n(27378),n(88983)),r=n(79894),a=n(24246);t.Z=function(e){var t=e.title,n=e.description,c=e.children,l=e.footer,o=e.url,d=void 0===o?"":o,u=e.linkHref,x=void 0===u?"":u,m=e.imgUrl,h=e.imgAlt,p=e.onClick,f=e.icon,v=e.containerHeightClassName,j=function(e){var t=e.children;return(0,a.jsx)(r.default,{href:x,children:(0,a.jsx)("a",{children:t})})},y=function(e){var t=e.children;return(0,a.jsx)("a",{href:d,children:t})},b=function(e){var t=e.children;return(0,a.jsx)("div",{children:t})},g=function(e){var t=e.children;return(0,a.jsx)("button",{onClick:p,children:t})},N=d||x||p,w=["group relative text-left","bg-panel-header-light dark:bg-panel-header-dark","border border-panel-border-light dark:border-panel-border-dark","rounded-md py-4 px-6 flex flex-row","transition ease-in-out duration-150",void 0===v?"h-32":v];N&&(w=[].concat((0,s.Z)(w),["cursor-pointer","hover:bg-panel-border-light dark:hover:bg-panel-border-dark","hover:border-panel-border-hover-light","dark:hover:border-panel-border-hover-dark hover:border-gray-300"]));var E=function(e){var t=e.children;return(0,a.jsx)("div",{className:"mr-4 flex flex-col",children:t})},k=(0,a.jsxs)("div",{className:w.join(" "),children:[m&&(0,a.jsx)(E,{children:(0,a.jsx)("img",{className:" transition-all group-hover:scale-110 ",src:"".concat(m),alt:"".concat(h),width:"26"})}),f&&(0,a.jsx)(E,{children:f}),(0,a.jsxs)("div",{className:"flex h-full w-full flex-col space-y-2",children:[(0,a.jsx)("h5",{className:"text-scale-1200",children:t}),(c||n)&&(0,a.jsxs)("div",{className:"flex w-full flex-1 flex-col",children:[(0,a.jsx)("p",{className:"text-sm text-scale-1100",children:n}),(0,a.jsx)("div",{className:"w-full",children:c&&c})]}),l&&(0,a.jsx)("div",{className:"w-full",children:l})]}),N&&(0,a.jsx)("div",{className:" absolute right-4 top-4 text-scale-900 transition-all duration-200 group-hover:right-3 group-hover:text-scale-1200 ",children:(0,a.jsx)(i.VG8,{})})]});return p?(0,a.jsx)(g,{children:k}):x?(0,a.jsx)(j,{children:k}):d?(0,a.jsx)(y,{children:k}):(0,a.jsx)(b,{children:k})}},33114:function(e,t,n){var s=n(79894),i=n(27378),r=n(88983),a=n(24246);t.Z=function(e){var t=e.icon,n=e.title,c=e.description,l=e.url,o=e.urlLabel,d=void 0===o?"Read more":o,u=e.defaultVisibility,x=void 0!==u&&u,m=e.hideCollapse,h=void 0!==m&&m,p=e.button,f=e.className,v=void 0===f?"":f,j=e.block,y=void 0!==j&&j,b=(0,i.useState)(x),g=b[0],N=b[1];return(0,a.jsx)("div",{className:"".concat(y?"block w-full":"","\n      block w-full rounded border border-scale-600 bg-scale-100 py-3 dark:border-scale-500 dark:bg-scale-400 ").concat(v),children:(0,a.jsxs)("div",{className:"flex flex-col px-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex w-full space-x-3 lg:items-start",children:[t&&(0,a.jsx)("span",{className:"text-scale-900",children:t}),(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsx)("h5",{className:"text-sm text-scale-1200",children:n})})]}),c&&!h?(0,a.jsx)("div",{className:"cursor-pointer text-scale-900",onClick:function(){return N(!g)},children:g?(0,a.jsx)(r.hJz,{size:14,strokeWidth:1.5}):(0,a.jsx)(r.FgK,{size:14,strokeWidth:1.5})}):null]}),(c||l||p)&&(0,a.jsxs)("div",{className:"flex flex-col space-y-3 overflow-hidden transition-all ".concat(g?"mt-3":""),style:{maxHeight:g?500:0},children:[(0,a.jsx)("div",{className:"text-scale-1100 text-sm",children:c}),l&&(0,a.jsx)(s.default,{href:l,children:(0,a.jsx)("a",{target:"_blank",className:"pt-2",children:(0,a.jsx)(r.zxk,{type:"default",icon:(0,a.jsx)(r.TqL,{}),children:d})})}),p&&(0,a.jsx)("div",{children:p})]})]})})}},27434:function(e,t,n){n.d(t,{Z:function(){return d}});var s=n(44285),i=n(27378),r=n(98784),a=n(88983),c=n(24246),l=function(e){var t=e.name;return(0,c.jsx)("div",{className:["text-typography-body-light dark:text-typography-body-dark","flex cursor-not-allowed items-center space-x-2 rounded bg-gray-600","py-0.5 px-2 text-sm"].join(" "),children:(0,c.jsx)("span",{className:"opacity-50",children:t})})},o=function(e){var t=e.name,n=e.handleRemove;return(0,c.jsxs)("div",{className:["text-typography-body-light dark:text-typography-body-dark","flex items-center space-x-2 rounded bg-gray-500","py-0.5 px-2 text-sm"].join(" "),onClick:function(e){return e.preventDefault()},children:[(0,c.jsx)("span",{children:t}),(0,c.jsx)(a.kLi,{size:12,className:"cursor-pointer opacity-50 transition hover:opacity-100",onClick:function(e){e.preventDefault(),n()}})]})};function d(e){var t=e.options,n=e.value,d=e.label,u=e.error,x=e.descriptionText,m=e.placeholder,h=e.searchPlaceholder,p=void 0===h?"Search for option":h,f=e.emptyMessage,v=e.disabled,j=e.allowDuplicateSelection,y=void 0!==j&&j,b=e.onChange,g=void 0===b?function(){}:b,N=(0,i.useRef)(null),w=(0,i.useState)(n||[]),E=w[0],k=w[1],S=(0,i.useState)(""),T=S[0],C=S[1],L=(0,i.useState)(128),P=L[0],O=L[1],R=n||E;(0,i.useEffect)((function(){O(N.current?N.current.offsetWidth:P)}),[N.current]);var I="".concat(P,"px"),D=(0,r.orderBy)(t,["disabled"],["desc"]),A=T.length>0?(0,r.filter)(D,(function(e){return!e.disabled&&e.name.includes(T)})):(0,r.filter)(D,{disabled:!1}),Z=function(e){var n=R,i=function(e){return void 0!==(R||[]).find((function(t){return t===e.value}))}(e),a=y?(0,s.Z)(n.concat([e.value])):i?(0,s.Z)((0,r.without)(n,e.value)):(0,s.Z)(n.concat([e.value])),c=t.filter((function(e){return e.disabled})).map((function(e){return e.name})),l=y?a.concat(c):(0,s.Z)(new Set(a.concat(c)));k(l),g(l)};return(0,c.jsxs)("div",{className:"form-group ".concat(v?"pointer-events-none opacity-50":""),children:[d&&(0,c.jsx)("label",{className:"!w-full",children:d}),(0,c.jsx)("div",{className:["form-control form-control--multi-select","border border-scale-700 bg-scaleA-200","multi-select relative block w-full w-full space-x-1 overflow-auto rounded","".concat(void 0!==u?"border-red-800 bg-red-100":"")].join(" "),ref:N,children:(0,c.jsx)(a.J2e,{sideOffset:4,side:"bottom",align:"start",style:{width:I},header:(0,c.jsxs)("div",{className:"flex items-center space-x-2 py-1",children:[(0,c.jsx)(a.jVj,{size:14}),(0,c.jsx)("input",{autoFocus:!0,className:"w-72 bg-transparent text-sm placeholder-scale-1000 outline-none",value:T,placeholder:p,onKeyPress:function(e){"Enter"===e.key&&T.length>0&&1===A.length&&Z(A[0])},onChange:function(e){return C(e.currentTarget.value)}})]}),overlay:(0,c.jsx)("div",{className:"max-h-[225px] space-y-1 overflow-y-auto p-1",children:A.length>=1?A.map((function(e){var t=!(y||!R||!R.find((function(t){return t===e.value})));return(0,c.jsxs)("div",{onClick:function(){return Z(e)},className:["text-typography-body-light dark:text-typography-body-dark","group flex cursor-pointer items-center justify-between transition","space-x-1 rounded bg-transparent p-2 px-4 text-sm hover:bg-gray-600","".concat(t?" dark:bg-green-600 dark:bg-opacity-25":"")].join(" "),children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("p",{children:e.name}),void 0!==e.description&&(0,c.jsx)("p",{className:"opacity-50",children:e.description})]}),t&&(0,c.jsx)(a.NOm,{size:16,strokeWidth:3,className:"cursor-pointer transition ".concat(t?" dark:text-green-500":"")}),y&&(0,c.jsxs)("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition space-x-1",children:[(0,c.jsx)(a.SC9,{size:14}),(0,c.jsx)("p",{className:"text-sm",children:"Add value"})]})]},"multiselect-option-".concat(e.id))})):0===t.length?(0,c.jsx)("div",{className:["flex h-full w-full flex-col dark:border-dark","items-center justify-center border border-dashed p-3"].join(" "),children:f||(0,c.jsxs)("div",{className:"flex w-full items-center space-x-2",children:[(0,c.jsx)(a.Ldj,{strokeWidth:1.5,size:18,className:"text-scale-1000"}),(0,c.jsx)("p",{className:"text-sm text-scale-1000",children:"No options available"})]})}):(0,c.jsx)("div",{className:["flex h-full w-full flex-col dark:border-dark","items-center justify-center border border-dashed p-3"].join(" "),children:f||(0,c.jsx)("div",{className:"flex w-full items-center space-x-2",children:(0,c.jsx)("p",{className:"text-sm text-scale-1000",children:"No options found"})})})}),onOpenChange:function(){return C("")},children:(0,c.jsxs)("div",{className:["flex w-full flex-wrap items-start gap-1.5 p-1.5 cursor-default","".concat(0===R.length?"h-9":"")].join(" "),children:[0===R.length&&m&&(0,c.jsx)("div",{className:"px-2 text-sm text-scale-1000 h-full flex items-center",children:m}),R.map((function(e,t){var n,s="".concat(e,"-").concat(t),i=D.find((function(t){return t.value===e})),r=null!==(n=null===i||void 0===i?void 0:i.disabled)&&void 0!==n&&n;return i?r?(0,c.jsx)(l,{name:e},s):(0,c.jsx)(o,{name:e,handleRemove:function(){return y?function(e){var t=E.filter((function(t,n){return n!==e}));k(t),g(t)}(t):Z(i)}},s):(0,c.jsx)(c.Fragment,{})})),(0,c.jsx)("div",{className:"absolute inset-y-0 right-0 pl-3 pr-2 flex space-x-1 items-center cursor-pointer ",children:(0,c.jsx)(a.C26,{size:16,strokeWidth:2,className:"text-scale-900"})})]})})}),x&&(0,c.jsx)("span",{className:"form-text text-muted mt-2 text-sm",children:x}),u&&(0,c.jsx)("span",{className:"text-red-900 text-sm mt-2",children:u})]})}},78906:function(e,t,n){var s=n(55732),i=n(34707),r=n.n(i),a=n(90085),c=n(27378),l=n(42791),o=n(24246);t.Z=function(e){var t=e.queryId,n=e.language,i=void 0===n?"pgsql":n,d=e.defaultValue,u=void 0===d?"":d,x=e.readOnly,m=void 0!==x&&x,h=e.contextmenu,p=void 0===h||h,f=e.onInputChange,v=void 0===f?function(){}:f,j=(0,a.Ik)(),y=(0,l.oR)().meta,b=(0,c.useRef)();function g(e){return N.apply(this,arguments)}function N(){return(N=(0,s.Z)(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.formatQuery(t);case 3:if(!(n=e.sent).error){e.next=6;break}throw n.error;case 6:return e.abrupt("return",n);case 9:return e.prev=9,e.t0=e.catch(0),console.error("formatPgsql error:",e.t0),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}(0,c.useEffect)((function(){if(j){j.editor.defineTheme("supabase",{base:"vs-dark",inherit:!0,colors:{},rules:[{token:"",background:"4a5568"},{token:"string.sql",foreground:"24b47e"},{token:"comment",foreground:"666666"},{token:"predefined.sql",foreground:"D4D4D4"}]});var e=j.languages.registerDocumentFormattingEditProvider("pgsql",{provideDocumentFormattingEdits:function(e){return(0,s.Z)(r().mark((function t(){var n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getValue(),t.next=3,g(n);case 3:return s=t.sent,t.abrupt("return",[{range:e.getFullModelRange(),text:s}]);case 5:case"end":return t.stop()}}),t)})))()}});return function(){e.dispose()}}}),[j]),(0,c.useEffect)((function(){var e;b.current&&(null===(e=b.current)||void 0===e||e.changeViewZones((function(e){e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})))}),[t]);var w=function(){return(0,o.jsx)("h4",{className:"text-lg",children:"Loading"})};return(0,o.jsx)(a.ZP,{className:"monaco-editor",theme:"vs-dark",defaultLanguage:i,defaultValue:u,path:t,loading:(0,o.jsx)(w,{}),options:{readOnly:m,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,contextmenu:p},onMount:function(e,t){b.current=e,e.changeViewZones((function(e){e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}))},onChange:v})}}}]);
//# sourceMappingURL=1016-bc6468172d7d6bf9.js.map