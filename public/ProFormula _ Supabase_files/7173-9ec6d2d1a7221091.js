"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7173],{7173:function(e,n,t){t.d(n,{ub:function(){return sn},l5:function(){return tn},ZP:function(){return ln}});var a=t(55732),r=t(34707),s=t.n(r),i=t(27378),l=t(25229),o=t(86677),c=t(98784),d=t(68043),u=t(42791),m=t(79894),f=t(24532),h=t(88983),p=t(24246),x=function(e){var n,t=e.table,a=(0,u.oR)(),r=a.ui,s=a.meta,i=null===(n=r.selectedProject)||void 0===n?void 0:n.ref,l=s.policies.list((function(e){return e.table_id===t.id})),o=!(0,u.FH)(d.KA.TENANT_SQL_ADMIN_WRITE,"tables")&&!(0,u.FH)(d.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,p.jsxs)("div",{className:"flex items-center space-x-3",children:[o&&(0,p.jsxs)(f.fC,{delayDuration:0,children:[(0,p.jsx)(f.xz,{className:"w-full",children:(0,p.jsx)("div",{className:"border border-scale-700 rounded bg-scale-500 px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,p.jsxs)(f.VY,{side:"bottom",children:[(0,p.jsx)(f.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to manage your project's data"})})]})]}),(0,p.jsx)(m.default,{href:"/project/".concat(i,"/auth/policies#").concat(t.id),children:(0,p.jsx)("a",{children:(0,p.jsx)(h.zxk,{type:t.rls_enabled?"link":"warning",icon:t.rls_enabled?(0,p.jsx)(h._V1,{strokeWidth:2,size:14}):(0,p.jsx)(h.Ldj,{strokeWidth:2,size:14}),children:t.rls_enabled?"".concat(0==l.length?"No":l.length," active RLS polic").concat(l.length>1||0==l.length?"ies":"y"):"RLS is not enabled"})})})]})},v=t(33114),b=function(e){var n=e.id;return(0,p.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,p.jsx)("div",{className:"w-[400px]",children:(0,p.jsx)(v.Z,{icon:(0,p.jsx)(h.Ldj,{strokeWidth:2}),title:"Unable to find your table with ID ".concat(n)})})})},y=t(90089),j=t(90849),g=t(75044),N=t(63840),w=t(90085),k=function(e){var n=e.queryId,t=void 0===n?"":n,a=e.defaultValue,r=void 0===a?"":a,s=e.readOnly,l=void 0!==s&&s,o=e.onInputChange,c=void 0===o?function(){}:o,d=(0,w.Ik)(),u=(0,i.useRef)(),m=(0,i.useState)(localStorage.getItem("theme")),f=m[0];m[1];(0,i.useEffect)((function(){if(d){var e=!f||"dark"===f;d.editor.defineTheme("supabase",{base:"vs-dark",inherit:!0,rules:[{background:e?"1f1f1f":"30313f"},{token:"string.sql",foreground:"24b47e"},{token:"comment",foreground:"666666"},{token:"predefined.sql",foreground:"D4D4D4"}],colors:{"editor.background":e?"#1f1f1f":"#30313f"}})}}),[f,d]);var h=function(){return(0,p.jsx)("h4",{children:"Loading"})};return(0,p.jsx)(w.ZP,{className:"monaco-editor",theme:"vs-dark",defaultLanguage:"json",defaultValue:r,path:t,loading:(0,p.jsx)(h,{}),options:{readOnly:l,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0},onMount:function(e,n){u.current=e,e.changeViewZones((function(e){e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}))},onChange:c})},O=function(e){var n=e.options,t=e.activeOption,a=e.onClickOption,r=e.borderOverride,s=void 0===r?"border-gray-600 dark:border-gray-800":r;return(0,p.jsxs)("div",{className:"relative border ".concat(s," rounded-md h-8"),style:{padding:1,width:102},children:[(0,p.jsx)("span",{style:{width:50},"aria-hidden":"true",className:"".concat(t===n[1]?"translate-x-0":"translate-x-12"," z-0 inline-block rounded h-full bg-gray-600 dark:bg-gray-800 shadow transform transition ease-in-out duration-200 border border-gray-600 dark:border-gray-800")}),n.map((function(e,n){return(0,p.jsx)("span",{style:{width:51},className:"\n              ".concat(t===e?"text-scale-1200":"text-scale-1000"," \n              ").concat(0===n?"right-0":"left-0"," \n              ").concat((r=t===e,"absolute top-0 z-1 text-xs inline-flex h-full items-center justify-center font-medium\n    ".concat(r?"hover:text-white":"hover:text-gray-600"," dark:hover:text-white focus:z-10 focus:outline-none focus:border-blue-300 focus:ring-blue active:bg-gray-100\n    transition ease-in-out duration-150")),"\n              cursor-pointer\n            "),onClick:function(){return a(e)},children:(0,p.jsx)("span",{className:"text-color-inherit capitalize",children:e})},"toggle_".concat(n));var r}))]})},S=function(e){var n=e.pane,t=e.jsonData,a=e.activeKey,r=e.onSelectKey,s=void 0===r?function(){}:r;if(!t)return(0,p.jsx)("div",{className:"flex-1 ".concat(2===n?"border-l border-gray-500":""),children:(0,p.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,p.jsx)("p",{className:"text-sm",children:"Invalid JSON"})})});if(0===Object.keys(t).length)return(0,p.jsx)("div",{className:"max-w-[50%] flex-1 ".concat(2===n?"border-l border-gray-500":""),children:(0,p.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,p.jsx)("p",{className:"text-sm opacity-50",children:"No data available"})})});var i=Object.keys(t).filter((function(e){return"object"===typeof t[e]&&!(0,c.isNull)(t[e])})),l=Object.keys(t).filter((function(e){return(0,c.isNull)(t[e])||"object"!==typeof t[e]}));return(0,p.jsxs)("div",{className:"max-w-[50%] flex-1 ".concat(2===n?"border-l border-gray-500":""),children:[i.map((function(e){return(0,p.jsxs)("div",{className:"\n              ".concat(e===a?"bg-gray-100 dark:bg-gray-400":"","\n              group flex cursor-pointer items-center\n              justify-between py-2 px-5 hover:bg-gray-100 dark:hover:bg-gray-500\n            "),onClick:function(){return s(e,n)},children:[(0,p.jsx)("p",{className:"font-mono text-xs !text-blue-700 dark:!text-blue-1100",children:e}),(0,p.jsx)("div",{className:"".concat(e===a?"block":"hidden"," group-hover:block"),children:(0,p.jsx)(h.VG8,{strokeWidth:2,size:16})})]},e)})),l.map((function(e){return(0,p.jsxs)("div",{className:"flex space-x-2 py-2 px-5",children:[(0,p.jsxs)("p",{className:"font-mono text-xs !text-blue-700 dark:!text-blue-1100",children:[e,":"]}),(0,p.jsx)("p",{className:"break-all font-mono text-xs ".concat("string"!==typeof t[e]?"!text-green-700 dark:!text-green-1000":"!text-yellow-700 dark:!text-yellow-900"),children:(0,c.isNull)(t[e])?"null":"string"===typeof t[e]?'"'.concat(t[e],'"'):t[e].toString()})]},e)}))]})},C=function(e){var n=e.breadcrumbs,t=void 0===n?[]:n,a=e.onSelectBreadcrumb,r=void 0===a?function(){}:a;return(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(h.A2c,{size:16,strokeWidth:2}),t.length>0&&t.map((function(e){return(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(h.VG8,{size:16,strokeWidth:2}),e===(0,c.last)(t)?(0,p.jsx)("p",{className:"font-mono text-xs",children:e}):(0,p.jsx)("p",{className:"font-mono text-xs",children:(0,p.jsx)("div",{className:"cursor-pointer",onClick:function(){return r(t.slice(0,t.indexOf(e)+1))},children:e})})]},e)}))]})};function E(e,n){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(!e)return;if("string"===typeof e)return _(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _(e,n)}(e))||n&&e&&"number"===typeof e.length){t&&(e=t);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){l=!0,s=e},f:function(){try{i||null==t.return||t.return()}finally{if(l)throw s}}}}function _(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}function P(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}var T=function(e){var n=e.jsonData,t=void 0===n?{}:n,a=(0,i.useState)(),r=a[0],s=a[1],l=(0,i.useState)([]),o=l[0],d=l[1],u=(0,i.useState)(t),m=u[0],f=u[1],h=(0,i.useState)({}),x=h[0],v=h[1],b=function(e,n){s(e);var t=o.slice();1===n&&(v(m[e]),(0,c.isEmpty)(x)?(t.push(e),d(t)):(t.pop(),t.push(e),d(t))),2===n&&(f(x),v(x[e]),t.push(e),d(t))};return(0,p.jsxs)("div",{className:"border border-gray-500 rounded",children:[(0,p.jsx)("div",{className:"h-10 px-3 flex-initial flex items-center justify-between",children:(0,p.jsx)(C,{breadcrumbs:o,onSelectBreadcrumb:function(e){var n=(0,c.last)(e)||"";s(n);var a=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?P(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},t),r=o.slice(0,o.indexOf(n)+1);if(d(r),null===e)f(a),v({});else if(1===e.length)f(a),v(t[o[0]]);else{var i,l=E(e);try{for(l.s();!(i=l.n()).done;){var u=i.value;a=a[u],e.indexOf(u)===e.length-2&&f(a)}}catch(m){l.e(m)}finally{l.f()}v(a)}}})}),(0,p.jsxs)("div",{className:"flex items-stretch flex-auto justify-between border-t border-gray-500",children:[(0,p.jsx)(S,{pane:1,jsonData:m,onSelectKey:b,activeKey:r}),(0,p.jsx)(S,{pane:2,jsonData:x,onSelectKey:b})]})]})},R=T,D=t(3305),I=t(98574),z=function(e){var n=e.column,t=e.jsonString,r=e.visible,l=e.backButtonLabel,o=e.applyButtonLabel,c=e.closePanel,d=e.onSaveJSON,m=(0,u.oR)().ui,f=(0,i.useState)("edit"),x=f[0],v=f[1],b=(0,i.useState)(""),y=b[0],j=b[1];(0,i.useEffect)((function(){if(r){var e=(0,I.ZO)(t);j(e)}}),[r]);var g=function(){var e=(0,a.Z)(s().mark((function e(n){var t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=(0,I.jn)(y),d&&d(t)}catch(r){a=r.message?"Error: ".concat(r.message):"JSON seems to have an invalid structure.",m.setNotification({category:"error",message:a,duration:4e3})}finally{n()}case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,p.jsx)(h.hsB,{size:"large",header:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:["edit"===x?(0,p.jsxs)("p",{children:["Editing JSON Field: ",(0,p.jsx)("code",{children:n})]}):(0,p.jsxs)("p",{children:["Viewing JSON Field: ",(0,p.jsx)("code",{children:n})]}),(0,p.jsx)(O,{options:["view","edit"],activeOption:x,borderOverride:"border-gray-500",onClickOption:function(e){v(e)}})]}),visible:r,onCancel:c,customFooter:(0,p.jsx)(D.Z,{closePanel:c,backButtonLabel:l,applyButtonLabel:o,applyFunction:g}),children:(0,p.jsx)("div",{className:"py-4",children:(0,p.jsx)(h.hsB.Content,{children:(0,p.jsx)("div",{className:"mt-4 flex flex-auto flex-col space-y-4",children:"edit"===x?(0,p.jsx)("div",{className:"h-[500px] w-full flex-grow border dark:border-dark",children:(0,p.jsx)(k,{onInputChange:function(e){j(null!==e&&void 0!==e?e:"")},defaultValue:y.toString()})}):(0,p.jsx)(R,{jsonData:(0,I.dW)(y)})})})})})},L=["columnId"],Z=function(e){var n,t,r=e.selectedSchema,l=e.selectedTable,o=e.selectedRowToEdit,d=e.selectedColumnToEdit,m=e.selectedTableToEdit,f=e.selectedValueForJsonEdit,x=e.sidePanelKey,v=e.isDuplicating,b=void 0!==v&&v,w=e.closePanel,k=e.onRowCreated,O=void 0===k?function(){}:k,S=e.onRowUpdated,C=void 0===S?function(){}:S,E=e.onTableCreated,_=void 0===E?function(){}:E,P=e.onColumnSaved,T=void 0===P?function(){}:P,R=(0,u.oR)(),D=R.meta,I=R.ui,Z=(0,i.useState)(!1),K=Z[0],F=Z[1],B=(0,i.useState)(!1),U=B[0],A=B[1],V=D.tables.list(),W=function(){var e=(0,a.Z)(s().mark((function e(n,t,a,r){var i,o,d,u,m,f,h,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==l){e.next=2;break}return e.abrupt("return");case 2:if(i=!1,o=l.columns.filter((function(e){var n;return(null!==(n=null===e||void 0===e?void 0:e.enums)&&void 0!==n?n:[]).length>0&&"array"===e.data_type.toLowerCase()})).map((function(e){return e.name})),!t){e.next=12;break}return d=(new g.Query).from(l.name,l.schema).insert([n],{returning:!0,enumArrayColumns:o}).toSql(),e.next=8,D.query(d);case 8:(u=e.sent).error?(i=!0,I.setNotification({category:"error",message:null===(m=u.error)||void 0===m?void 0:m.message})):O(u[0]),e.next=24;break;case 12:if(!!(0,c.isEmpty)(n)){e.next=24;break}if(!(l.primary_keys.length>0)){e.next=22;break}return f=(new g.Query).from(l.name,l.schema).update(n,{returning:!0,enumArrayColumns:o}).match(a.identifiers).toSql(),e.next=18,D.query(f);case 18:(h=e.sent).error?(i=!0,I.setNotification({category:"error",message:null===(p=h.error)||void 0===p?void 0:p.message})):C(h[0],a.rowIdx),e.next=24;break;case 22:i=!0,I.setNotification({category:"error",message:"We can't make changes to this table because there is no primary key. Please create a primary key and try again."});case 24:r(),i||(F(!1),w());case 26:case"end":return e.stop()}}),e)})));return function(n,t,a,r){return e.apply(this,arguments)}}(),H=function(){var e=(0,a.Z)(s().mark((function e(n){var t,a,r,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==l&&void 0!==f){e.next=2;break}return e.abrupt("return");case 2:try{t=f.row,a=f.column,r=(0,j.Z)({},a,JSON.parse(n)),i={},l.primary_keys.forEach((function(e){return i[e.name]=t[e.name]})),!1,o={identifiers:i,rowIdx:t.idx},W(r,false,o,(function(){}))}catch(s){}case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Y=function(){var e=(0,a.Z)(s().mark((function e(n,t,a,r,i){var o,c,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.columnId,c=(0,y.Z)(r,L),!a){e.next=7;break}return e.next=4,D.createColumn(n,l,t,c);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,D.updateColumn(o,n,l,t);case 9:e.t0=e.sent;case 10:if(null===(d=e.t0)||void 0===d||!d.error){e.next=15;break}I.setNotification({category:"error",message:d.error.message}),e.next=20;break;case 15:return e.next=17,D.tables.loadById(l.id);case 17:T(r.isEncrypted),F(!1),w();case 20:if(!r.isEncrypted||null===l||void 0===l||!l.schema){e.next=23;break}return e.next=23,D.views.loadBySchema(l.schema);case 23:i();case 24:case"end":return e.stop()}}),e)})));return function(n,t,a,r,s){return e.apply(this,arguments)}}(),q=function(){var e=(0,a.Z)(s().mark((function e(n,t,a,r,i){var l,o,d,u,f,h,p,x,v,y,j,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!1,d=r.tableId,u=r.importContent,f=r.isRLSEnabled,h=r.isRealtimeEnabled,p=r.isDuplicateRows,e.prev=2,!b){e.next=13;break}return x=(0,c.find)(V,{id:d}),l=I.setNotification({category:"loading",message:"Duplicating table: ".concat(x.name,"...")}),e.next=8,D.duplicateTable(n,{isRLSEnabled:f,isRealtimeEnabled:h,isDuplicateRows:p,duplicateTable:x});case 8:v=e.sent,I.setNotification({id:l,category:"success",message:"Table ".concat(x.name," has been successfully duplicated into ").concat(v.name,"!")}),_(v),e.next=30;break;case 13:if(!a){e.next=22;break}return l=I.setNotification({category:"loading",message:"Creating new table: ".concat(n.name,"...")}),e.next=17,D.createTable(l,n,t,f,h,u);case 17:y=e.sent,I.setNotification({id:l,category:"success",message:"Table ".concat(y.name," is good to go!")}),_(y),e.next=30;break;case 22:if(!m){e.next=30;break}return l=I.setNotification({category:"loading",message:"Updating table: ".concat(null===m||void 0===m?void 0:m.name,"...")}),e.next=26,D.updateTable(l,m,n,t,h);case 26:j=e.sent,g=j.table,j.hasError?I.setNotification({id:l,category:"info",message:"Table ".concat(g.name," has been updated, but there were some errors")}):I.setNotification({id:l,category:"success",message:"Successfully updated ".concat(g.name,"!")});case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(2),o=!0,I.setNotification({id:l,category:"error",message:e.t0.message});case 36:o||(F(!1),w()),i();case 38:case"end":return e.stop()}}),e,null,[[2,32]])})));return function(n,t,a,r,s){return e.apply(this,arguments)}}(),J=function(){K?A(!0):w()};return(0,p.jsxs)(p.Fragment,{children:[!(0,c.isUndefined)(l)&&(0,p.jsx)(te,{row:o,selectedTable:l,visible:"row"===x,closePanel:J,saveChanges:W,updateEditorDirty:function(){return F(!0)}}),!(0,c.isUndefined)(l)&&(0,p.jsx)(je,{tables:V,column:d,selectedTable:l,visible:"column"===x,closePanel:J,saveChanges:Y,updateEditorDirty:function(){return F(!0)}}),(0,p.jsx)(nn,{table:m,selectedSchema:r,isDuplicating:b,visible:"table"===x,closePanel:J,saveChanges:q,updateEditorDirty:function(){return F(!0)}}),(0,p.jsx)(z,{visible:"json"===x,column:null!==(n=null===f||void 0===f?void 0:f.column)&&void 0!==n?n:"",jsonString:null!==(t=null===f||void 0===f?void 0:f.jsonString)&&void 0!==t?t:"",backButtonLabel:"Cancel",applyButtonLabel:"Save changes",closePanel:J,onSaveJSON:H}),(0,p.jsx)(N.Z,{visible:U,header:"Confirm to close",buttonLabel:"Confirm",onSelectCancel:function(){return A(!1)},onSelectConfirm:function(){A(!1),F(!1),w()},children:(0,p.jsx)(h.u_l.Content,{children:(0,p.jsx)("p",{className:"py-4 text-sm text-scale-1100",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]})},K=t(11246),F=t(60729),B=function(e){var n=e.isNewRecord,t=e.tableName,a="".concat(n?"Add new":"Update"," row ").concat(n?"to":"from"," ");return(0,p.jsxs)(p.Fragment,{children:[a,t&&(0,p.jsx)("span",{className:"text-code",children:t})]})},U=t(53797);function A(e){return n=e,U.lb.indexOf(n.toLowerCase())>-1?"date":function(e){return U.XO.indexOf(e.toLowerCase())>-1}(e)?"time":function(e){return U.Ks.indexOf(e.toLowerCase())>-1}(e)?"datetime-local":"text";var n}var V=t(27693),W=t.n(V),H=function(e){var n=e.value,t=e.onChange,a=e.name,r=e.format,s=e.description,i=A(r);return(0,p.jsx)(h.IIB,{layout:"horizontal",className:"w-full",label:a,descriptionText:(0,p.jsxs)("div",{className:"space-y-1",children:[s,r.includes("tz")&&(0,p.jsxs)("p",{children:["Your local timezone will be automatically applied (",W()().format("ZZ"),")"]})]}),labelOptional:r,size:"small",value:n,type:i,onChange:function(e){var n=e.target.value;0===n.length&&""!==n||t(n)},step:"datetime-local"==i||"time"==i?"1":void 0})},Y=function(e){var n,t,a,r,s,i,l,o,d,u=e.field,m=e.errors,f=e.isEditable,x=void 0===f||f,v=e.onUpdateField,b=void 0===v?function(){}:v,y=e.onEditJson,g=void 0===y?function(){}:y,N=e.onViewForeignKey,w=void 0===N?function(){}:N;return u.enums.length>0?"_"===u.format[0]?(0,p.jsx)("div",{className:"text-area-text-sm",children:(0,p.jsx)(h.IIB.TextArea,{layout:"horizontal",label:u.name,className:"text-sm",descriptionText:u.comment,labelOptional:u.format,disabled:!x,error:m[u.name],rows:5,value:null!==(t=u.value)&&void 0!==t?t:"",placeholder:null===u.defaultValue?"":"string"===typeof u.defaultValue&&0===u.defaultValue.length?"Default: Empty string":"Default: ".concat(u.defaultValue),onChange:function(e){return b((0,j.Z)({},u.name,e.target.value))}})}):(0,p.jsxs)(h.PhF,{size:"medium",layout:"horizontal",value:null!==(a=u.value)&&void 0!==a?a:"",label:u.name,labelOptional:u.format,descriptionText:u.comment,disabled:!x,error:m[u.name],onChange:function(e){return b((0,j.Z)({},u.name,e.target.value))},children:[(0,p.jsx)(h.PhF.Option,{value:"",children:"---"}),u.enums.map((function(e){return(0,p.jsx)(h.PhF.Option,{value:e,children:e},e)}))]}):(0,c.isUndefined)(u.foreignKey)?(0,c.includes)(U.BB,u.format)?(0,p.jsx)("div",{className:"text-area-text-sm",children:(0,p.jsx)(h.IIB.TextArea,{layout:"horizontal",label:u.name,className:"text-sm",descriptionText:u.comment,labelOptional:u.format,disabled:!x,error:m[u.name],rows:5,value:null!==(i=u.value)&&void 0!==i?i:"",placeholder:null===u.defaultValue?"":"string"===typeof u.defaultValue&&0===u.defaultValue.length?"Default: Empty string":"Default: ".concat(u.defaultValue),onChange:function(e){return b((0,j.Z)({},u.name,e.target.value))}})}):(0,c.includes)(U.YF,u.format)?(0,p.jsx)(h.IIB,{layout:"horizontal",value:null!==(l=u.value)&&void 0!==l?l:"",label:u.name,descriptionText:u.comment,labelOptional:u.format,disabled:!x,placeholder:null!==(o=null===u||void 0===u?void 0:u.defaultValue)&&void 0!==o?o:"",error:m[u.name],onChange:function(e){return b((0,j.Z)({},u.name,e.target.value))},actions:(0,p.jsx)(h.zxk,{type:"default",htmlType:"button",onClick:function(){return g({column:u.name,jsonString:u.value})},icon:(0,p.jsx)(h.xUH,{}),children:"Edit JSON"})}):(0,c.includes)(U.nA,u.format)?(0,p.jsx)(H,{name:u.name,format:u.format,value:null!==(d=u.value)&&void 0!==d?d:"",description:(0,p.jsxs)(p.Fragment,{children:[u.defaultValue&&(0,p.jsxs)("p",{children:["Default: ",u.defaultValue]}),u.comment&&(0,p.jsx)("p",{children:u.comment})]}),onChange:function(e){return b((0,j.Z)({},u.name,e))}}):(0,p.jsx)(h.IIB,{layout:"horizontal",label:u.name,descriptionText:u.comment,labelOptional:u.format,error:m[u.name],value:null!==(n=u.value)&&void 0!==n?n:"",placeholder:u.isIdentity?"Automatically generated as identity":null!==u.defaultValue?"Default: ".concat(u.defaultValue):"",disabled:!x,onChange:function(e){return b((0,j.Z)({},u.name,e.target.value))}}):(0,p.jsx)(h.IIB,{layout:"horizontal",label:u.name,value:null!==(r=u.value)&&void 0!==r?r:"",descriptionText:(0,p.jsxs)("div",{className:"flex items-center space-x-1 opacity-50",children:[u.comment&&(0,p.jsx)("p",{className:"text-sm",children:u.comment}),(0,p.jsxs)("p",{className:"text-sm",children:["(",u.name]}),(0,p.jsx)("p",{className:"text-sm",children:(0,p.jsx)(h.Ec8,{size:14,strokeWidth:2})}),(0,p.jsxs)("p",{className:"text-sm",children:[u.foreignKey.target_table_schema,".",u.foreignKey.target_table_name,".",u.foreignKey.target_column_name,")"]})]}),labelOptional:u.format,disabled:!x,error:m[u.name],onChange:function(e){return b((0,j.Z)({},u.name,e.target.value))},actions:(0,p.jsx)(h.zxk,{disabled:null===u.value||0===(null===(s=u.value)||void 0===s?void 0:s.length),type:"default",htmlType:"button",onClick:w,icon:(0,p.jsx)(h.JHz,{}),children:"View data"})})},q=z,J=function(e,n){try{return null===e||0===e.length?e:"number"!==typeof e&&n?"object"===typeof e?JSON.stringify(e):"boolean"===typeof e?e.toString():e:e}catch(t){return e}},M=function(e){if(!e)return"";var n,t,a=(0,c.compact)(e.split("\n"));return 1==a.length?e:2==a.length?"".concat(a[0]," ").concat(null===(n=a[1])||void 0===n?void 0:n.split(".<")[0]):a.length>2?"".concat(a[0]," (").concat(a[1]," ").concat(null===(t=a[2])||void 0===t?void 0:t.split(".<")[0],")"):""},Q=function(e,n){if(!n||0==n.length)return"";if(U.Ks.includes(e))return W()(n).format("YYYY-MM-DDTHH:mm:ss");if(U.XO.includes(e)){var t=n&&n.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return W()(n,t).format("HH:mm:ss")}return n},X=function(e,n){if(!n||0==n.length)return null;switch(e){case"timestamptz":return W()(n,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return W()(n,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return W()(n,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return W()(n,"HH:mm:ss").format("HH:mm:ss");default:return n}},G=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t={};return e.forEach((function(e){var n,a=e.format.startsWith("_"),r=0===(null!==(n=null===e||void 0===e?void 0:e.value)&&void 0!==n?n:"").length?null:e.value;if(a&&null!==r)t[e.name]=(0,I.dW)(r);else if(e.format.includes("json"))"object"===typeof e.value?t[e.name]=r:(0,c.isString)(r)&&(t[e.name]=(0,I.dW)(r));else if("bool"===e.format&&r)t[e.name]="true"===r;else if(U.nA.includes(e.format)){var s=2===(r||"").split(":").length?"".concat(r,":00"):r;t[e.name]=X(e.format,s)}else t[e.name]=r})),n?t:(0,c.omitBy)(t,c.isNull)},$=function(e){var n,t,a,r,s,l=e.visible,o=e.referenceRow,c=e.closePanel,d=null===(n=null===o||void 0===o?void 0:o.loading)||void 0===n||n,u=null!==(t=null===o||void 0===o?void 0:o.foreignKey)&&void 0!==t?t:void 0,m=null!==(a=null===o||void 0===o?void 0:o.row)&&void 0!==a?a:void 0,f=(0,i.useState)([]),x=f[0],v=f[1];return(0,i.useEffect)((function(){if(l)if(u){if(m){var e=function(e){return Object.keys(e).map((function(n){return{id:(0,I.k$)(),value:e[n]||"",name:n,comment:"",format:"",enums:[],defaultValue:"",foreignKey:void 0,isNullable:!1,isIdentity:!1,isPrimaryKey:!1}}))}(m);v(e)}}else v([])}),[l,o]),(0,p.jsx)(h.hsB,{visible:l,size:"large",header:(0,p.jsxs)("div",{children:["Viewing reference row from"," ",(0,p.jsxs)("code",{className:"text-sm",children:[null!==(r=null===u||void 0===u?void 0:u.target_table_schema)&&void 0!==r?r:"",".",null!==(s=null===u||void 0===u?void 0:u.target_table_name)&&void 0!==s?s:""]})]}),hideFooter:!1,onCancel:c,customFooter:(0,p.jsx)(D.Z,{hideApply:!0,backButtonLabel:"Close",closePanel:c}),children:(0,p.jsx)(h.hsB.Content,{children:(0,p.jsx)("div",{className:"py-6",children:d?(0,p.jsxs)("div",{className:"flex h-full flex-col items-center justify-center space-y-2",children:[(0,p.jsx)(h.pAw,{className:"animate-spin"}),(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"Loading reference row"})]}):m?(0,p.jsx)("div",{className:"space-y-6",children:x.map((function(e){return(0,p.jsx)(Y,{field:e,isEditable:!1,errors:{}},e.id)}))}):(0,p.jsxs)("div",{className:"flex h-full flex-col items-center justify-center space-y-2",children:[(0,p.jsx)(h.IF3,{}),(0,p.jsxs)("p",{className:"text-sm text-scale-1100",children:["Unable to find the corresponding row in ",null===u||void 0===u?void 0:u.target_table_schema,".",null===u||void 0===u?void 0:u.target_table_name]})]})})})})};function ee(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function ne(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ee(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ee(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var te=function(e){var n,t,r=e.row,l=e.selectedTable,o=e.visible,d=void 0!==o&&o,m=e.closePanel,f=void 0===m?function(){}:m,x=e.saveChanges,v=void 0===x?function(){}:x,b=e.updateEditorDirty,y=void 0===b?function(){}:b,g=(0,u.oR)(),N=g.meta,w=g.ui,k=(0,i.useState)({}),O=k[0],S=k[1],C=(0,i.useState)([]),E=C[0],_=C[1],P=(0,i.useState)(),T=P[0],R=P[1],z=(0,i.useState)(!1),L=z[0],Z=z[1],A=(0,i.useState)(),V=A[0],W=A[1],H=(0,c.isUndefined)(r),X=!(0,c.isUndefined)(T),ee=(0,i.useState)(!1),te=ee[0],ae=ee[1],re=(0,c.partition)(E,(function(e){return!e.isNullable})),se=(0,K.Z)(re,2),ie=se[0],le=se[1];(0,i.useEffect)((function(){if(d){S({});var e=function(e,n){var t=n.relationships,a=n.primary_keys.map((function(e){return e.name}));return n.columns.map((function(n){return{value:(0,c.isUndefined)(e)?"":U.nA.includes(n.format)?Q(n.format,e[n.name]):J(e[n.name],n.format),foreignKey:(0,c.find)(t,(function(e){return e.source_schema===n.schema&&e.source_table_name===n.table&&e.source_column_name===n.name})),id:n.id,name:n.name,comment:M(n.comment),format:n.format,enums:n.enums,defaultValue:null===n||void 0===n?void 0:n.default_value,isNullable:n.is_nullable,isIdentity:n.is_identity,isPrimaryKey:a.includes(n.name)}}))}(r,l);_(e)}}),[d]);var oe=function(e){var n=Object.keys(e),t=(0,K.Z)(n,1)[0],a=E.map((function(n){return n.name===t?ne(ne({},n),{},{value:e[t]}):n}));_(a),y()},ce=function(){var e=(0,a.Z)(s().mark((function e(n){var t,a,r,i,l,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.value||w.setNotification({category:"error",message:"Please enter a value in the ".concat(n.name," field first"),duration:4e3}),t=n.foreignKey,W({loading:!0,foreignKey:t,row:void 0}),Z(!0),!t){e.next=19;break}return a=t.target_table_schema,r=t.target_table_name,i=t.target_column_name,l=(new F.A).from(r,a).select().match((0,j.Z)({},i,n.value)).toSql(),e.next=11,N.query(l);case 11:if(!(o=e.sent).error){e.next=15;break}return W({loading:!1,foreignKey:t,row:void 0}),e.abrupt("return",w.setNotification({category:"error",message:o.error.message}));case 15:if(0!==o.length){e.next=18;break}return W({loading:!1,foreignKey:t,row:void 0}),e.abrupt("return",w.setNotification({category:"error",message:"Unable to find the corresponding row in ".concat(t.target_table_schema,".").concat(t.target_table_name," where ").concat(t.target_column_name," equals ").concat(n.value),duration:4e3}));case 18:W({loading:!1,foreignKey:t,row:o[0]});case 19:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),de=function(e){e.preventDefault();var n=function(e){var n={};return e.forEach((function(e){var t,a;if(e.format.startsWith("_")&&e.value)try{JSON.parse(e.value)}catch(s){n[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(null!==(t=null===(a=e.value)||void 0===a?void 0:a.length)&&void 0!==t?t:0)>0)try{var r;(0,I.jn)(null!==(r=e.value)&&void 0!==r?r:"")}catch(i){n[e.name]="Value is an invalid JSON"}!e.isIdentity&&e.defaultValue})),n}(E);if(S(n),ae(!0),(0,c.isEmpty)(n)){y();var t=H?G(E):function(e,n){var t=G(n,!0),a={};return Object.keys(t).forEach((function(n){(0,c.isEqual)(e[n],t[n])||(a[n]=t[n])})),a}(r,E),a={identifiers:{},rowIdx:-1};if(!H){var s=E.filter((function(e){return e.isPrimaryKey})),i={};s.forEach((function(e){return i[e.name]=r[e.name]})),a.identifiers=i,a.rowIdx=r.idx}v(t,H,a,(function(){return ae(!1)}))}else ae(!1)};return(0,p.jsx)(h.hsB,{hideFooter:!0,size:"large",visible:d,header:(0,p.jsx)(B,{isNewRecord:H,tableName:l.name}),className:"transition-all duration-100 ease-in ".concat(X||L?" mr-32":""),onCancel:f,onInteractOutside:function(e){var n;(null===(n=e.target)||void 0===n?void 0:n.closest("#toast"))&&e.preventDefault()},children:(0,p.jsx)("form",{onSubmit:function(e){return de(e)},className:"h-full",children:(0,p.jsxs)("div",{className:"flex h-full flex-col",children:[(0,p.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,p.jsx)(h.hsB.Content,{children:(0,p.jsx)("div",{className:"space-y-10 py-6",children:ie.map((function(e){return(0,p.jsx)(Y,{field:e,errors:O,onUpdateField:oe,onEditJson:R,onViewForeignKey:function(){return ce(e)}},e.id)}))})}),le.length>0&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.hsB.Separator,{}),(0,p.jsx)(h.hsB.Content,{children:(0,p.jsxs)("div",{className:"space-y-10 py-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"text-base text-scale-1200",children:"Optional Fields"}),(0,p.jsx)("p",{className:"text-sm text-scale-900",children:"These are columns that do not need any value"})]}),le.map((function(e){return(0,p.jsx)(Y,{field:e,errors:O,onUpdateField:oe,onEditJson:R,onViewForeignKey:function(){return ce(e)}},e.id)}))]})})]}),(0,p.jsx)(q,{visible:X,column:null!==(n=null===T||void 0===T?void 0:T.column)&&void 0!==n?n:"",jsonString:null!==(t=null===T||void 0===T?void 0:T.jsonString)&&void 0!==t?t:"",closePanel:function(){return R(void 0)},onSaveJSON:function(e){var n;oe((0,j.Z)({},null!==(n=null===T||void 0===T?void 0:T.column)&&void 0!==n?n:"",e)),R(void 0)}}),(0,p.jsx)($,{visible:L,referenceRow:V,closePanel:function(){Z(!1),W(void 0)}})]}),(0,p.jsx)("div",{className:"flex-shrink",children:(0,p.jsx)(D.Z,{loading:te,backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:f})})]})})},"RowEditor")},ae=function(e){var n=e.table,t=e.column;return t?(0,p.jsxs)(p.Fragment,{children:["Update column ",(0,p.jsx)("code",{children:t.name})," from ",(0,p.jsx)("code",{children:t.table})]}):(0,p.jsxs)(p.Fragment,{children:["Add new column to ",(0,p.jsx)("code",{children:n.name})]})},re=function(e){var n=e.value,t=e.enumTypes,a=void 0===t?[]:t,r=e.className,s=e.size,i=void 0===s?"medium":s,l=e.layout,o=e.error,c=e.disabled,d=void 0!==c&&c,u=e.showLabel,f=void 0===u||u,x=e.description,v=e.showRecommendation,b=void 0!==v&&v,y=e.onOptionSelect,j=void 0===y?function(){}:y,g=U.DL.concat(a.map((function(e){return e.name}))),N=!n||g.includes(n),w=U.VP[n];if(!N)return(0,p.jsx)(h.IIB,{readOnly:!0,disabled:!0,label:f?"Type":"",layout:f?"horizontal":void 0,className:"md:gap-x-0",size:"small",value:n,descriptionText:f?"Custom non-native psql data types cannot currently be changed to a different data type via Supabase Studio":""});return(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(h.RiT,{label:f?"Type":"",layout:l||(f?"horizontal":"vertical"),value:n,size:i,error:o,disabled:d,descriptionText:x,className:"".concat(r," ").concat(d?"column-type-disabled":""," rounded-md"),onChange:function(e){return j(e)},optionsWidth:480,children:[(0,p.jsx)(h.RiT.Option,{value:"",label:"---",children:"---"},"empty"),a.length>0?(0,p.jsx)(h.RiT.Option,{disabled:!0,value:"header-1",label:"header-1",children:"User-defined Enumerated Types"},"header-1"):(0,p.jsx)(p.Fragment,{}),a.length>0?a.map((function(e){return(0,p.jsx)(h.RiT.Option,{value:e.name,label:e.name,addOnBefore:function(){return(0,p.jsx)("div",{className:"mx-1 h-2 w-2 rounded-full bg-scale-1200"})},children:(0,p.jsx)("div",{className:"flex items-center space-x-4",children:(0,p.jsx)("p",{children:e.name})})},e.name)})):(0,p.jsx)(p.Fragment,{}),(0,p.jsx)(h.RiT.Option,{disabled:!0,value:"header-2",label:"header-2",children:"PostgreSQL Data Types"}),U.N0.map((function(e){return(0,p.jsx)(h.RiT.Option,{value:e.name,label:e.name,addOnBefore:function(){return function(e){switch(e){case"number":return(0,p.jsx)(h.Rxg,{size:16,className:"text-scale-1200",strokeWidth:1.5});case"time":return(0,p.jsx)(h.jt6,{size:16,className:"text-scale-1200",strokeWidth:1.5});case"text":return(0,p.jsx)(h.TuN,{size:16,className:"text-scale-1200",strokeWidth:1.5});case"json":return(0,p.jsx)("div",{className:"text-scale-1200",style:{padding:"0px 1px"},children:"{ }"});case"bool":return(0,p.jsx)(h.o_N,{size:16,className:"text-scale-1200",strokeWidth:1.5});default:return(0,p.jsx)("div",{})}}(e.type)},children:(0,p.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,p.jsx)("span",{className:"text-scale-1200",children:e.name}),(0,p.jsx)("span",{className:"text-scale-900",children:e.description})]})},e.name)}))]}),b&&void 0!==w&&(0,p.jsxs)(h.bZj,{withIcon:!0,variant:"warning",title:(0,p.jsxs)(p.Fragment,{children:["It is recommended to use ",(0,p.jsx)("code",{className:"text-xs",children:w.alternative})," ","instead"]}),children:[(0,p.jsxs)("p",{children:["Postgres recommends against using the data type ",(0,p.jsx)("code",{className:"text-xs",children:n})," ","unless you have a very specific use case."]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2 mt-3",children:[(0,p.jsx)(m.default,{href:w.reference,children:(0,p.jsx)("a",{target:"_blank",children:(0,p.jsx)(h.zxk,{type:"default",icon:(0,p.jsx)(h.TqL,{}),children:"Read more"})})}),(0,p.jsxs)(h.zxk,{type:"primary",onClick:function(){return j(w.alternative)},children:["Use ",w.alternative]})]})]})]})},se=t(80178),ie=function(e){var n=e.column,t=e.originalForeignKey,a=e.onSelectEditRelation,r=void 0===a?function(){}:a,s=e.onSelectRemoveRelation,i=void 0===s?function(){}:s;if((0,c.isUndefined)(t)&&(0,c.isUndefined)(null===n||void 0===n?void 0:n.foreignKey))return(0,p.jsx)(h.zxk,{type:"default",onClick:r,children:"Add foreign key relation"});switch((0,se.wO)(t,null===n||void 0===n?void 0:n.foreignKey)){case"Add":return(0,p.jsx)(oe,{columnName:n.name,foreignKey:n.foreignKey,onSelectEditRelation:r,onSelectRemoveRelation:i});case"Remove":return(0,p.jsx)(ce,{columnName:n.name,originalForeignKey:t,onSelectEditRelation:r});case"Update":return(0,p.jsx)(de,{columnName:n.name,originalForeignKey:t,updatedForeignKey:n.foreignKey,onSelectEditRelation:r,onSelectRemoveRelation:i});case"Info":return(0,p.jsx)(le,{columnName:n.name,foreignKey:n.foreignKey,onSelectEditRelation:r,onSelectRemoveRelation:i});default:return(0,p.jsx)("div",{})}},le=function(e){var n=e.columnName,t=e.foreignKey,a=e.onSelectEditRelation,r=e.onSelectRemoveRelation;return(0,p.jsx)(v.Z,{block:!0,title:(0,p.jsxs)("div",{className:"flex flex-col space-y-4 text-scale-900",children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsx)("span",{children:"This column has the following foreign key relation:"}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("span",{className:"text-code",children:n}),(0,p.jsx)(h.Ec8,{size:14,strokeWidth:2}),(0,p.jsxs)("span",{className:"text-code",children:[null===t||void 0===t?void 0:t.target_table_schema,".",null===t||void 0===t?void 0:t.target_table_name,".",null===t||void 0===t?void 0:t.target_column_name]})]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(h.zxk,{type:"outline",onClick:a,children:"Edit relation"}),(0,p.jsx)(h.zxk,{type:"outline",onClick:r,children:"Remove"})]})]})})},oe=function(e){var n=e.columnName,t=e.foreignKey,a=e.onSelectEditRelation,r=e.onSelectRemoveRelation;return(0,p.jsx)(v.Z,{block:!0,title:(0,p.jsxs)("div",{className:"flex flex-col space-y-4 text-scale-1100",children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("span",{children:["The following foreign key relation will be"," ",(0,p.jsx)("span",{className:"text-brand-900",children:"added"}),":"]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2 text-scale-1200",children:[(0,p.jsx)("span",{className:"".concat(n.length>0?"text-code font-mono text-xs":""," max-w-xs truncate"),children:n||"This column"}),(0,p.jsx)(h.Ec8,{size:14,strokeWidth:2}),(0,p.jsxs)("span",{className:"max-w-xs text-xs truncate text-code font-mono",children:[null===t||void 0===t?void 0:t.target_table_schema,".",null===t||void 0===t?void 0:t.target_table_name,".",null===t||void 0===t?void 0:t.target_column_name]})]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(h.zxk,{type:"outline",onClick:a,children:"Edit relation"}),(0,p.jsx)(h.zxk,{type:"outline",onClick:r,children:"Remove"})]})]})})},ce=function(e){var n=e.columnName,t=e.originalForeignKey,a=e.onSelectEditRelation;return(0,p.jsx)(v.Z,{block:!0,title:(0,p.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("p",{children:["The following foreign key relation will be"," ",(0,p.jsx)("span",{className:"text-amber-900",children:"removed"})," from this column:"]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("code",{className:"text-sm",children:n}),(0,p.jsx)(h.Ec8,{size:14,strokeWidth:2}),(0,p.jsxs)("code",{className:"text-sm",children:[null===t||void 0===t?void 0:t.target_table_schema,".",null===t||void 0===t?void 0:t.target_table_name,".",null===t||void 0===t?void 0:t.target_column_name]})]})]}),(0,p.jsx)("div",{className:"flex items-center space-x-2",children:(0,p.jsx)(h.zxk,{type:"outline",onClick:a,children:"Edit relation"})})]})})},de=function(e){var n=e.columnName,t=e.originalForeignKey,a=e.updatedForeignKey,r=e.onSelectEditRelation,s=e.onSelectRemoveRelation;return(0,p.jsx)(v.Z,{block:!0,title:(0,p.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("p",{children:["The foreign key relation will be ",(0,p.jsx)("span",{className:"text-brand-900",children:"updated"})," as such:"]}),(0,p.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,p.jsx)("code",{className:"text-sm",children:n}),(0,p.jsx)(h.Ec8,{className:"mt-1",size:14,strokeWidth:2}),(0,p.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,p.jsx)("p",{className:"line-through",children:(0,p.jsxs)("code",{className:"text-sm",children:[null===t||void 0===t?void 0:t.target_table_schema,".",null===t||void 0===t?void 0:t.target_table_name,".",null===t||void 0===t?void 0:t.target_column_name]})}),(0,p.jsxs)("code",{className:"text-sm",children:[null===a||void 0===a?void 0:a.target_table_schema,".",null===a||void 0===a?void 0:a.target_table_name,".",null===a||void 0===a?void 0:a.target_column_name]})]})]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(h.zxk,{type:"outline",onClick:r,children:"Edit relation"}),(0,p.jsx)(h.zxk,{type:"outline",onClick:s,children:"Remove"})]})]})})},ue=function(e){var n=e.label,t=e.description,a=e.placeholder,r=e.size,s=e.layout,l=e.disabled,o=void 0!==l&&l,c=e.className,d=void 0===c?"":c,u=e.value,m=void 0===u?"":u,x=(e.format,e.suggestions),v=void 0===x?[]:x,b=e.suggestionsTooltip,y=e.suggestionsHeader,j=e.onChange,g=void 0===j?function(){}:j,N=e.onSelectSuggestion,w=void 0===N?function(){}:N,k=(0,i.useRef)(null),O=(0,i.useState)(v),S=O[0],C=O[1],E=S.length>0;(0,i.useEffect)((function(){C(v.slice(0,3))}),[v]);return(0,p.jsx)("div",{ref:k,className:"relative",children:(0,p.jsx)(h.IIB,{label:n,descriptionText:t,placeholder:a,size:r,layout:s,disabled:o,className:d,type:"text",value:m,onChange:function(e){g(e);var n=e.target.value;if(v.length>3){var t=n?v.filter((function(e){return-1!==e.name.indexOf(n)})):v;C(t.slice(0,3))}},actions:E&&(0,p.jsx)(h.Ltx,{size:"medium",align:"end",side:"bottom",overlay:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.Ltx.Label,{children:y||"Suggestions"}),(0,p.jsx)(h.Ltx.Separator,{}),S.map((function(e){return(0,p.jsxs)(h.Ltx.Item,{onClick:function(){return w(e)},children:[(0,p.jsx)("div",{className:"text-sm",children:e.name}),(0,p.jsx)("div",{className:"text-xs text-scale-900",children:e.description})]},e.name)}))]}),children:(0,p.jsxs)(f.fC,{delayDuration:0,children:[(0,p.jsx)(f.xz,{children:(0,p.jsx)(h.zxk,{as:"span",type:"default",className:"!px-1 mr-1",icon:(0,p.jsx)(h.ZdG,{strokeWidth:1.5})})}),(0,p.jsxs)(f.VY,{side:"bottom",children:[(0,p.jsx)(f.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["bg-scale-100 rounded py-1 px-2 leading-none shadow","border-scale-200 border"].join(" "),children:(0,p.jsx)("span",{className:"text-scale-1200 text-xs",children:b||"Suggestions"})})]})]})})})})},me=[{name:"now()",value:"now()",description:"Returns the current date and time"},{name:"(now() at time zone 'utc')",value:"(now() at time zone 'utc')",description:"Returns the current date and time based on the specified timezone"}],fe=[{name:"Set as NULL",value:null,description:"Set the default value as NULL value"},{name:"Set as empty string",value:"",description:"Set the default value as an empty string"}],he={uuid:[{name:"uuid_generate_v4()",value:"uuid_generate_v4()",description:"Generates a version 4 UUID"}],time:[].concat(me),timetz:[].concat(me),timestamp:[].concat(me),timestamptz:[].concat(me),text:[].concat(fe),varchar:[].concat(fe)},pe=function(e){var n,t,a=e.columnFields,r=e.enumTypes,s=void 0===r?[]:r,i=e.onUpdateField,l=void 0===i?function(){}:i,o=null!==(n=null===he||void 0===he?void 0:he[a.format])&&void 0!==n?n:[];if((0,c.isNil)(a.format)&&!U.DL.includes(a.format)){var d,u=(0,se.aN)(a.format,s);return(0,p.jsxs)(h.PhF,{label:"Default Value",layout:"horizontal",value:null!==(d=a.defaultValue)&&void 0!==d?d:"",onChange:function(e){return l({defaultValue:e.target.value})},children:[(0,p.jsx)(h.PhF.Option,{value:"",children:"---"},"empty-enum"),u.map((function(e){return(0,p.jsx)(h.PhF.Option,{value:e,children:e},e)}))]})}return(0,p.jsx)(ue,{label:"Default Value",layout:"vertical",description:"Can either be a literal or an expression (e.g uuid_generate_v4())",placeholder:"string"===typeof a.defaultValue&&0===a.defaultValue.length?"Empty string":"NULL",value:null!==(t=null===a||void 0===a?void 0:a.defaultValue)&&void 0!==t?t:"",format:null===a||void 0===a?void 0:a.format,suggestions:o,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:function(e){return l({defaultValue:e.target.value})},onSelectSuggestion:function(e){return l({defaultValue:e.value})}})},xe=t(33003),ve=t(30113);function be(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function ye(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?be(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):be(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var je=function(e){var n,t,a,r,s=e.column,l=e.selectedTable,o=(e.tables,e.visible),d=void 0!==o&&o,f=e.closePanel,x=void 0===f?function(){}:f,v=e.saveChanges,b=void 0===v?function(){}:v,y=e.updateEditorDirty,j=void 0===y?function(){}:y,g=(0,u.UO)().ref,N=(0,u.oR)(),w=N.meta,k=N.vault,O=(0,u.P5)("transparentColumnEncryption"),S=(0,c.isUndefined)(s),C=s?(0,se.S)(s,l):void 0,E=k.listKeys(),_=w.types.list((function(e){return!w.excludedSchemas.includes(e.schema)})),P=(0,i.useState)({}),T=P[0],R=P[1],I=(0,i.useState)(),z=I[0],L=I[1],Z=(0,i.useState)(!1),F=Z[0],B=Z[1],A=w.extensions.list((function(e){return"pgsodium"===e.name.toLowerCase()})),V=(0,K.Z)(A,1)[0],W=null!==(null===V||void 0===V?void 0:V.installed_version);if((0,i.useEffect)((function(){if(d){R({});var e=S?ye(ye({},(0,se.QZ)()),{},{keyId:E.length>0?E[0].id:"create-new"}):(0,se.uE)(s,l);L(e)}}),[d]),!z)return null;var H=function(e){U.BB.includes(z.format)||""!==e.defaultValue||(e.defaultValue=null);var n=ye(ye({},z),e);L(n),j();for(var t=ye({},T),a=0,r=Object.keys(e);a<r.length;a++){delete t[r[a]]}R(t)},Y=function(e){if(z){var n=(0,se.Of)(z);if(R(n),(0,c.isEmpty)(n)){var t=S?(0,se.oo)(l.id,z):(0,se.xY)(s,l,z),a=z.foreignKey?ye(ye({},z.foreignKey),{},{source_column_name:z.name}):void 0,r={columnId:null===s||void 0===s?void 0:s.id,isEncrypted:z.isEncrypted,keyId:z.keyId,keyName:z.keyName};b(t,a,S,r,e)}else e()}};return(0,p.jsxs)(h.hsB,{size:"xlarge",visible:d,onConfirm:function(e){return Y(e)},header:(0,p.jsx)(ae,{table:l,column:s}),onCancel:x,customFooter:(0,p.jsx)(D.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:x,applyFunction:function(e){return Y(e)}}),onInteractOutside:function(e){var n;(null===(n=e.target)||void 0===n?void 0:n.closest("#toast"))&&e.preventDefault()},children:[(0,p.jsx)(xe.hj,{header:(0,p.jsx)(xe.S0,{className:"lg:!col-span-4",children:"General"}),children:(0,p.jsxs)(xe.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,p.jsx)(h.IIB,{label:"Name",type:"text",descriptionText:"Recommended to use lowercase and use an underscore to separate words e.g. column_name",placeholder:"column_name",error:T.name,value:null!==(n=null===z||void 0===z?void 0:z.name)&&void 0!==n?n:"",onChange:function(e){return H({name:e.target.value})}}),(0,p.jsx)(h.IIB,{label:"Description",labelOptional:"Optional",type:"text",value:null!==(t=null===z||void 0===z?void 0:z.comment)&&void 0!==t?t:"",onChange:function(e){return H({comment:e.target.value})}})]})}),(0,p.jsx)(h.hsB.Separator,{}),(0,p.jsx)(xe.hj,{header:(0,p.jsx)(xe.S0,{className:"lg:!col-span-4",children:"Foreign Key Relation"}),children:(0,p.jsx)(xe.B4,{loading:!1,className:"lg:!col-span-8",children:(0,p.jsx)("div",{children:(0,p.jsx)(ie,{column:z,originalForeignKey:C,onSelectEditRelation:function(){return B(!0)},onSelectRemoveRelation:function(){return H({foreignKey:void 0})}})})})}),(0,p.jsx)(h.hsB.Separator,{}),(0,p.jsx)(xe.hj,{header:(0,p.jsx)(xe.S0,{className:"lg:!col-span-4",description:(0,p.jsx)(m.default,{href:"https://supabase.com/docs/guides/database/tables#data-types",children:(0,p.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,p.jsx)(h.zxk,{as:"span",type:"default",size:"tiny",icon:(0,p.jsx)(h.TqL,{size:14,strokeWidth:2}),children:"About data types"})})}),children:"Data Type"}),children:(0,p.jsxs)(xe.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,p.jsx)(re,{showRecommendation:!0,value:null!==(a=null===z||void 0===z?void 0:z.format)&&void 0!==a?a:"",layout:"vertical",enumTypes:_,error:T.format,disabled:!(0,c.isUndefined)(null===z||void 0===z?void 0:z.foreignKey),onOptionSelect:function(e){return H({format:e,defaultValue:null})}}),(0,c.isUndefined)(z.foreignKey)&&(0,p.jsxs)("div",{className:"space-y-4",children:[z.format.includes("int")&&(0,p.jsx)("div",{className:"w-full",children:(0,p.jsx)(h.XZJ,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:z.isIdentity,onChange:function(){var e=!z.isIdentity,n=!e&&z.isArray;H({isIdentity:e,isArray:n})}})}),!z.isPrimaryKey&&(0,p.jsx)("div",{className:"w-full",children:(0,p.jsx)(h.XZJ,{label:"Define as Array",description:"Allow column to be defined as variable-length multidimensional arrays",checked:z.isArray,onChange:function(){var e=!z.isArray,n=!e&&z.isIdentity;H({isArray:e,isIdentity:n})}})})]}),(0,p.jsx)(pe,{columnFields:z,enumTypes:_,onUpdateField:H})]})}),(0,p.jsx)(h.hsB.Separator,{}),(0,p.jsx)(xe.hj,{header:(0,p.jsx)(xe.S0,{className:"lg:!col-span-4",children:"Configuration"}),children:(0,p.jsxs)(xe.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,p.jsx)(h.ZDl,{label:"Is Primary Key",descriptionText:"A primary key indicates that a column or group of columns can be used as a unique identifier for rows in the table",checked:null!==(r=null===z||void 0===z?void 0:z.isPrimaryKey)&&void 0!==r&&r,onChange:function(){return H({isPrimaryKey:!(null!==z&&void 0!==z&&z.isPrimaryKey)})}}),(0,p.jsx)(h.ZDl,{label:"Allow Nullable",descriptionText:"Allow the column to assume a NULL value if no value is provided",checked:z.isNullable,onChange:function(){return H({isNullable:!z.isNullable})}}),(0,p.jsx)(h.ZDl,{label:"Is Unique",descriptionText:"Enforce values in the column to be unique across rows",checked:z.isUnique,onChange:function(){return H({isUnique:!z.isUnique})}})]})}),S&&O&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.hsB.Separator,{}),(0,p.jsx)(xe.hj,{header:(0,p.jsx)(xe.S0,{className:"lg:!col-span-4",children:"Security"}),children:(0,p.jsxs)(xe.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,p.jsx)(h.ZDl,{label:"Encrypt Column",error:null===T||void 0===T?void 0:T.isEncrypted,disabled:!W,descriptionText:(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("p",{children:["Encrypt the column's data with pgsodium's Transparent Column Encryption (TCE). Decrypted values will be stored within the \"decrypted_",l.name,'" view.']}),W?(0,p.jsxs)("p",{children:["Note: Only columns of ",(0,p.jsx)("code",{className:"text-xs",children:"text"})," type can be encrypted."]}):(0,p.jsxs)("p",{children:["You will need to"," ",(0,p.jsx)(m.default,{href:"/project/".concat(g,"/database/extensions?filter=pgsodium"),children:(0,p.jsx)("a",{className:"text-brand-800 hover:text-brand-900 transition",children:"install"})})," ","the extension ",(0,p.jsx)("code",{className:"text-xs",children:"pgsodium"})," first before being able to encrypt your column."]})]}),checked:z.isEncrypted,onChange:function(){return H({isEncrypted:!z.isEncrypted})}}),z.isEncrypted&&(0,p.jsx)(ve.dF,{label:"Select a key to encrypt your column with",error:null===T||void 0===T?void 0:T.keyName,selectedKeyId:z.keyId,onSelectKey:function(e){return H({keyId:e})},onUpdateDescription:function(e){return H({keyName:e})}})]})})]}),(0,p.jsx)(Ee,{column:z,visible:F,closePanel:function(){return B(!1)},saveChanges:function(e){H(ye({foreignKey:(0,c.isUndefined)(e)?void 0:{id:0,constraint_name:"",source_schema:l.schema,source_table_name:l.name,source_column_name:(null===z||void 0===z?void 0:z.name)||(null===s||void 0===s?void 0:s.name)||"",target_table_schema:e.table.schema,target_table_name:e.table.name,target_column_name:e.column.name}},!(0,c.isUndefined)(e)&&{format:e.column.format,defaultValue:null})),B(!1)}})]},"ColumnEditor")},ge=function(e){var n=e.schema,t=e.table,a=e.isDuplicating;return t?a?(0,p.jsxs)(p.Fragment,{children:["Duplicate table ",(0,p.jsx)("code",{children:t.name})]}):(0,p.jsxs)(p.Fragment,{children:["Update table ",(0,p.jsx)("code",{children:t.name})]}):(0,p.jsxs)(p.Fragment,{children:["Create a new table under ",(0,p.jsx)("code",{children:n})]})},Ne=t(3473);function we(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function ke(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?we(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):we(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Oe=function(e){var n,t,a=e.column,r=void 0===a?{}:a,s=e.enumTypes,i=void 0===s?[]:s,l=e.isNewRecord,o=void 0!==l&&l,d=e.hasImportContent,u=void 0!==d&&d,m=e.dragHandleProps,f=void 0===m?{}:m,x=e.onEditRelation,v=void 0===x?function(){}:x,b=e.onUpdateColumn,y=void 0===b?function(){}:b,j=e.onRemoveColumn,g=void 0===j?function(){}:j,N=null!==(n=null===he||void 0===he?void 0:he[r.format])&&void 0!==n?n:[],w=0;return r.isNullable&&(w+=1),r.isIdentity&&(w+=1),r.isUnique&&(w+=1),r.isArray&&(w+=1),(0,p.jsxs)("div",{className:"flex w-full items-center",children:[(0,p.jsx)("div",{className:"w-[5%] ".concat(o?"":"hidden"),children:(0,p.jsx)("div",ke(ke({className:"cursor-drag"},f),{},{children:(0,p.jsx)(h.dcc,{strokeWidth:1,size:15})}))}),(0,p.jsx)("div",{className:"w-[20%]",children:(0,p.jsx)("div",{className:"flex w-[95%] items-center justify-between",children:(0,p.jsx)(h.IIB,{value:r.name,size:"small",title:r.name,disabled:u,placeholder:"column_name",className:"table-editor-columns-input bg-white dark:bg-transparent lg:gap-0 ".concat(u?"opacity-50":""," rounded-md"),onChange:function(e){return y({name:e.target.value})}})})}),(0,p.jsx)("div",{className:"w-[5%]  pl-0.5",children:(0,p.jsx)(h.zxk,{type:(0,c.isUndefined)(r.foreignKey)?"default":"secondary",onClick:function(){return v(r)},className:"px-1 py-2",children:(0,p.jsx)(h.JHz,{size:14,strokeWidth:(0,c.isUndefined)(r.foreignKey)?1:2})})}),(0,p.jsx)("div",{className:"w-[25%]",children:(0,p.jsx)("div",{className:"w-[95%]",children:(0,p.jsx)(re,{value:r.format,enumTypes:i,size:"small",showLabel:!1,className:"table-editor-column-type lg:gap-0 ",disabled:!(0,c.isUndefined)(r.foreignKey),onOptionSelect:function(e){y({format:e,defaultValue:null})}})})}),(0,p.jsx)("div",{className:"".concat(o?"w-[25%]":"w-[30%]"),children:(0,p.jsx)("div",{className:"w-[90%]",children:(0,p.jsx)(ue,{placeholder:"string"===typeof r.defaultValue&&0===r.defaultValue.length?"Empty string":"NULL",size:"small",value:null!==(t=r.defaultValue)&&void 0!==t?t:"",disabled:r.format.includes("int")&&r.isIdentity,className:"rounded bg-white dark:bg-transparent lg:gap-0 ".concat(r.format.includes("int")&&r.isIdentity?"opacity-50":""),suggestions:N,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:function(e){return y({defaultValue:e.target.value})},onSelectSuggestion:function(e){return y({defaultValue:e.value})}})})}),(0,p.jsx)("div",{className:"w-[10%]",children:(0,p.jsx)(h.XZJ,{label:"",checked:r.isPrimaryKey,onChange:function(){return y({isPrimaryKey:!r.isPrimaryKey})}})}),(0,p.jsx)("div",{className:"".concat(u?"w-[10%]":"w-[0%]")}),(0,p.jsx)("div",{className:"flex w-[5%] justify-end",children:(!r.isPrimaryKey||r.format.includes("int"))&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(h.J2e,{size:"xlarge",className:"pointer-events-auto",header:(0,p.jsx)("div",{className:"flex items-center justify-center",children:(0,p.jsx)("h5",{className:"text-sm text-scale-1200",children:"Extra options"})}),overlay:[(0,p.jsxs)("div",{className:"flex flex-col space-y-1",children:[!r.isPrimaryKey&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.XZJ,{label:"Is Nullable",description:"Specify if the column can assume a NULL value if no value is provided",checked:r.isNullable,className:"p-4",onChange:function(){return y({isNullable:!r.isNullable})}}),(0,p.jsx)(h.J2e.Separator,{})]}),o&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.XZJ,{label:"Is Unique",description:"Enforce if values in the column should be unique across rows",checked:r.isUnique,className:"p-4",onChange:function(){return y({isUnique:!r.isUnique})}}),(0,p.jsx)(h.J2e.Separator,{})]}),r.format.includes("int")&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.XZJ,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:r.isIdentity,className:"p-4",onChange:function(){var e=!r.isIdentity,n=!e&&r.isArray;y({isIdentity:e,isArray:n})}}),(0,p.jsx)(h.J2e.Separator,{})]}),!r.isPrimaryKey&&(0,p.jsx)(h.XZJ,{label:"Define as Array",description:"Define your column as a variable-length multidimensional array",checked:r.isArray,className:"p-4",onChange:function(){var e=!r.isArray,n=!e&&r.isIdentity;y({isArray:e,isIdentity:n})}})]},"".concat(r.id,"_configuration"))],children:(0,p.jsxs)("div",{className:"group flex items-center -space-x-1",children:[w>0&&(0,p.jsx)("div",{className:"rounded-full bg-scale-1200 py-0.5 px-2 text-xs text-scale-100 dark:bg-scale-100 dark:text-scale-1100",children:w}),(0,p.jsx)("div",{className:"text-scale-1100 transition-colors group-hover:text-scale-1200",children:(0,p.jsx)(h.iCC,{size:18,strokeWidth:1})})]})})})}),!u&&(0,p.jsx)("div",{className:"flex w-[5%] justify-end",children:(0,p.jsx)("button",{className:"cursor-pointer",onClick:function(){return g()},children:(0,p.jsx)(h.kLi,{strokeWidth:1})})})]})};function Se(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Ce(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Se(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Se(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Ee=function(e){var n,t,a,r,s=e.column,l=e.visible,o=void 0!==l&&l,d=e.closePanel,m=e.saveChanges,f=(0,u.oR)().meta,x=(0,i.useState)({}),b=x[0],y=x[1],j=(0,i.useState)({schema:"public",table:"",column:""}),g=j[0],N=j[1],w=f.schemas.list(),k=f.tables.list((function(e){return e.schema===g.schema})),O=null===s||void 0===s?void 0:s.foreignKey,S=(0,c.find)(k,{name:null===g||void 0===g?void 0:g.table,schema:null===g||void 0===g?void 0:g.schema}),C=(0,c.find)(null!==(n=null===S||void 0===S?void 0:S.columns)&&void 0!==n?n:[],{name:null===g||void 0===g?void 0:g.column});(0,i.useEffect)((function(){o&&(y({}),N(O?{schema:O.target_table_schema,table:O.target_table_name,column:O.target_column_name}:{schema:"public",table:"",column:""}))}),[o]);return(0,p.jsx)(h.hsB,{size:"medium",visible:o,onCancel:d,header:(0,p.jsxs)("span",{children:["Edit foreign key relation"," ",(null===s||void 0===s?void 0:s.name)&&(0,p.jsxs)(p.Fragment,{children:["for ",(0,p.jsx)("span",{className:"text-code",children:(0,c.get)(s,["name"],"")})]})]}),customFooter:(0,p.jsx)(D.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:d,applyFunction:function(e){var n={};null!==g&&void 0!==g&&g.table||(n.table="Please select a table"),null!==g&&void 0!==g&&g.table&&!g.column&&(n.column="The table ".concat(g.table," has no columns")),y(n),(0,c.isEmpty)(n)&&m(S&&C?{table:S,column:C}:void 0),e()}}),children:(0,p.jsx)(h.hsB.Content,{children:(0,p.jsxs)("div",{className:"py-6 space-y-6",children:[(0,p.jsx)(v.Z,{icon:(0,p.jsx)(h.Sus,{size:"large",strokeWidth:1.5}),title:"What are foreign keys?",description:"Foreign keys help maintain referential integrity of your data by ensuring that no\n                one can insert rows into the table that do not have a matching entry to another\n                table.",url:"https://www.postgresql.org/docs/current/tutorial-fk.html",urlLabel:"Postgres Foreign Key Documentation"}),(0,p.jsx)(h.RiT,{id:"schema",label:"Select a schema",value:g.schema,error:b.schema,onChange:function(e){return function(e){f.tables.loadBySchema(e);var n=Ce(Ce({},g),{},{schema:e,table:"",column:""});N(n)}(e)},children:w.map((function(e){return(0,p.jsx)(h.RiT.Option,{value:e.name,label:e.name,addOnBefore:function(){return(0,p.jsx)(h.OQ8,{size:16,strokeWidth:1.5})},children:(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("span",{className:"hidden",children:e.name}),(0,p.jsx)("span",{className:"text-scale-1200",children:e.name})]})},e.id)}))}),(0,p.jsxs)(h.RiT,{id:"table",label:"Select a table to reference to",value:null!==(t=null===S||void 0===S?void 0:S.id)&&void 0!==t?t:1,error:b.table,onChange:function(e){return function(e){y({}),e||N({schema:"",table:"",column:""});var n,t=(0,c.find)(k,{id:e});t&&N({schema:t.schema,table:t.name,column:null!==(n=t.columns)&&void 0!==n&&n.length?t.columns[0].name:void 0})}(Number(e))},children:[(0,p.jsx)(h.RiT.Option,{value:1,label:"---",children:"---"},"empty"),(0,c.sortBy)(k,["schema"]).map((function(e){return(0,p.jsx)(h.RiT.Option,{value:e.id,label:e.name,children:(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("span",{className:"hidden",children:e.name}),(0,p.jsx)("span",{className:"text-scale-900",children:e.schema}),(0,p.jsx)("span",{className:"text-scale-1200",children:e.name})]})},e.id)}))]}),(null===g||void 0===g?void 0:g.table)&&(0,p.jsx)(p.Fragment,{children:0===(null!==(a=null===S||void 0===S?void 0:S.columns)&&void 0!==a?a:[]).length?(0,p.jsx)(h.IIB,{disabled:!0,label:(0,p.jsxs)("div",{children:["Select a column from ",(0,p.jsx)("code",{children:null===g||void 0===g?void 0:g.table})," to reference to"]}),error:b.column,placeholder:"This table has no columns available"}):(0,p.jsx)(h.RiT,{id:"column",value:null===C||void 0===C?void 0:C.id,label:(0,p.jsxs)("div",{children:["Select a column from ",(0,p.jsx)("code",{children:null===g||void 0===g?void 0:g.table})," to reference to"]}),error:b.column,onChange:function(e){return function(e){y({});var n=(0,c.find)(null===S||void 0===S?void 0:S.columns,{id:e});if(n){var t=Ce(Ce({},g),{},{column:n.name});N(t)}}(e)},children:(null!==(r=null===S||void 0===S?void 0:S.columns)&&void 0!==r?r:[]).map((function(e){return(0,p.jsx)(h.RiT.Option,{value:e.id,label:e.name,children:(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("span",{className:"text-scale-1200",children:e.name}),(0,p.jsx)("span",{className:"text-scale-900",children:e.format})]})},e.id)}))})})]})})},"ForeignKeySelector")};function _e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Pe(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?_e(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_e(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Te=function(e){var n,t=e.table,a=(e.tables,e.columns),r=void 0===a?[]:a,s=e.enumTypes,l=void 0===s?[]:s,o=e.importContent,d=e.isNewRecord,u=e.onColumnsUpdated,x=void 0===u?function(){}:u,b=e.onSelectImportData,y=void 0===b?function(){}:b,j=e.onClearImportContent,g=void 0===j?function(){}:j,N=(0,i.useState)(),w=N[0],k=N[1],O=!(0,c.isEmpty)(o),S=(0,c.partition)(r,(function(e){return e.isPrimaryKey})),C=(0,K.Z)(S,2),E=C[0],_=C[1],P=function(e,n){var t=r.map((function(t){if(t.id===e.id){if(U.BB.includes(e.format)||""!==n.defaultValue||(n.defaultValue=null),"name"in n&&!(0,c.isUndefined)(t.foreignKey)){var a,r=Pe(Pe({},t.foreignKey),{},{source_column_name:null!==(a=null===n||void 0===n?void 0:n.name)&&void 0!==a?a:""});return Pe(Pe(Pe({},t),n),{},{foreignKey:r})}return Pe(Pe({},t),n)}return t}));x(t)},T=function(e){var n=r.filter((function(n){return n.id!==e.id}));x(n)},R=function(e,n){if(e.destination){if("pks"===n){var t=E.slice(),a=t.splice(e.source.index,1),r=(0,K.Z)(a,1)[0];t.splice(e.destination.index,0,r);var s=t.concat(_);return x(s)}if("others"===n){var i=_.slice(),l=i.splice(e.source.index,1),o=(0,K.Z)(l,1)[0];i.splice(e.destination.index,0,o);var c=E.concat(i);return x(c)}}};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"w-full space-y-4 table-editor-columns",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,p.jsx)("h5",{children:"Columns"}),d&&(0,p.jsx)(p.Fragment,{children:O?(0,p.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,p.jsx)(h.zxk,{type:"default",icon:(0,p.jsx)(h.yl5,{}),onClick:y,children:"Edit content"}),(0,p.jsx)(h.zxk,{danger:!0,type:"outline",icon:(0,p.jsx)(h.IT9,{}),onClick:g,children:"Remove content"})]}):(0,p.jsx)(h.zxk,{type:"default",onClick:y,children:"Import data via spreadsheet"})})]}),O&&(0,p.jsx)("div",{className:"my-2 opacity-75",children:(0,p.jsxs)("p",{children:["Your table will be created with ",null===o||void 0===o||null===(n=o.rowCount)||void 0===n?void 0:n.toLocaleString()," rows and the following ",r.length," columns."]})}),0===E.length&&(0,p.jsx)(h.bZj,{title:"Warning: No primary keys selected",variant:"warning",withIcon:!0,children:"Tables require at least one column as a primary key in order to uniquely identify each row. Without a primary key, you will not be able to update or delete rows from the table."}),E.length>1&&(0,p.jsx)(v.Z,{block:!0,icon:(0,p.jsx)(h.Ol,{className:"text-white",size:"large"}),title:"Composite primary key selected",description:"The columns that you've selected will be grouped as a primary key, and will serve as the unique identifier for the rows in your table"}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("div",{className:"flex w-full px-3",children:[d&&(0,p.jsx)("div",{className:"w-[5%]"}),(0,p.jsxs)("div",{className:"w-[25%] flex items-center space-x-2",children:[(0,p.jsx)("h5",{className:"text-xs text-scale-900",children:"Name"}),(0,p.jsxs)(f.fC,{delayDuration:0,children:[(0,p.jsx)(f.xz,{children:(0,p.jsx)("h5",{className:"text-xs text-scale-900",children:(0,p.jsx)(h.Sus,{size:15,strokeWidth:1.5})})}),(0,p.jsxs)(f.VY,{side:"bottom",children:[(0,p.jsx)(f.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 "].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"Recommended to use lowercase and use an underscore to separate words e.g. column_name"})})]})]})]}),(0,p.jsx)("div",{className:"w-[25%]",children:(0,p.jsx)("h5",{className:"text-xs text-scale-900",children:"Type"})}),(0,p.jsxs)("div",{className:"".concat(d?"w-[25%]":"w-[30%]"," flex items-center space-x-2"),children:[(0,p.jsx)("h5",{className:"text-xs text-scale-900",children:"Default Value"}),(0,p.jsxs)(f.fC,{delayDuration:0,children:[(0,p.jsx)(f.xz,{children:(0,p.jsx)("h5",{className:"text-xs text-scale-900",children:(0,p.jsx)(h.Sus,{size:15,strokeWidth:1.5})})}),(0,p.jsxs)(f.VY,{side:"bottom",children:[(0,p.jsx)(f.Eh,{className:"radix-tooltip-arrow"}),(0,p.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 "].join(" "),children:(0,p.jsx)("span",{className:"text-xs text-scale-1200",children:"Can be either a value or a SQL expression"})})]})]})]}),(0,p.jsx)("div",{className:"w-[10%]",children:(0,p.jsx)("h5",{className:"text-xs text-scale-900",children:"Primary"})}),(0,p.jsx)("div",{className:"".concat(O?"w-[10%]":"w-0")}),(0,p.jsx)("div",{className:"w-[5%]"}),!O&&(0,p.jsx)("div",{className:"w-[5%]"})]}),E.length>0&&(0,p.jsx)(Ne.Z5,{onDragEnd:function(e){return R(e,"pks")},children:(0,p.jsx)(Ne.bK,{droppableId:"pk_columns_droppable",children:function(e){return(0,p.jsxs)("div",{ref:e.innerRef,className:"space-y-2 rounded-md bg-gray-400 px-3 py-2 ".concat(d?"":"-mx-3"),children:[E.map((function(e,n){return(0,p.jsx)(Ne._l,{draggableId:e.id,index:n,children:function(n){return(0,p.jsx)("div",Pe(Pe({ref:n.innerRef},n.draggableProps),{},{children:(0,p.jsx)(Oe,{column:e,enumTypes:l,isNewRecord:d,hasImportContent:O,dragHandleProps:n.dragHandleProps,onEditRelation:function(){k(e)},onUpdateColumn:function(n){return P(e,n)},onRemoveColumn:function(){return T(e)}})}))}},e.id)})),e.placeholder]})}})}),(0,p.jsx)(Ne.Z5,{onDragEnd:function(e){return R(e,"others")},children:(0,p.jsx)(Ne.bK,{droppableId:"other_columns_droppable",children:function(e){return(0,p.jsxs)("div",{ref:e.innerRef,className:"space-y-2 py-2 ".concat(d?"px-3 ":""),children:[_.map((function(e,n){return(0,p.jsx)(Ne._l,{draggableId:e.id,index:n,children:function(n){return(0,p.jsx)("div",Pe(Pe({ref:n.innerRef},n.draggableProps),{},{children:(0,p.jsx)(Oe,{column:e,enumTypes:l,isNewRecord:d,hasImportContent:O,dragHandleProps:n.dragHandleProps,onEditRelation:function(){k(e)},onUpdateColumn:function(n){return P(e,n)},onRemoveColumn:function(){return T(e)}})}))}},e.id)})),e.placeholder]})}})})]}),(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[!O&&(0,p.jsx)(h.zxk,{type:"default",onClick:function(){return function(){var e=(0,se.QZ)(),n=r.concat(e);x(n)}()},children:"Add column"}),(0,p.jsx)(m.default,{href:"https://supabase.com/docs/guides/database/tables#data-types",children:(0,p.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,p.jsx)(h.zxk,{type:"text",className:"text-scale-1000 hover:text-scale-1200",icon:(0,p.jsx)(h.TqL,{size:12,strokeWidth:2}),children:"Learn more about data types"})})})]})]}),(0,p.jsx)(Ee,{column:w,visible:!(0,c.isUndefined)(w),closePanel:function(){return k(void 0)},saveChanges:function(e){var n,a;(0,c.isUndefined)(w)||P(w,Pe({foreignKey:(0,c.isUndefined)(e)?void 0:{id:0,constraint_name:"",source_schema:null!==(n=null===t||void 0===t?void 0:t.schema)&&void 0!==n?n:"",source_table_name:null!==(a=null===t||void 0===t?void 0:t.name)&&void 0!==a?a:"",source_column_name:null===w||void 0===w?void 0:w.name,target_table_schema:e.table.schema,target_table_name:e.table.name,target_column_name:e.column.name}},!(0,c.isUndefined)(e)&&{format:e.column.format,defaultValue:null}));k(void 0)}})]})},Re=function(e){var n=e.input,t=e.onInputChange;return(0,p.jsxs)("div",{className:"space-y-10",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{className:"mb-2 text-sm text-scale-1100",children:["Copy a table from a spreadsheet program such as Google Sheets or Excel and paste it in the field below. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,p.jsx)("code",{children:"-"}),") or underscores (",(0,p.jsx)("code",{children:"_"}),")."]}),(0,p.jsx)("p",{className:"text-xs text-scale-900",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),(0,p.jsx)(h.IIB.TextArea,{size:"tiny",className:"font-mono",rows:15,style:{resize:"none"},value:n,onChange:t})]})},De=t(39466),Ie=function(e){var n=e.parseProgress,t=e.uploadedFile,a=e.onFileUpload,r=e.removeUploadedFile,s=(0,i.useState)(!1),l=s[0],o=s[1],c=(0,i.useRef)(null),d=function(e){"dragover"!==e.type||l?"dragleave"!==e.type&&"drop"!==e.type||o(!1):o(!0),e.stopPropagation(),e.preventDefault()};return(0,p.jsxs)("div",{className:"space-y-10",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{className:"mb-2 text-sm text-scale-1100",children:["Upload a CSV or TSV file. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,p.jsx)("span",{className:"text-code",children:"-"}),") or underscores (",(0,p.jsx)("span",{className:"text-code",children:"_"}),")."]}),(0,p.jsx)("p",{className:"text-xs text-scale-900",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),t?(0,p.jsxs)("div",{className:"flex h-32 flex-col items-center justify-center space-y-2 rounded-md border border-dashed dark:border-gray-500",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(h.k_6,{size:14,strokeWidth:1.5}),(0,p.jsx)("h3",{className:"text-base text-scale-1200",children:t.name})]}),100===n?(0,p.jsx)(h.zxk,{type:"outline",onClick:r,children:"Remove File"}):(0,p.jsxs)("div",{className:"flex w-3/5 items-center space-x-2",children:[(0,p.jsx)(h.pAw,{className:"h-4 w-4 animate-spin"}),(0,p.jsx)(De.Z,{value:n,max:100,type:"horizontal",barClass:"bg-green-500",labelBottom:"Parsing file...",labelTop:"".concat(n,"%")})]})]}):(0,p.jsx)("div",{className:"flex h-48 cursor-pointer items-center justify-center rounded-md border border-dashed dark:border-gray-500 ".concat(l?"bg-gray-500":""),onDragOver:d,onDragLeave:d,onDrop:function(e){d(e),a(e)},onClick:function(){var e;return null===(e=c.current)||void 0===e?void 0:e.click()},children:(0,p.jsxs)("p",{children:["Drag and drop, or ",(0,p.jsx)("span",{className:"text-green-1000",children:"browse"})," your files"]})}),(0,p.jsx)("input",{ref:c,className:"hidden",type:"file",onChange:a})]})},ze=t(98637),Le=function(e){var n=e.headers,t=void 0===n?[]:n,a=e.rows,r=void 0===a?[]:a,s=t.slice(0,20),i=r.slice(0,20);return(0,p.jsx)(ze.ZP,{columns:s.map((function(e){return{key:e,name:e,width:10*e.length,resizable:!0,headerRenderer:function(){return(0,p.jsx)("div",{className:"flex items-center justify-center font-mono h-full",children:(0,p.jsx)("p",{className:"text-sm",children:e})})},formatter:function(n){var t=n.row;return(0,p.jsx)("span",{className:"font-mono text-xs",children:(0,c.isUndefined)(t[e])?"NULL":t[e]})}}})),rows:i,className:"!border-l !border-r",style:{height:"".concat(34+34*(i.length||1),"px")}})},Ze=t(44285),Ke=t(46381),Fe=t.n(Ke),Be=["text/csv","text/tab-separated-values","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],Ue=["csv","tsv"],Ae={headers:[],rows:[],rowCount:0,columnTypeMap:{}};function Ve(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function We(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ve(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ve(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var He=262144,Ye=function(e){var n={},t=[];return new Promise((function(a){Fe().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:function(e){var r=e.meta.fields||[],s=e.data,i=e.errors;r.forEach((function(t){var a=Je(t,e.data);(0,c.has)(n,t)?n[t]!==a&&(n[t]="text"):n[t]=a})),t=e.data.slice(0,20),a({headers:r,rows:s,previewRows:t,columnTypeMap:n,errors:i})}})}))},qe=function(e,n){var t=[],a=0,r=0,s=[],i={},l=[];return new Promise((function(o){Fe().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,quoteChar:"text/tab-separated-values"===e.type?"":'"',chunkSize:He,chunk:function(o){if((t=o.meta.fields).forEach((function(e){var n=Je(e,o.data);(0,c.has)(i,e)?i[e]!==n&&(i[e]="text"):i[e]=n})),r+=o.data.length,s=o.data.slice(0,20),o.errors.length>0){var d=o.errors.map((function(e){return We(We({},e),{},{data:o.data[e.row]})}));l.push.apply(l,(0,Ze.Z)(d))}var u=(a+=1)*He/e.size;n(u>1?100:Number((100*u).toFixed(2)))},complete:function(){o({headers:t,rowCount:r,previewRows:s,columnTypeMap:i,errors:l})}})}))},Je=function(e,n){if(0===n.length)return"text";var t=n[0][e],a=n.map((function(n){return n[e]}));if(void 0===t||null===t)return"text";if(Number(t)){var r=n.map((function(n){return Number(n[e])}));return r.includes(NaN)?"text":r.map((function(e){return e%1})).every((function(e){return 0===e}))?"int8":"float8"}if((0,c.includes)(["true","false"],t.toString().toLowerCase())&&a.every((function(e){return null===e||void 0===e||(0,c.includes)(["true","false"],e.toString().toLowerCase())})))return"bool";if((0,I.dW)(t)&&a.every((function(e){return(0,I.dW)(t)})))return"jsonb";if(Date.parse(t)&&a.every((function(e){return W()(e,"YYYY-MM-DD hh:mm:ss").isValid()})))return"timestamptz";return"text"},Me=function(e){var n=null===e||void 0===e?void 0:e.name.split(".").pop().toLowerCase();return Ue.includes(n)};function Qe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}var Xe=function(e){var n=e.debounceDuration,t=void 0===n?250:n,r=e.headers,l=void 0===r?[]:r,o=e.rows,d=void 0===o?[]:o,m=e.saveContent,f=e.closePanel,x=e.visible,v=void 0!==x&&x,b=(0,u.oR)().ui;(0,i.useEffect)((function(){v&&0===l.length&&A()}),[v]);var y=(0,i.useState)(""),g=y[0],N=y[1],w=(0,i.useState)(null),k=w[0],O=w[1],S=(0,i.useState)(0),C=S[0],E=S[1],_=(0,i.useState)({headers:l,rows:d,rowCount:0,columnTypeMap:{}}),P=_[0],T=_[1],R=(0,i.useState)([]),I=R[0],z=R[1],L=(0,i.useState)([]),Z=L[0],F=L[1],B=function(e){E(e)},U=function(){var e=(0,a.Z)(s().mark((function e(n){var t,a,r,i,l,o,d,u,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E(0),n.persist(),t=n.target.files||n.dataTransfer.files,a=(0,K.Z)(t,1),(r=a[0])&&(0,c.includes)(Be,null===r||void 0===r?void 0:r.type)&&Me(r)){e.next=7;break}b.setNotification({category:"info",message:"Sorry! We only accept CSV or TSV file types, please upload another file."}),e.next=19;break;case 7:return O(r),e.next=10,qe(r,B);case 10:i=e.sent,l=i.headers,o=i.rowCount,d=i.columnTypeMap,u=i.errors,m=i.previewRows,u.length>0&&b.setNotification({error:u,category:"error",message:"Some issues have been detected on ".concat(u.length," rows. More details below the content preview."),duration:4e3}),z(u),T({headers:l,rows:m,rowCount:o,columnTypeMap:d});case 19:n.target.value="";case 20:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),A=function(){N(""),T(Ae),O(null),z([]),F([])},V=function(){var e=(0,a.Z)(s().mark((function e(n){var t,a,r,i,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>0)){e.next=13;break}return e.next=3,Ye(n);case 3:t=e.sent,a=t.headers,r=t.rows,i=t.columnTypeMap,(l=t.errors).length>0&&b.setNotification({error:l,category:"error",message:"Some issues have been detected on ".concat(l.length," rows. More details below the content preview."),duration:4e3}),z(l),T({headers:a,rows:r,rowCount:r.length,columnTypeMap:i}),e.next=14;break;case 13:T(Ae);case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),W=(0,i.useCallback)((0,c.debounce)(V,t),[]);return(0,p.jsx)(h.hsB,{size:"large",visible:v,align:"right",header:"Add content to new table",onCancel:function(){return f()},customFooter:(0,p.jsx)(D.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:f,applyFunction:function(){m(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Qe(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Qe(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({file:k},P))}}),children:(0,p.jsxs)(h.hsB.Content,{children:[(0,p.jsx)("div",{className:"flex flex-col",children:(0,p.jsxs)(h.mQc,{block:!0,type:"pills",children:[(0,p.jsx)(h.mQc.Panel,{id:"fileUpload",label:"Upload CSV",children:(0,p.jsx)(Ie,{parseProgress:C,uploadedFile:k,onFileUpload:U,removeUploadedFile:A})}),(0,p.jsx)(h.mQc.Panel,{id:"pasteText",label:"Paste text",children:(0,p.jsx)(Re,{input:g,onInputChange:function(e){N(e.target.value),W(e.target.value)}})})]})}),P.headers.length>0&&(0,p.jsxs)("div",{className:"space-y-5 py-5",children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,p.jsx)("p",{children:"Content Preview"}),(0,p.jsxs)("p",{className:"text-scale-1000",children:["Your table will have ",P.rowCount.toLocaleString()," rows and the following ",P.headers.length," columns."]}),(0,p.jsx)("p",{className:"text-scale-1000",children:"Here is a preview of your table (up to the first 20 columns and first 20 rows)."})]}),(0,p.jsx)(Le,{headers:P.headers,rows:P.rows})]}),I.length>0&&(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,p.jsx)("p",{children:"Issues found in spreadsheet"}),(0,p.jsx)("p",{className:"text-scale-1000",children:"Your table can still be created nonetheless despite issues in the following rows."})]}),(0,p.jsx)("div",{className:"space-y-2",children:I.map((function(e,n){var t,a,r="import-error-".concat(n),s=Z.includes(r);return(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(h.VG8,{className:"transform cursor-pointer ".concat(s?"rotate-90":""),size:14,onClick:function(){return function(e){Z.includes(e)?F(Z.filter((function(n){return n!==e}))):F(Z.concat([e]))}(r)}}),(0,p.jsxs)("p",{className:"w-14",children:["Row: ",e.row]}),(0,p.jsx)("p",{children:e.message}),(null===(t=e.data)||void 0===t?void 0:t.__parsed_extra)&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.Ec8,{size:14}),(0,p.jsx)("p",{children:"Extra field(s):"}),null===(a=e.data)||void 0===a?void 0:a.__parsed_extra.map((function(e,n){return(0,p.jsx)("code",{className:"text-sm",children:e},n)}))]})]}),s&&(0,p.jsx)(Le,{headers:P.headers,rows:[e.data]})]},r)}))})]})]})]})})},Ge=[{id:(0,I.k$)(),name:"id",format:"int8",defaultValue:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!0,isIdentity:!0,isNewColumn:!0,isEncrypted:!1},{id:(0,I.k$)(),name:"created_at",format:"timestamptz",defaultValue:"now()",foreignKey:void 0,isNullable:!0,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}];function $e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function en(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?$e(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$e(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var nn=function(e){var n,t,a=e.table,r=e.selectedSchema,s=e.isDuplicating,l=e.visible,o=void 0!==l&&l,d=e.closePanel,m=void 0===d?function(){}:d,f=e.saveChanges,x=void 0===f?function(){}:f,v=e.updateEditorDirty,b=void 0===v?function(){}:v,y=(0,u.oR)(),j=y.ui,g=y.meta,N=(0,c.isUndefined)(a),w=g.tables.list(),k=g.types.list((function(e){return!g.excludedSchemas.includes(e.schema)})),O=g.publications.list().find((function(e){return"supabase_realtime"===e.name})),S=null!==(n=null===O||void 0===O?void 0:O.tables)&&void 0!==n?n:[],C=!N&&S.some((function(e){return e.id===(null===a||void 0===a?void 0:a.id)})),E=(0,i.useState)({}),_=E[0],P=E[1],T=(0,i.useState)(),R=T[0],I=T[1],z=(0,i.useState)(!1),L=z[0],Z=z[1],K=(0,i.useState)(),F=K[0],B=K[1],U=(0,i.useState)(!1),A=U[0],V=U[1];(0,i.useEffect)((function(){if(o)if(P({}),B(void 0),Z(!1),N){I({id:0,name:"",comment:"",columns:Ge,isRLSEnabled:!0,isRealtimeEnabled:!1})}else{var e=function(e){var n,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{id:e.id,name:t?"".concat(e.name,"_duplicate"):e.name,comment:t?"This is a duplicate of ".concat(e.name):null!==(n=null===e||void 0===e?void 0:e.comment)&&void 0!==n?n:"",columns:e.columns.map((function(n){return(0,se.uE)(n,e)})),isRLSEnabled:e.rls_enabled,isRealtimeEnabled:a}}(a,s,C);I(e)}}),[o]),(0,i.useEffect)((function(){if(F&&!(0,c.isEmpty)(F)){var e=function(e){return e.headers.map((function(n){var t=e.columnTypeMap[n];return(0,se.QZ)({name:n,format:t})}))}(F);W({columns:e})}}),[F]);var W=function(e){var n=en(en({},R),e);I(n),b();for(var t=en({},_),a=0,r=Object.keys(e);a<r.length;a++){delete t[r[a]]}P(t)},H=function(e){if(R){var n=function(e){var n={};return 0===e.name.length&&(n.name="Please assign a name for your table"),(0,c.some)(e.columns,(function(e){return 0===e.format.length}))&&(n.columns="Ensure that all your columns are assigned a type"),(0,c.some)(e.columns,(function(e){return 0===e.name.length}))&&(n.columns="Ensure that all your columns are named"),n}(R);if(n.columns&&j.setNotification({category:"error",message:n.columns,duration:4e3}),P(n),(0,c.isEmpty)(n)){var t=en({name:R.name,schema:r,comment:R.comment},!N&&{rls_enabled:R.isRLSEnabled}),s=R.columns.map((function(e){return e.foreignKey?en(en({},e),{},{foreignKey:en(en({},e.foreignKey),{},{source_table_name:R.name})}):e})),i={tableId:null===a||void 0===a?void 0:a.id,importContent:F,isRLSEnabled:R.isRLSEnabled,isRealtimeEnabled:R.isRealtimeEnabled,isDuplicateRows:L};x(t,s,N,i,e)}else e()}};return R?(0,p.jsx)(h.hsB,{size:"large",visible:o,header:(0,p.jsx)(ge,{schema:r,table:a,isDuplicating:s}),className:"transition-all duration-100 ease-in ".concat(A?" mr-32":""),onCancel:m,onConfirm:function(){return function(e){return H(e)}},customFooter:(0,p.jsx)(D.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:m,applyFunction:function(e){return H(e)}}),onInteractOutside:function(e){var n;(null===(n=e.target)||void 0===n?void 0:n.closest("#toast"))&&e.preventDefault()},children:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.hsB.Content,{children:(0,p.jsxs)("div",{className:"space-y-10 py-6",children:[(0,p.jsx)(h.IIB,{label:"Name",layout:"horizontal",type:"text",error:_.name,value:null===R||void 0===R?void 0:R.name,onChange:function(e){return W({name:e.target.value})}}),(0,p.jsx)(h.IIB,{label:"Description",placeholder:"Optional",layout:"horizontal",type:"text",value:null!==(t=null===R||void 0===R?void 0:R.comment)&&void 0!==t?t:"",onChange:function(e){return W({comment:e.target.value})}})]})}),(0,p.jsx)(h.hsB.Separator,{}),(0,p.jsx)(h.hsB.Content,{children:(0,p.jsxs)("div",{className:"space-y-10 py-6",children:[(0,p.jsx)(h.XZJ,{id:"enable-rls",label:(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("span",{children:"Enable Row Level Security (RLS)"}),(0,p.jsx)(h.Cts,{color:"gray",children:"Recommended"})]}),description:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("p",{children:"Restrict access to your table by enabling RLS and writing Postgres policies."}),(0,p.jsx)("p",{children:"RLS is secure by default - all normal access to this table must be allowed by a policy."}),!R.isRLSEnabled&&(0,p.jsx)(h.bZj,{withIcon:!0,variant:"warning",className:"!px-4 !py-3 mt-3",title:"Turning off RLS means that you are allowing anonymous access to your table",children:"As such, anyone with the anonymous key can modify or delete your data."})]}),checked:R.isRLSEnabled,onChange:function(){return W({isRLSEnabled:!R.isRLSEnabled})},size:"medium"}),(0,p.jsx)(h.XZJ,{id:"enable-realtime",label:"Enable Realtime",description:"Broadcast changes on this table to authorized subscribers",checked:R.isRealtimeEnabled,onChange:function(){return W({isRealtimeEnabled:!R.isRealtimeEnabled})},size:"medium"})]})}),(0,p.jsx)(h.hsB.Separator,{}),(0,p.jsx)(h.hsB.Content,{children:(0,p.jsxs)("div",{className:"space-y-10 py-6",children:[!s&&(0,p.jsx)(Te,{table:{name:R.name,schema:r},tables:w,columns:null===R||void 0===R?void 0:R.columns,enumTypes:k,isNewRecord:N,importContent:F,onColumnsUpdated:function(e){return W({columns:e})},onSelectImportData:function(){return V(!0)},onClearImportContent:function(){W({columns:Ge}),B(void 0)}}),s&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(h.XZJ,{id:"duplicate-rows",label:"Duplicate table entries",description:"This will copy all the data in the table into the new table",checked:L,onChange:function(){return Z(!L)},size:"medium"})}),(0,p.jsx)(Xe,{visible:A,headers:null===F||void 0===F?void 0:F.headers,rows:null===F||void 0===F?void 0:F.rows,saveContent:function(e){B(e),V(!1)},closePanel:function(){return V(!1)}})]})})]})},"TableEditor"):null},tn=Z,an=(0,l.Pi)((function(e){var n,t,r,l=e.theme,m=void 0===l?"dark":l,f=e.selectedSchema,h=e.selectedTable,v=e.sidePanelKey,y=e.isDuplicating,j=e.selectedRowToEdit,N=e.selectedColumnToEdit,w=e.selectedTableToEdit,k=e.selectedValueForJsonEdit,O=e.onAddRow,S=void 0===O?function(){}:O,C=e.onEditRow,E=void 0===C?function(){}:C,_=e.onAddColumn,P=void 0===_?function(){}:_,T=e.onEditColumn,R=void 0===T?function(){}:T,D=e.onDeleteColumn,I=void 0===D?function(){}:D,z=e.onExpandJSONEditor,L=void 0===z?function(){}:z,Z=e.onClosePanel,K=void 0===Z?function(){}:Z,F=(0,u.oR)(),B=F.meta,U=F.ui,A=F.vault,V=(0,o.useRouter)(),W=(0,i.useRef)(null),H=null===(n=U.selectedProject)||void 0===n?void 0:n.ref,Y=(0,u.P5)("vaultExtension"),q=(0,i.useState)([]),J=q[0],M=q[1],Q=!(0,u.FH)(d.KA.TENANT_SQL_ADMIN_WRITE,"tables")&&!(0,u.FH)(d.KA.TENANT_SQL_ADMIN_WRITE,"columns"),X=function(){var e=(0,a.Z)(s().mark((function e(n){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.listEncryptedColumns(n.schema,n.name);case 2:t=e.sent,M(t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();if((0,i.useEffect)((function(){void 0!==h&&void 0!==h.id&&Y&&X(h)}),[null===h||void 0===h?void 0:h.id]),(0,c.isUndefined)(h))return(0,p.jsx)(b,{id:Number(V.query.id)});var G=null===h||void 0===h?void 0:h.id,$=B.schemas.list().find((function(e){return e.name===f})),ee=!Object.keys(h).includes("rls_enabled"),ne=void 0!==B.foreignTables.byId(h.id),te=B.excludedSchemas.includes(null!==(t=null===$||void 0===$?void 0:$.name)&&void 0!==t?t:""),ae=(0,u.FH)(d.KA.TENANT_SQL_ADMIN_WRITE,"tables"),re=!ee&&!ne&&!te,se=ee||ne?h.name:(0,g.parseSupaTable)({table:h,columns:null!==(r=h.columns)&&void 0!==r?r:[],primaryKeys:h.primary_keys,relationships:h.relationships},J),ie="".concat(h.schema,"_").concat(h.name),le=function(){var e=(0,a.Z)(s().mark((function e(n){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.query(n);case 2:if(!(t=e.sent).error){e.next=7;break}return e.abrupt("return",{error:t.error});case 7:return e.abrupt("return",{data:t});case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=(0,a.Z)(s().mark((function e(n){var t,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=B.tables.list(),a=t.find((function(e){return e.id===Number(G)})),(r=(0,c.find)(a.columns,{name:n}))?R(r):console.error("Unable to find column ".concat(n," in ").concat(null===a||void 0===a?void 0:a.name));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ce=function(){var e=(0,a.Z)(s().mark((function e(n){var t,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=B.tables.list(),a=t.find((function(e){return e.id===Number(G)})),r=(0,c.find)(a.columns,{name:n}),I(r);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(g.SupabaseGrid,{ref:W,theme:m,gridProps:{height:"100%"},storageRef:H,editable:!Q&&ae&&re,schema:h.schema,table:se,headerActions:re&&(0,p.jsx)(x,{table:h}),onAddColumn:P,onEditColumn:oe,onDeleteColumn:ce,onAddRow:S,onEditRow:E,onError:function(e){var n,t;U.setNotification({category:"error",message:null!==(n=null!==(t=null===e||void 0===e?void 0:e.details)&&void 0!==t?t:null===e||void 0===e?void 0:e.message)&&void 0!==n?n:e})},onSqlQuery:le,onExpandJSONEditor:L},ie),!(0,c.isUndefined)(f)&&(0,p.jsx)(tn,{selectedSchema:f,isDuplicating:y,selectedTable:h,selectedRowToEdit:j,selectedColumnToEdit:N,selectedTableToEdit:w,selectedValueForJsonEdit:k,sidePanelKey:v,onRowCreated:function(e){W.current&&W.current.rowAdded(e)},onRowUpdated:function(e,n){W.current&&W.current.rowEdited(e,n)},onColumnSaved:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&X(h)},onTableCreated:function(e){V.push("/project/".concat(H,"/editor/").concat(e.id))},closePanel:K})]})})),rn=t(89744),sn=(0,l.Pi)((function(e){var n=e.selectedSchema,t=e.onAddTable,a=(0,u.oR)().meta,r=a.tables.list((function(e){return e.schema===n})),s=!a.excludedSchemas.includes(n)&&(0,u.FH)(d.KA.TENANT_SQL_ADMIN_WRITE,"tables");return(0,p.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:0===r.length?(0,p.jsx)(rn.Z,{title:"Table Editor",ctaButtonLabel:s?"Create a new table":void 0,onClickCta:s?t:void 0,children:(0,p.jsx)("p",{className:"text-sm text-scale-1100",children:"There are no tables available in this schema."})}):(0,p.jsx)("div",{className:"flex flex-col items-center space-y-4",children:(0,p.jsx)(rn.Z,{title:"Table Editor",ctaButtonLabel:s?"Create a new table":void 0,onClickCta:s?t:void 0,children:(0,p.jsxs)("p",{className:"text-sm text-scale-1100",children:["Select a table from the navigation panel on the left to view its data",s&&", or create a new one."]})})})})})),ln=an}}]);
//# sourceMappingURL=7173-9ec6d2d1a7221091.js.map