(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2580],{68376:function(e,t,n){"use strict";n.d(t,{dU:function(){return o.dU},uW:function(){return o.uW},mM:function(){return r.ZP}});var r=n(7173),o=n(83015)},51324:function(e,t,n){"use strict";n.r(t);var r=n(55732),o=n(90849),i=n(11246),c=n(34707),a=n.n(c),s=n(27378),l=n(79894),u=n(86677),d=n(25229),f=n(98784),p=n(88983),h=n(42791),b=n(80172),m=n(68376),v=n(63840),j=n(24246);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=(0,h.QO)((0,d.Pi)((function(){var e,t=(0,u.useRouter)(),n=(0,h.UO)().id,o=(0,h.x3)({arrayKeys:["filter","sort"]}),c=(0,i.Z)(o,2),d=(c[0],c[1]),w=(0,h.oR)(),y=w.meta,g=w.ui,S=(0,s.useState)(),k=S[0],O=S[1],N=(0,s.useState)(!1),D=N[0],C=N[1],E=(0,s.useState)(!1),_=E[0],T=E[1],P=(0,s.useState)(!1),Z=P[0],A=P[1],L=(0,s.useState)(),z=L[0],q=L[1],J=(0,s.useState)(),R=J[0],U=J[1],W=(0,s.useState)(),X=W[0],B=W[1],F=(0,s.useState)(),I=F[0],K=F[1],M=(0,s.useState)(),Q=M[0],V=M[1],G=(0,s.useState)(),H=G[0],Y=G[1],$=(0,s.useState)(),ee=$[0],te=$[1],ne=null===(e=g.selectedProject)||void 0===e?void 0:e.ref,re=y.tables.list(),oe=y.views.list(),ie=y.foreignTables.list(),ce=(0,f.isNaN)(Number(n))?void 0:re.concat(oe).concat(ie).find((function(e){return e.id===Number(n)}));(0,s.useEffect)((function(){ce&&"schema"in ce&&O(ce.schema)}),[null===ce||void 0===ce?void 0:ce.name]);var ae=function(e){d((function(t){var n,r,o=null!==(n=null===t||void 0===t?void 0:t.filter)&&void 0!==n?n:[],c=null!==(r=null===t||void 0===t?void 0:t.sort)&&void 0!==r?r:[];return x(x({},t),{},{filter:o.filter((function(t){var n=t.split(":");if((0,i.Z)(n,1)[0]!==e)return t})),sort:c.filter((function(t){var n=t.split(":");if((0,i.Z)(n,1)[0]!==e)return t}))})}))},se=function(){var e=(0,r.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==z){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,y.columns.del(z.id,Z);case 5:if(!(t=e.sent).error){e.next=8;break}throw t.error;case 8:return ae(z.name),g.setNotification({category:"success",message:'Successfully deleted column "'.concat(z.name,'"')}),e.next=12,y.tables.loadById(z.table_id);case 12:if(!k){e.next=15;break}return e.next=15,y.views.loadBySchema(k);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),g.setNotification({category:"error",message:"Failed to delete ".concat(z.name,": ").concat(e.t0.message)});case 20:return e.prev=20,C(!1),q(void 0),e.finish(20);case 24:case"end":return e.stop()}}),e,null,[[0,17,20,24]])})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=(0,r.Z)(a().mark((function e(){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==R){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,y.tables.del(R.id,Z);case 5:if(!(n=e.sent).error){e.next=8;break}throw n.error;case 8:if((r=y.tables.list((function(e){return e.schema===k}))).length>0?t.push("/project/".concat(ne,"/editor/").concat(r[0].id)):t.push("/project/".concat(ne,"/editor/")),g.setNotification({category:"success",message:'Successfully deleted table "'.concat(R.name,'"')}),!k){e.next=14;break}return e.next=14,y.views.loadBySchema(k);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),g.setNotification({error:e.t0,category:"error",message:"Failed to delete ".concat(null===R||void 0===R?void 0:R.name,": ").concat(e.t0.message)});case 19:return e.prev=19,C(!1),U(void 0),e.finish(19);case 23:case"end":return e.stop()}}),e,null,[[0,16,19,23]])})));return function(){return e.apply(this,arguments)}}();return(0,j.jsxs)(b.lz,{selectedSchema:k,onSelectSchema:O,onAddTable:function(){B("table"),T(!1),Y(void 0)},onEditTable:function(e){B("table"),T(!1),Y(e)},onDeleteTable:function(e){C(!0),U(e),A(!1)},onDuplicateTable:function(e){B("table"),T(!0),Y(e)},children:[(0,j.jsx)(m.mM,{selectedSchema:k,selectedTable:ce,sidePanelKey:X,isDuplicating:_,selectedRowToEdit:I,selectedColumnToEdit:Q,selectedTableToEdit:H,selectedValueForJsonEdit:ee,onAddRow:function(){B("row"),K(void 0)},onEditRow:function(e){B("row"),K(e)},onAddColumn:function(){B("column"),V(void 0)},onEditColumn:function(e){B("column"),V(e)},onDeleteColumn:function(e){C(!0),q(e),A(!1)},onExpandJSONEditor:function(e,t){B("json"),te({column:e,row:t,jsonString:JSON.stringify(t[e])||""})},onClosePanel:function(){B(void 0)},theme:"dark"==g.themeOption?"dark":"light"}),(0,j.jsx)(v.Z,{danger:!0,size:"small",visible:D&&!(0,f.isUndefined)(z),header:'Confirm deletion of column "'.concat(null===z||void 0===z?void 0:z.name,'"'),children:(0,j.jsx)(p.u_l.Content,{children:(0,j.jsxs)("div",{className:"py-4 space-y-4",children:[(0,j.jsx)("p",{className:"text-sm text-scale-1100",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,j.jsx)(p.XZJ,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:Z,onChange:function(){return A(!Z)}}),Z&&(0,j.jsxs)(p.bZj,{withIcon:!0,variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,j.jsx)("p",{className:"mb-4",children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,j.jsx)(l.default,{href:"https://www.postgresql.org/docs/current/ddl-depend.html",children:(0,j.jsx)("a",{target:"_blank",children:(0,j.jsx)(p.zxk,{size:"tiny",type:"default",icon:(0,j.jsx)(p.TqL,{}),children:"About dependency tracking"})})})]})]})}),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:function(){C(!1),q(void 0)},onSelectConfirm:se}),(0,j.jsx)(v.Z,{danger:!0,size:"small",visible:D&&!(0,f.isUndefined)(R),header:(0,j.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null===R||void 0===R?void 0:R.name,'"')}),children:(0,j.jsx)(p.u_l.Content,{children:(0,j.jsxs)("div",{className:"py-4 space-y-4",children:[(0,j.jsx)("p",{className:"text-sm text-scale-1100",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,j.jsx)(p.XZJ,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:Z,onChange:function(){return A(!Z)}}),Z&&(0,j.jsxs)(p.bZj,{withIcon:!0,variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,j.jsx)("p",{className:"mb-4",children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,j.jsx)(l.default,{href:"https://www.postgresql.org/docs/current/ddl-depend.html",children:(0,j.jsx)("a",{target:"_blank",children:(0,j.jsx)(p.zxk,{size:"tiny",type:"default",icon:(0,j.jsx)(p.TqL,{}),children:"About dependency tracking"})})})]})]})}),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:function(){C(!1),U(void 0)},onSelectConfirm:le})]})})))},97352:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/editor/[id]",function(){return n(51324)}])}},function(e){e.O(0,[8143,5813,9731,2367,7190,4633,6226,1607,7571,9526,113,7173,6778,9774,2888,179],(function(){return t=97352,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[id]-660fb7ea715b4356.js.map